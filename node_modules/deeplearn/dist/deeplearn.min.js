!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).deeplearn=t()}}(function(){return function t(e,r,n){function o(i,s){if(!r[i]){if(!e[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var p=r[i]={exports:{}};e[i][0].call(p.exports,function(t){var r=e[i][1][t];return o(r||t)},p,p.exports,t,e,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(t,e,r){},{}],2:[function(t,e,r){var n=t("./lib/alea"),o=t("./lib/xor128"),a=t("./lib/xorwow"),i=t("./lib/xorshift7"),s=t("./lib/xor4096"),u=t("./lib/tychei"),c=t("./seedrandom");c.alea=n,c.xor128=o,c.xorwow=a,c.xorshift7=i,c.xor4096=s,c.tychei=u,e.exports=c},{"./lib/alea":3,"./lib/tychei":4,"./lib/xor128":5,"./lib/xor4096":6,"./lib/xorshift7":7,"./lib/xorwow":8,"./seedrandom":9}],3:[function(t,e,r){!function(t,e,r){function n(t){var e=this,r=i();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=r(" "),e.s1=r(" "),e.s2=r(" "),e.s0-=r(t),e.s0<0&&(e.s0+=1),e.s1-=r(t),e.s1<0&&(e.s1+=1),e.s2-=r(t),e.s2<0&&(e.s2+=1),r=null}function o(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function a(t,e){var r=new n(t),a=e&&e.state,i=r.next;return i.int32=function(){return 4294967296*r.next()|0},i.double=function(){return i()+1.1102230246251565e-16*(2097152*i()|0)},i.quick=i,a&&("object"==typeof a&&o(a,r),i.state=function(){return o(r,{})}),i}function i(){var t=4022871197;return function(e){e=e.toString();for(var r=0;r<e.length;r++){var n=.02519603282416938*(t+=e.charCodeAt(r));n-=t=n>>>0,t=(n*=t)>>>0,t+=4294967296*(n-=t)}return 2.3283064365386963e-10*(t>>>0)}}e&&e.exports?e.exports=a:r&&r.amd?r(function(){return a}):this.alea=a}(0,"object"==typeof e&&e,!1)},{}],4:[function(t,e,r){!function(t,e,r){function n(t){var e=this,r="";e.next=function(){var t=e.b,r=e.c,n=e.d,o=e.a;return t=t<<25^t>>>7^r,r=r-n|0,n=n<<24^n>>>8^o,o=o-t|0,e.b=t=t<<20^t>>>12^r,e.c=r=r-n|0,e.d=n<<16^r>>>16^o,e.a=o-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):r+=t;for(var n=0;n<r.length+20;n++)e.b^=0|r.charCodeAt(n),e.next()}function o(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function a(t,e){var r=new n(t),a=e&&e.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=r.next,i.quick=i,a&&("object"==typeof a&&o(a,r),i.state=function(){return o(r,{})}),i}e&&e.exports?e.exports=a:r&&r.amd?r(function(){return a}):this.tychei=a}(0,"object"==typeof e&&e,!1)},{}],5:[function(t,e,r){!function(t,e,r){function n(t){var e=this,r="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:r+=t;for(var n=0;n<r.length+64;n++)e.x^=0|r.charCodeAt(n),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function a(t,e){var r=new n(t),a=e&&e.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=r.next,i.quick=i,a&&("object"==typeof a&&o(a,r),i.state=function(){return o(r,{})}),i}e&&e.exports?e.exports=a:r&&r.amd?r(function(){return a}):this.xor128=a}(0,"object"==typeof e&&e,!1)},{}],6:[function(t,e,r){!function(t,e,r){function n(t){var e=this;e.next=function(){var t,r,n=e.w,o=e.X,a=e.i;return e.w=n=n+1640531527|0,r=o[a+34&127],t=o[a=a+1&127],r^=r<<13,t^=t<<17,r^=r>>>15,t^=t>>>12,r=o[a]=r^t,e.i=a,r+(n^n>>>16)|0},function(t,e){var r,n,o,a,i,s=[],u=128;for(e===(0|e)?(n=e,e=null):(e+="\0",n=0,u=Math.max(u,e.length)),o=0,a=-32;a<u;++a)e&&(n^=e.charCodeAt((a+32)%e.length)),0===a&&(i=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,a>=0&&(i=i+1640531527|0,o=0==(r=s[127&a]^=n+i)?o+1:0);for(o>=128&&(s[127&(e&&e.length||0)]=-1),o=127,a=512;a>0;--a)n=s[o+34&127],r=s[o=o+1&127],n^=n<<13,r^=r<<17,n^=n>>>15,r^=r>>>12,s[o]=n^r;t.w=i,t.X=s,t.i=o}(e,t)}function o(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function a(t,e){null==t&&(t=+new Date);var r=new n(t),a=e&&e.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=r.next,i.quick=i,a&&(a.X&&o(a,r),i.state=function(){return o(r,{})}),i}e&&e.exports?e.exports=a:r&&r.amd?r(function(){return a}):this.xor4096=a}(0,"object"==typeof e&&e,!1)},{}],7:[function(t,e,r){!function(t,e,r){function n(t){var e=this;e.next=function(){var t,r,n=e.x,o=e.i;return t=n[o],t^=t>>>7,r=t^t<<24,t=n[o+1&7],r^=t^t>>>10,t=n[o+3&7],r^=t^t>>>3,t=n[o+4&7],r^=t^t<<7,t=n[o+7&7],t^=t<<13,r^=t^t<<9,n[o]=r,e.i=o+1&7,r},function(t,e){var r,n=[];if(e===(0|e))n[0]=e;else for(e=""+e,r=0;r<e.length;++r)n[7&r]=n[7&r]<<15^e.charCodeAt(r)+n[r+1&7]<<13;for(;n.length<8;)n.push(0);for(r=0;r<8&&0===n[r];++r);for(8==r?n[7]=-1:n[r],t.x=n,t.i=0,r=256;r>0;--r)t.next()}(e,t)}function o(t,e){return e.x=t.x.slice(),e.i=t.i,e}function a(t,e){null==t&&(t=+new Date);var r=new n(t),a=e&&e.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=r.next,i.quick=i,a&&(a.x&&o(a,r),i.state=function(){return o(r,{})}),i}e&&e.exports?e.exports=a:r&&r.amd?r(function(){return a}):this.xorshift7=a}(0,"object"==typeof e&&e,!1)},{}],8:[function(t,e,r){!function(t,e,r){function n(t){var e=this,r="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:r+=t;for(var n=0;n<r.length+64;n++)e.x^=0|r.charCodeAt(n),n==r.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function a(t,e){var r=new n(t),a=e&&e.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=r.next,i.quick=i,a&&("object"==typeof a&&o(a,r),i.state=function(){return o(r,{})}),i}e&&e.exports?e.exports=a:r&&r.amd?r(function(){return a}):this.xorwow=a}(0,"object"==typeof e&&e,!1)},{}],9:[function(t,e,r){!function(r,n){function o(t,e,o){var l=[],h=u(s((e=1==e?{entropy:!0}:e||{}).entropy?[t,p(r)]:null==t?c():t,3),l),x=new a(l),b=function(){for(var t=x.g(d),e=m,r=0;t<g;)t=(t+r)*f,e*=f,r=x.g(1);for(;t>=y;)t/=2,e/=2,r>>>=1;return(t+r)/e};return b.int32=function(){return 0|x.g(4)},b.quick=function(){return x.g(4)/4294967296},b.double=b,u(p(x.S),r),(e.pass||o||function(t,e,r,o){return o&&(o.S&&i(o,x),t.state=function(){return i(x,{})}),r?(n[v]=t,e):t})(b,h,"global"in e?e.global:this==n,e.state)}function a(t){var e,r=t.length,n=this,o=0,a=n.i=n.j=0,i=n.S=[];for(r||(t=[r++]);o<f;)i[o]=o++;for(o=0;o<f;o++)i[o]=i[a=x&a+t[o%r]+(e=i[o])],i[a]=e;(n.g=function(t){for(var e,r=0,o=n.i,a=n.j,i=n.S;t--;)e=i[o=x&o+1],r=r*f+i[x&(i[o]=i[a=x&a+e])+(i[a]=e)];return n.i=o,n.j=a,r})(f)}function i(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function s(t,e){var r,n=[],o=typeof t;if(e&&"object"==o)for(r in t)try{n.push(s(t[r],e-1))}catch(t){}return n.length?n:"string"==o?t:t+"\0"}function u(t,e){for(var r,n=t+"",o=0;o<n.length;)e[x&o]=x&(r^=19*e[x&o])+n.charCodeAt(o++);return p(e)}function c(){try{var t;return l&&(t=l.randomBytes)?t=t(f):(t=new Uint8Array(f),(h.crypto||h.msCrypto).getRandomValues(t)),p(t)}catch(t){var e=h.navigator,n=e&&e.plugins;return[+new Date,h,n,h.screen,p(r)]}}function p(t){return String.fromCharCode.apply(0,t)}var l,h=this,f=256,d=6,v="random",m=n.pow(f,d),g=n.pow(2,52),y=2*g,x=f-1;if(n["seed"+v]=o,u(n.random(),r),"object"==typeof e&&e.exports){e.exports=o;try{l=t("crypto")}catch(t){}}}([],Math)},{crypto:1}],10:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../math/ndarray"),o=function(){function t(t){this.urlPath=t,"/"!==this.urlPath.charAt(this.urlPath.length-1)&&(this.urlPath+="/")}return t.prototype.loadManifest=function(){var t=this;return new Promise(function(e,r){var n=new XMLHttpRequest;n.open("GET",t.urlPath+"manifest.json"),n.onload=function(){t.checkpointManifest=JSON.parse(n.responseText),e()},n.onerror=function(e){throw new Error("manifest.json not found at "+t.urlPath+". "+e)},n.send()})},t.prototype.getCheckpointManifest=function(){var t=this;return null==this.checkpointManifest?new Promise(function(e,r){t.loadManifest().then(function(){e(t.checkpointManifest)})}):new Promise(function(e,r){e(t.checkpointManifest)})},t.prototype.getAllVariables=function(){var t=this;return null!=this.variables?new Promise(function(e,r){e(t.variables)}):new Promise(function(e,r){t.getCheckpointManifest().then(function(r){for(var n=Object.keys(t.checkpointManifest),o=[],a=0;a<n.length;a++)o.push(t.getVariable(n[a]));Promise.all(o).then(function(r){t.variables={};for(var o=0;o<r.length;o++)t.variables[n[o]]=r[o];e(t.variables)})})})},t.prototype.getVariable=function(t){var e=this;if(!(t in this.checkpointManifest))throw new Error("Cannot load non-existant variable "+t);var r=function(r,o){var a=new XMLHttpRequest;a.responseType="arraybuffer";var i=e.checkpointManifest[t].filename;a.open("GET",e.urlPath+i),a.onload=function(){var o=new Float32Array(a.response),i=n.NDArray.make(e.checkpointManifest[t].shape,{values:o});r(i)},a.onerror=function(e){throw new Error("Could not fetch variable "+t+": "+e)},a.send()};return null==this.checkpointManifest?new Promise(function(t,n){e.loadManifest().then(function(){new Promise(r).then(t)})}):new Promise(r)},t}();r.CheckpointLoader=o},{"../math/ndarray":61}],11:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../math/ndarray"),o=t("../util"),a=function(){function t(t){this.dataShapes=t,this.normalizationInfo={}}return t.prototype.getDataShape=function(t){return this.dataShapes[t]},t.prototype.getData=function(){return this.dataset},t.prototype.getStats=function(){var t=this;if(null==this.dataset)throw new Error("Data is null.");return this.dataset.map(function(e){return t.getStatsForData(e)})},t.prototype.getStatsForData=function(t){var e=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,n=t.map(function(t,e){return e});o.shuffle(n),n=n.slice(.1*n.length);for(var a=0;a<n.length;a++)for(var i=t[n[a]].getValues(),s=0;s<i.length;s++)e=Math.min(e,i[s]),r=Math.max(r,i[s]);return{inputMin:e,inputMax:r,exampleCount:t.length,shape:t[0].shape}},t.prototype.normalizeExamplesToRange=function(t,e,r,a,i){var s=r instanceof Float32Array&&e instanceof Float32Array,u=a instanceof Float32Array&&i instanceof Float32Array,c=o.sizeFromShape(t[0].shape),p=[];return t.forEach(function(t){for(var o=t.getValues(),l=new Float32Array(c),h=0;h<c;h++){var f=s?e[h]:e,d=(s?r[h]:r)-f,v=u?a[h]:a,m=(u?i[h]:i)-v;l[h]=0===d?v:v+m*(o[h]-f)/d}p.push(n.NDArray.make(t.shape,{values:l}))}),p},t.prototype.computeBounds=function(t){var e=this;if(null==this.dataset)throw new Error("Data is null.");var r=o.sizeFromShape(this.dataset[t][0].shape);this.normalizationInfo[t]={isNormalized:!1,minValues:new Float32Array(r),maxValues:new Float32Array(r)};for(var n=0;n<r;n++)this.normalizationInfo[t].minValues[n]=Number.POSITIVE_INFINITY,this.normalizationInfo[t].maxValues[n]=Number.NEGATIVE_INFINITY;this.dataset[t].forEach(function(n){for(var o=n.getValues(),a=0;a<r;a++)e.normalizationInfo[t].minValues[a]=Math.min(e.normalizationInfo[t].minValues[a],o[a]),e.normalizationInfo[t].maxValues[a]=Math.max(e.normalizationInfo[t].maxValues[a],o[a])})},t.prototype.normalizeWithinBounds=function(t,e,r){if(null==this.dataset)throw new Error("Data is null.");if(t>=this.dataset.length)throw new Error("dataIndex out of bounds.");null==this.normalizationInfo[t]&&this.computeBounds(t);var n,o;this.normalizationInfo[t].isNormalized?(n=this.normalizationInfo[t].lowerBound,o=this.normalizationInfo[t].upperBound):(n=this.normalizationInfo[t].minValues,o=this.normalizationInfo[t].maxValues),this.dataset[t]=this.normalizeExamplesToRange(this.dataset[t],n,o,e,r),this.normalizationInfo[t].isNormalized=!0,this.normalizationInfo[t].lowerBound=e,this.normalizationInfo[t].upperBound=r},t.prototype.isNormalized=function(t){return null!=this.normalizationInfo&&this.normalizationInfo[t].isNormalized},t.prototype.removeNormalization=function(t){if(null==this.dataset)throw new Error("Training or test data is null.");this.isNormalized(t)&&(this.dataset[t]=this.normalizeExamplesToRange(this.dataset[t],this.normalizationInfo[t].lowerBound,this.normalizationInfo[t].upperBound,this.normalizationInfo[t].minValues,this.normalizationInfo[t].maxValues),this.normalizationInfo[t].isNormalized=!1)},t.prototype.unnormalizeExamples=function(t,e){return this.isNormalized(e)?this.normalizeExamplesToRange(t,this.normalizationInfo[e].lowerBound,this.normalizationInfo[e].upperBound,this.normalizationInfo[e].minValues,this.normalizationInfo[e].maxValues):t},t.prototype.dispose=function(){if(null!=this.dataset){for(var t=0;t<this.dataset.length;t++)for(var e=0;e<this.dataset[t].length;e++)this.dataset[t][e].dispose();this.dataset=[]}},t}();r.InMemoryDataset=a},{"../math/ndarray":61,"../util":94}],12:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../math/ndarray"),a=t("../util"),i=function(){function t(t){this.inputs=t,this.idx=0,this.inputCounter=0,this.epoch=0,this.shuffledIndices=a.createShuffledIndices(t[0].length),this.numInputs=t.length;for(var e=this.inputs[0].length,r=0;r<this.numInputs;r++)a.assert(this.inputs[r].length===e,"Number of examples must match across different inputs.");for(r=0;r<this.numInputs;r++)for(var n=this.inputs[r][0].shape,o=0;o<this.inputs[r].length;o++)a.assertShapesMatch(n,this.inputs[r][o].shape)}return t.prototype.getCurrentExampleIndex=function(){var t=this.idx;return++this.inputCounter>=this.numInputs&&(this.idx++,this.inputCounter=0,this.idx>=this.inputs[0].length&&(this.idx=0,this.epoch++)),t},t.prototype.getNextInput=function(t){var e=this.getCurrentExampleIndex();return this.inputs[t][this.shuffledIndices[e]]},t.prototype.getEpoch=function(){return this.epoch},t.prototype.getInputProviders=function(){for(var t=[],e=0;e<this.numInputs;e++)t.push(this.getInputProvider(e));return t},t}();r.InMemoryShuffledInputProviderBuilder=i;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getInputProvider=function(t){var e=this;return{getNextCopy:function(r){return o.NDArray.like(e.getNextInput(t))},disposeCopy:function(t,e){e.dispose()}}},e}(i);r.InCPUMemoryShuffledInputProviderBuilder=s;var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getInputProvider=function(t){var e=this;return{getNextCopy:function(r){return r.clone(e.getNextInput(t))},disposeCopy:function(t,e){e.dispose()}}},e}(i);r.InGPUMemoryShuffledInputProviderBuilder=u},{"../math/ndarray":61,"../util":94}],13:[function(t,e,r){"use strict";function n(t){return new Promise(function(e,r){var n=new XMLHttpRequest;n.open("GET",t.path),n.responseType="arraybuffer",n.onload=function(r){var o="float32"===t.dataType?new Float32Array(n.response):new Uint8Array(n.response);e(o)},n.onerror=function(t){return r(t)},n.send()})}function o(t,e,r){for(var n=r,o=0;o<t.length;o+=4)e[n++]=t[o]}function a(t,e,r){for(var n=r,o=0;o<t.length;o+=4)e[n]=t[o],e[n+1]=t[o+1],e[n+2]=t[o+2],n+=3}function i(t,e){var r=document.createElement("canvas"),n=r.getContext("2d"),i=t.height,s=p.sizeFromShape(e),u=new Uint8Array(i*s);if(t.width!==e[0]*e[1])throw new Error("Image width ("+t.width+") must be multiple of rows*columns ("+e[0]+"*"+e[1]+") of the ndarray");r.width=t.width,r.height=h;for(var c=r.width,l=r.height,f=c,d=l,v=e[2],m=0,g=Math.ceil(i/r.height),y=0;y<g;++y){var x=y*r.height;y===g-1&&i%r.height>0&&(r.height=i%r.height,d=l=r.height),n.drawImage(t,0,x,c,l,0,0,f,d);var b=n.getImageData(0,0,r.width,r.height).data;1===v?o(b,u,m):a(b,u,m),m+=r.height*s}return u}function s(t,e){return new Promise(function(r,n){var o=new Image;o.setAttribute("crossOrigin",""),o.onload=function(){var t=i(o,e);o.src="",o=null,r(t)},o.src=t.path})}var u=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var c=t("../math/ndarray"),p=t("../util"),l=t("./dataset"),h=1e3;r.getXhrDatasetConfig=function(t){return new Promise(function(e,r){var n=new XMLHttpRequest;n.open("GET",t),n.onload=function(){e(JSON.parse(n.responseText))},n.onerror=function(t){r(t)},n.send()})};var f=function(t){function e(e){var r=t.call(this,e.data.map(function(t){return t.shape}))||this;return r.xhrDatasetConfig=e,r}return u(e,t),e.prototype.getNDArray=function(t){return("png"===t.dataType?s(t,t.shape):n(t)).then(function(e){for(var r=p.sizeFromShape(t.shape),n=[],o=0;o<e.length/r;o++){var a=e.subarray(o*r,(o+1)*r),i=c.NDArray.make(t.shape,{values:new Float32Array(a)});n.push(i)}return n})},e.prototype.fetchData=function(){var t=this;return new Promise(function(e,r){var n=t.xhrDatasetConfig.data.map(function(e){return t.getNDArray(e)});Promise.all(n).then(function(r){t.dataset=r,e()})})},e}(l.InMemoryDataset);r.XhrDataset=f},{"../math/ndarray":61,"../util":94,"./dataset":11}],14:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isMobile=function(){var t=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}},{}],15:[function(t,e,r){"use strict";function n(t){if(0===t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=document.createElement("canvas");return 1===t?e.getContext("webgl")||e.getContext("experimental-webgl"):e.getContext("webgl2")}function o(t){if(null!=t){var e=t.getExtension("WEBGL_lose_context");if(null==e)throw new Error("Extension WEBGL_lose_context not supported on this browser.");e.loseContext()}}function a(t){var e=n(t);return null!=e&&(o(e),!0)}function i(t){var e=n(t),r=1===t?"EXT_disjoint_timer_query":"EXT_disjoint_timer_query_webgl2",a=null!=e.getExtension(r);return null!=e&&o(e),a}function s(t){if(0===t)return!1;var e,r,a=n(t);if(1===t){if(e=a.getExtension("OES_texture_float"),r=a.getExtension("WEBGL_color_buffer_float"),null==e||null==r)return!1}else if(null==(r=a.getExtension("EXT_color_buffer_float")))return!1;var i=a.createFramebuffer(),s=a.createTexture();a.bindTexture(a.TEXTURE_2D,s);var u=2===t?a.RGBA32F:a.RGBA;a.texImage2D(a.TEXTURE_2D,0,u,1,1,0,a.RGBA,a.FLOAT,null),a.bindFramebuffer(a.FRAMEBUFFER,i),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,s,0);var c=a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE;return o(a),c}Object.defineProperty(r,"__esModule",{value:!0});var u,c=t("./device_util"),p=t("./util");!function(t){t[t.NUMBER=0]="NUMBER",t[t.BOOLEAN=1]="BOOLEAN"}(u=r.Type||(r.Type={})),r.URL_PROPERTIES=[{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_ENABLED",type:u.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:u.BOOLEAN},{name:"WEBGL_VERSION",type:u.NUMBER},{name:"WEBGL_FLOAT_TEXTURE_ENABLED",type:u.BOOLEAN}];var l=function(){function t(t){this.features={},null!=t&&(this.features=t)}return t.prototype.get=function(t){return t in this.features?this.features[t]:(this.features[t]=this.evaluateFeature(t),this.features[t])},t.prototype.evaluateFeature=function(t){if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_ENABLED"===t){var e=this.get("WEBGL_VERSION");return 0!==e&&i(e)}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===t)return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_ENABLED")&&!c.isMobile();if("WEBGL_VERSION"===t)return a(2)?2:a(1)?1:0;if("WEBGL_FLOAT_TEXTURE_ENABLED"===t)return s(this.get("WEBGL_VERSION"));throw new Error("Unknown feature "+t+".")},t}();r.Environment=l;var h="dljsflags";r.ENV=new l(function(){var t={};if("undefined"==typeof window)return t;var e=p.getQueryParams(window.location.search);if(h in e){var n={};e[h].split(",").forEach(function(t){var e=t.split(":"),r=e[0],o=e[1];n[r]=o}),r.URL_PROPERTIES.forEach(function(e){e.name in n&&(console.log("Setting feature override from URL "+e.name+": "+n[e.name]),e.type===u.NUMBER?t[e.name]=+n[e.name]:e.type===u.BOOLEAN?t[e.name]="true"===n[e.name]:console.warn("Unknown URL param: "+e.name+"."))})}return t}()),r.setEnvironment=function(t){r.ENV=t}},{"./device_util":14,"./util":94}],16:[function(t,e,r){"use strict";function n(t,e){return 1===t.length&&1===e.length?[1]:1===t.length&&2===e.length?[e[1]]:2===t.length&&1===e.length?[t[0]]:[t[0],e[1]]}var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var a=t("../initializers"),i=t("../math/concat_util"),s=t("../math/conv_util"),u=t("../math/ndarray"),c=t("../util"),p=function(){function t(t){this.g=t}return t.prototype.dense=function(t,e,r,n,o,i,s){void 0===n&&(n=null),void 0===o&&(o=!0),void 0===i&&(i=new a.VarianceScalingInitializer),void 0===s&&(s=new a.ZerosInitializer);var u=this.g.variable(t+"-weights",i.initialize([e.shape[0],r],e.shape[0],r)),c=this.g.matmul(e,u);if(o){var p=this.g.variable(t+"-bias",s.initialize([r],e.shape[0],r));c=this.g.add(c,p)}return null!=n&&(c=n(c)),c},t}();r.GraphLayers=p;var l=function(){function t(){this.nodes=[],this.layers=new p(this)}return t.prototype.variable=function(t,e){return this.addNodeAndReturnOutput(new d(this,t,e))},t.prototype.placeholder=function(t,e){return this.addNodeAndReturnOutput(new v(this,t,e))},t.prototype.constant=function(t){var e;if("number"==typeof t)e=u.Scalar.new(t);else if(t instanceof u.NDArray)e=t;else{if(!(t instanceof Array))throw new Error("unimplemented constant type.");var r=c.flatten(t),n=new Float32Array(r);e=u.NDArray.make(c.inferShape(t),{values:n})}return this.addNodeAndReturnOutput(new m(this,e))},t.prototype.reshape=function(t,e){return this.addNodeAndReturnOutput(new g(this,"Reshape",t,e))},t.prototype.fusedLinearCombination=function(t,e,r,n){return this.addNodeAndReturnOutput(new y(this,t,e,r,n))},t.prototype.add=function(t,e){return this.addNodeAndReturnOutput(new x(this,t,e))},t.prototype.subtract=function(t,e){return this.addNodeAndReturnOutput(new b(this,t,e))},t.prototype.multiply=function(t,e){return this.addNodeAndReturnOutput(new w(this,t,e))},t.prototype.divide=function(t,e){return this.addNodeAndReturnOutput(new _(this,t,e))},t.prototype.reduceSum=function(t){return this.addNodeAndReturnOutput(new A(this,t))},t.prototype.concat3d=function(t,e,r){return this.addNodeAndReturnOutput(new T(this,t,e,r))},t.prototype.matmul=function(t,e){return this.addNodeAndReturnOutput(new E(this,t,e))},t.prototype.conv2d=function(t,e,r,n,o,a,i){return void 0===a&&(a=1),this.addNodeAndReturnOutput(new S(this,t,e,r,n,o,a,i))},t.prototype.maxPool=function(t,e,r,n){return void 0===r&&(r=1),this.addNodeAndReturnOutput(new C(this,t,e,r,n))},t.prototype.exp=function(t){return this.addNodeAndReturnOutput(new O(this,t))},t.prototype.log=function(t){return this.addNodeAndReturnOutput(new R(this,t))},t.prototype.relu=function(t){return this.addNodeAndReturnOutput(new M(this,t))},t.prototype.tanh=function(t){return this.addNodeAndReturnOutput(new N(this,t))},t.prototype.sigmoid=function(t){return this.addNodeAndReturnOutput(new P(this,t))},t.prototype.square=function(t){return this.addNodeAndReturnOutput(new I(this,t))},t.prototype.softmax=function(t){return this.addNodeAndReturnOutput(new k(this,t))},t.prototype.softmaxCrossEntropyCost=function(t,e){return this.addNodeAndReturnOutput(new D(this,t,e))},t.prototype.meanSquaredCost=function(t,e){return this.addNodeAndReturnOutput(new z(this,t,e))},t.prototype.argmax=function(t){return this.addNodeAndReturnOutput(new F(this,t))},t.prototype.argmaxEquals=function(t,e){return this.addNodeAndReturnOutput(new V(this,t,e))},t.prototype.addNodeAndReturnOutput=function(t){return this.nodes.push(t),t.validate(),t.output},t.prototype.getNodes=function(){return this.nodes},t}();r.Graph=l;var h=function(){function t(e){this.shape=e,this.id=t.nextID++}return t.nextID=0,t}();r.Tensor=h;var f=function(){function t(e,r,n,o){this.graph=e,this.name=r,this.inputs=n,this.output=o,this.id=t.nextID++,o.node=this}return t.nextID=0,t}();r.Node=f;var d=function(t){function e(e,r,n){var o=t.call(this,e,r,{},new h(n.shape))||this;return o.data=n,o}return o(e,t),e.prototype.validate=function(){c.assert(null!=this.data,"Error adding variable op: Data for variable '"+this.name+"' is null or undefined")},e}(f);r.VariableNode=d;var v=function(t){function e(e,r,n){return t.call(this,e,r,{},new h(n))||this}return o(e,t),e.prototype.validate=function(){},e}(f);r.PlaceholderNode=v;var m=function(t){function e(e,r){var n=t.call(this,e,"Constant",{},new h(r.shape))||this;return n.data=r,n}return o(e,t),e.prototype.validate=function(){c.assert(null!=this.data,"Error adding constant: data for placeholder '"+this.name+"' is null or undefined")},e}(f);r.ConstantNode=m;var g=function(t){function e(e,r,n,o){var a=t.call(this,e,r,{x:n},new h(o))||this;return a.name=r,a.x=n,a.shape=o,a}return o(e,t),e.prototype.validate=function(){var t=c.sizeFromShape(this.x.shape),e=c.sizeFromShape(this.shape);c.assert(t===e,"Error making reshape operation: input Tensor to reshape '"+this.name+"' of shape ("+this.x.shape+") does not match size of requested shape "+this.shape+".")},e.X="x",e}(f);r.ReshapeNode=g;var y=function(t){function e(e,r,n,o,a){var i=t.call(this,e,"Linear Combination",{t1:r,t2:n,c1:o,c2:a},new h(r.shape))||this;return i.t1=r,i.t2=n,i.c1=o,i.c2=a,i}return o(e,t),e.prototype.validate=function(){if(c.assertShapesMatch(this.t1.shape,this.t2.shape),!c.isScalarShape(this.c1.shape))throw new Error("Error adding fusedLinearCombination: c1 is not a scalar, got shape: "+this.c1.shape);if(!c.isScalarShape(this.c2.shape))throw new Error("Error adding fusedLinearCombination: c2 is not a scalar, got shape: "+this.c2.shape)},e.T1="t1",e.T2="t2",e.C1="c1",e.C2="c2",e}(f);r.FusedLinearCombinationNode=y;var x=function(t){function e(e,r,n){var o=t.call(this,e,"Add",{t1:r,t2:n},new h(1===c.sizeFromShape(r.shape)?n.shape:r.shape))||this;return o.t1=r,o.t2=n,o}return o(e,t),e.prototype.validate=function(){c.assert(1===c.sizeFromShape(this.t1.shape)||1===c.sizeFromShape(this.t2.shape)||c.arraysEqual(this.t1.shape,this.t2.shape),"Error adding add operation op: one of inputs must be scalar or the shapes "+this.t1.shape+" and "+this.t2.shape+" must match.")},e.T1="t1",e.T2="t2",e}(f);r.AddNode=x;var b=function(t){function e(e,r,n){var o=t.call(this,e,"Subtract",{t1:r,t2:n},new h(1===c.sizeFromShape(r.shape)?n.shape:r.shape))||this;return o.t1=r,o.t2=n,o}return o(e,t),e.prototype.validate=function(){c.assert(1===c.sizeFromShape(this.t1.shape)||1===c.sizeFromShape(this.t2.shape)||c.arraysEqual(this.t1.shape,this.t2.shape),"Error adding subtract op: one of inputs must be scalar or the shapes "+this.t1.shape+" and "+this.t2.shape+" must match.")},e.T1="t1",e.T2="t2",e}(f);r.SubtractNode=b;var w=function(t){function e(e,r,n){var o=t.call(this,e,"Multiply",{t1:r,t2:n},new h(1===c.sizeFromShape(r.shape)?n.shape:r.shape))||this;return o.t1=r,o.t2=n,o}return o(e,t),e.prototype.validate=function(){c.assert(1===c.sizeFromShape(this.t1.shape)||1===c.sizeFromShape(this.t2.shape)||c.arraysEqual(this.t1.shape,this.t2.shape),"Error adding multiply op: one of inputs must be scalar or the shapes "+this.t1.shape+" and "+this.t2.shape+" must match.")},e.T1="t1",e.T2="t2",e}(f);r.MultiplyNode=w;var _=function(t){function e(e,r,n){var o=t.call(this,e,"Divide",{t1:r,t2:n},new h(1===c.sizeFromShape(r.shape)?n.shape:r.shape))||this;return o.t1=r,o.t2=n,o}return o(e,t),e.prototype.validate=function(){c.assert(1===c.sizeFromShape(this.t1.shape)||1===c.sizeFromShape(this.t2.shape)||c.arraysEqual(this.t1.shape,this.t2.shape),"Error adding divide op: one of inputs must be scalar or the shapes "+this.t1.shape+" and "+this.t2.shape+" must match.")},e.T1="t1",e.T2="t2",e}(f);r.DivideNode=_;var A=function(t){function e(e,r){return t.call(this,e,"ReduceSum",{x:r},new h([]))||this}return o(e,t),e.prototype.validate=function(){},e.X="x",e}(f);r.ReduceSumNode=A;var T=function(t){function e(e,r,n,o){var a=t.call(this,e,"Concat3D",{x1:r,x2:n},new h(i.computeOutShape(r.shape,n.shape,o)))||this;return a.x1=r,a.x2=n,a.axis=o,a}return o(e,t),e.prototype.validate=function(){i.assertParams(this.x1.shape,this.x2.shape,this.axis)},e.X1="x1",e.X2="x2",e.AXIS="axis",e}(f);r.Concat3DNode=T;var E=function(t){function e(e,r,o){var a=t.call(this,e,"MatMul",{x1:r,x2:o},new h(n(r.shape,o.shape)))||this;return a.x1=r,a.x2=o,a}return o(e,t),e.prototype.validate=function(){if(2===this.x1.shape.length&&2===this.x2.shape.length)c.assert(this.x1.shape[1]===this.x2.shape[0],"Error adding matmul op: inner shapes of matrices with shapes "+this.x1.shape+" and "+this.x2.shape+" must match.");else if(2===this.x1.shape.length&&1===this.x2.shape.length)c.assert(this.x1.shape[1]===this.x2.shape[0],"Error adding matmul op: second dimension of matrix with shape "+this.x1.shape+" must match size of vector with shape "+this.x2.shape+".");else{if(1!==this.x1.shape.length||2!==this.x2.shape.length)throw new Error("Error adding matmul op: inputs must be vectors or matrices.");c.assert(this.x1.shape[0]===this.x2.shape[0],"Error adding matmul op: size of vector with shape "+this.x1.shape+" must match first dimension of matrix with shape "+this.x2.shape+".")}},e.X1="x1",e.X2="x2",e}(f);r.MatMulNode=E;var S=function(t){function e(e,r,n,o,a,i,u,c){void 0===u&&(u=1);var p=t.call(this,e,"Convolution 2D",{x:r,w:n,b:o},new h(s.computeOutputShape3D(r.shape,a,i,u,c)))||this;return p.x=r,p.w=n,p.b=o,p.fieldSize=a,p.outputDepth=i,p.stride=u,p.zeroPad=c,p}return o(e,t),e.prototype.validate=function(){c.assert(3===this.x.shape.length,"Error adding conv2d op: input must be of rank 3, but got shape: "+this.x.shape+"."),c.assert(4===this.w.shape.length,"Error adding conv2d op: weights must be of rank 4, but got shape: "+this.w.shape+"."),c.assert(1===this.b.shape.length,"Error adding conv2d op: biases must be of rank 1, but got shape: "+this.b.shape+"."),c.assert(this.x.shape[2]===this.w.shape[2],"Error adding conv2d op: depth of input ("+this.x.shape[2]+") must match input depth for weights ("+this.w.shape[2]+").")},e.X="x",e.W="w",e.B="b",e}(f);r.Convolution2DNode=S;var C=function(t){function e(e,r,n,o,a){void 0===o&&(o=1);var i=t.call(this,e,"Max pool",{x:r},new h(s.computeOutputShape3D(r.shape,n,r.shape[2],o,a)))||this;return i.x=r,i.fieldSize=n,i.stride=o,i.zeroPad=a,i}return o(e,t),e.prototype.validate=function(){c.assert(3===this.x.shape.length,"Error adding maxPool op: input must be of rank 3, but got shape: "+this.x.shape+".")},e.X="x",e}(f);r.MaxPoolNode=C;var M=function(t){function e(e,r){return t.call(this,e,"ReLU",{x:r},new h(r.shape))||this}return o(e,t),e.prototype.validate=function(){},e.X="x",e}(f);r.ReLUNode=M;var O=function(t){function e(e,r){return t.call(this,e,"Exp",{x:r},new h(r.shape))||this}return o(e,t),e.prototype.validate=function(){},e.X="x",e}(f);r.ExpNode=O;var R=function(t){function e(e,r){return t.call(this,e,"Log",{x:r},new h(r.shape))||this}return o(e,t),e.prototype.validate=function(){},e.X="x",e}(f);r.LogNode=R;var N=function(t){function e(e,r){return t.call(this,e,"TanH",{x:r},new h(r.shape))||this}return o(e,t),e.prototype.validate=function(){},e.X="x",e}(f);r.TanHNode=N;var P=function(t){function e(e,r){return t.call(this,e,"Sigmoid",{x:r},new h(r.shape))||this}return o(e,t),e.prototype.validate=function(){},e.X="x",e}(f);r.SigmoidNode=P;var I=function(t){function e(e,r){return t.call(this,e,"Square",{x:r},new h(r.shape))||this}return o(e,t),e.prototype.validate=function(){},e.X="x",e}(f);r.SquareNode=I;var D=function(t){function e(e,r,n){var o=t.call(this,e,"SoftmaxCrossEntropyCost",{x:r,target:n},new h([]))||this;return o.x=r,o.target=n,o}return o(e,t),e.prototype.validate=function(){c.assert(c.arraysEqual(this.x.shape,this.target.shape),"Error adding softmaxCrossEntropyCost op: x shape ("+this.x.shape+") must match target shape ("+this.target.shape+").")},e.X="x",e.TARGET="target",e}(f);r.SoftmaxCrossEntropyCostNode=D;var k=function(t){function e(e,r){var n=t.call(this,e,"Softmax",{x:r},new h(r.shape))||this;return n.x=r,n}return o(e,t),e.prototype.validate=function(){c.assert(1===this.x.shape.length,"The input to a softmax must be a 1-D tensor"),c.assert(this.x.shape[0]>=2,"The input to a softmax must have at least 2 values")},e.X="x",e}(f);r.SoftmaxNode=k;var z=function(t){function e(e,r,n){var o=t.call(this,e,"Mean Squared Cost",{label:r,prediction:n},new h([]))||this;return o.label=r,o.prediction=n,o}return o(e,t),e.prototype.validate=function(){c.assert(c.arraysEqual(this.label.shape,this.prediction.shape),"Error adding meanSquaredCost op: label shape ("+this.label.shape+") must match prediction shape ("+this.prediction.shape+").")},e.LABEL="label",e.PREDICTION="prediction",e}(f);r.MeanSquaredCostNode=z;var F=function(t){function e(e,r){var n=t.call(this,e,"ArgMax",{x:r},new h([1]))||this;return n.x=r,n}return o(e,t),e.prototype.validate=function(){c.assert(c.sizeFromShape(this.x.shape)>0,"Error adding argmax op: input tensor must have at least one entry.")},e.X="x",e}(f);r.ArgMaxNode=F;var V=function(t){function e(e,r,n){var o=t.call(this,e,"ArgMaxEquals",{x1:r,x2:n},new h([1]))||this;return o.x1=r,o.x2=n,o}return o(e,t),e.prototype.validate=function(){c.assert(c.arraysEqual(this.x1.shape,this.x2.shape),"Error adding ArgMaxEquals op: x1 shape ("+this.x1.shape+") must match x2 shape ("+this.x2.shape+").")},e.X1="x1",e.X2="x2",e}(f);r.ArgMaxEqualsNode=V},{"../initializers":52,"../math/concat_util":54,"../math/conv_util":55,"../math/ndarray":61,"../util":94}],17:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./graph"),o=t("./priority_queue"),a=t("./priority_queue");r.getUnorderedEvaluationSet=function(t,e){var r={},n={},o=[],a=t.slice();e.forEach(function(t){return r[t.id]=t});for(;0!==a.length;)!function(){var t=a.pop();null==n[t.id]&&(null==r[t.id]&&Object.keys(t.inputs).map(function(e){return t.inputs[e]}).forEach(function(t){return a.push(t.node)}),o.push(t),n[t.id]=t)}();return o},r.getOrderedEvaluationSet=function(t){var e=[],r={},n={},i=new a.PriorityQueue(function(t,e){return o.defaultCompare(n[t.id],n[e.id])},function(t,e){return r[t.id]=e});for(t.forEach(function(t){return n[t.id]=0}),t.forEach(function(e){return Object.keys(e.inputs).map(function(t){return e.inputs[t]}).forEach(function(e){-1!==t.indexOf(e.node)&&n[e.node.id]++})}),t.forEach(function(t){return i.enqueue(t)});!i.empty();)e.unshift(i.dequeue()),Object.keys(e[0].inputs).map(function(t){return e[0].inputs[t]}).forEach(function(e){-1!==t.indexOf(e.node)&&(n[e.node.id]--,i.update(e.node,r[e.node.id]))});return e},r.isInputNode=function(t){return 0===Object.keys(t.inputs).length},r.shouldBackProp=function(t){return!(t.node instanceof n.ConstantNode)},r.isPassthroughNode=function(t,e){for(var r=Object.keys(t.inputs),n=0;n<r.length;n++){var o=t.inputs[r[n]];if(e.get(o,!0)===e.get(t.output,!0))return!0}return!1}},{"./graph":16,"./priority_queue":46}],18:[function(t,e,r){"use strict";function n(t){if(t instanceof o.ReshapeNode)return[new w.Reshape(t.inputs[o.ReshapeNode.X],t.output)];if(t instanceof o.MatMulNode){var e=t.inputs[o.MatMulNode.X1],r=t.inputs[o.MatMulNode.X2];return[new g.MatMul(e,r,t.output)]}if(t instanceof o.Convolution2DNode){var n=t.inputs[o.Convolution2DNode.W],T=t.inputs[o.Convolution2DNode.X],E=t.inputs[o.Convolution2DNode.B];return[new p.Convolution2D(n,T,E,t.output,t.fieldSize,t.outputDepth,t.stride,t.zeroPad)]}if(t instanceof o.MaxPoolNode){T=t.inputs[o.MaxPoolNode.X];return[new y.MaxPool(T,t.output,t.fieldSize,t.stride,t.zeroPad)]}if(t instanceof o.ExpNode)return[new d.Exp(t.inputs[o.ExpNode.X],t.output)];if(t instanceof o.LogNode)return[new m.Log(t.inputs[o.LogNode.X],t.output)];if(t instanceof o.ReLUNode)return[new h.ReLU(t.inputs[o.ReLUNode.X],t.output)];if(t instanceof o.TanHNode)return[new h.TanH(t.inputs[o.TanHNode.X],t.output)];if(t instanceof o.SigmoidNode)return[new h.Sigmoid(t.inputs[o.SigmoidNode.X],t.output)];if(t instanceof o.SoftmaxCrossEntropyCostNode){var T=t.inputs[o.SoftmaxCrossEntropyCostNode.X],S=t.inputs[o.SoftmaxCrossEntropyCostNode.TARGET];return[new _.SoftmaxCrossEntropyCost(T,S,t.output)]}if(t instanceof o.SoftmaxNode)return[new _.Softmax(t.inputs[o.SoftmaxNode.X],t.output)];if(t instanceof o.MeanSquaredCostNode){var C=t.inputs[o.MeanSquaredCostNode.LABEL],M=t.inputs[o.MeanSquaredCostNode.PREDICTION];return[new f.MeanSquaredCost(C,M,t.output)]}if(t instanceof o.ArgMaxEqualsNode)return[new u.ArgMaxEquals(t.inputs[o.ArgMaxEqualsNode.X1],t.inputs[o.ArgMaxEqualsNode.X2],t.output)];if(t instanceof o.ArgMaxNode)return[new s.ArgMax(t.x,t.output)];if(t instanceof o.FusedLinearCombinationNode)return[new v.LinearCombination(t.inputs[o.FusedLinearCombinationNode.T1],t.inputs[o.FusedLinearCombinationNode.T2],t.inputs[o.FusedLinearCombinationNode.C1],t.inputs[o.FusedLinearCombinationNode.C2],t.output)];if(t instanceof o.Concat3DNode)return[new c.Concat3D(t.inputs[o.Concat3DNode.X1],t.inputs[o.Concat3DNode.X2],t.axis,t.output)];if(t instanceof o.SquareNode)return[new h.Square(t.inputs[o.SquareNode.X],t.output)];if(t instanceof o.AddNode)return[new i.Add(t.inputs[o.AddNode.T1],t.inputs[o.AddNode.T2],t.output)];if(t instanceof o.SubtractNode)return[new A.Subtract(t.inputs[o.SubtractNode.T1],t.inputs[o.SubtractNode.T2],t.output)];if(t instanceof o.MultiplyNode)return[new x.Multiply(t.inputs[o.MultiplyNode.T1],t.inputs[o.MultiplyNode.T2],t.output)];if(t instanceof o.DivideNode)return[new l.Divide(t.inputs[o.DivideNode.T1],t.inputs[o.DivideNode.T2],t.output)];if(t instanceof o.ReduceSumNode)return[new b.ReduceSum(t.inputs[o.ReduceSumNode.X],t.output)];if(a.isInputNode(t))return[];throw Error("Unsupported node type: "+t.constructor.name)}Object.defineProperty(r,"__esModule",{value:!0});var o=t("./graph"),a=t("./graph_util"),i=t("./ops/add"),s=t("./ops/argmax"),u=t("./ops/argmaxequals"),c=t("./ops/concat3d"),p=t("./ops/convolution"),l=t("./ops/divide"),h=t("./ops/element_wise_activation"),f=t("./ops/element_wise_cost"),d=t("./ops/exp"),v=t("./ops/linear_combination"),m=t("./ops/log"),g=t("./ops/matmul"),y=t("./ops/max_pool"),x=t("./ops/multiply"),b=t("./ops/reduce_sum"),w=t("./ops/reshape"),_=t("./ops/softmax"),A=t("./ops/subtract");r.emitFromGraphNodes=function(t){var e=[];return t.forEach(function(t){return Array.prototype.push.apply(e,n(t))}),e}},{"./graph":16,"./graph_util":17,"./ops/add":19,"./ops/argmax":20,"./ops/argmaxequals":21,"./ops/concat3d":22,"./ops/convolution":23,"./ops/divide":24,"./ops/element_wise_activation":25,"./ops/element_wise_cost":26,"./ops/exp":27,"./ops/linear_combination":28,"./ops/log":29,"./ops/matmul":30,"./ops/max_pool":31,"./ops/multiply":32,"./ops/reduce_sum":34,"./ops/reshape":35,"./ops/softmax":36,"./ops/subtract":37}],19:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/ndarray"),a=t("../../util"),i=t("../graph_util"),s=function(t){function e(e,r,n){var o=t.call(this)||this;return o.x1Tensor=e,o.x2Tensor=r,o.yTensor=n,a.assert(1===a.sizeFromShape(e.shape)||1===a.sizeFromShape(r.shape)||a.arraysEqual(e.shape,r.shape),"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape"),o}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.x1Tensor),o=e.get(this.x2Tensor);t.scope(function(i){var s;s=a.isScalarShape(n.shape)?t.scalarPlusArray(n,o):a.isScalarShape(o.shape)?t.scalarPlusArray(o,n):t.add(n,o),e.set(r.yTensor,i(s))})},e.prototype.backProp=function(t,e,r){var n=this,s=r.get(this.yTensor);t.scope(function(){if(i.shouldBackProp(n.x1Tensor))if(a.isScalarShape(n.x1Tensor.shape)){e=t.sum(s);null==n.dySizeScalar&&(n.dySizeScalar=o.Scalar.new(s.size)),r.add(n.x1Tensor,t.divide(e,n.dySizeScalar))}else r.add(n.x1Tensor,t.clone(s));if(i.shouldBackProp(n.x2Tensor))if(a.isScalarShape(n.x2Tensor.shape)){var e=t.sum(s);null==n.dySizeScalar&&(n.dySizeScalar=o.Scalar.new(s.size)),r.add(n.x2Tensor,t.divide(e,n.dySizeScalar))}else r.add(n.x2Tensor,t.clone(s))})},e.prototype.dispose=function(){null!=this.dySizeScalar&&this.dySizeScalar.dispose()},e}(t("./op").Operation);r.Add=s},{"../../math/ndarray":61,"../../util":94,"../graph_util":17,"./op":33}],20:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=function(t){function e(e,r){var n=t.call(this)||this;return n.xTensor=e,n.yTensor=r,n}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.xTensor);t.scope(function(o){e.set(r.yTensor,o(t.argMax(n)))})},e.prototype.backProp=function(t,e,r){throw new Error("ArgMax backprop unimplemented")},e}(t("./op").Operation);r.ArgMax=o},{"./op":33}],21:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=function(t){function e(e,r,n){var o=t.call(this)||this;return o.x1Tensor=e,o.x2Tensor=r,o.yTensor=n,o}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.x1Tensor),o=e.get(this.x2Tensor);t.scope(function(a){e.set(r.yTensor,a(t.argMaxEquals(n,o)))})},e.prototype.backProp=function(t,e,r){throw new Error("ArgMaxEquals backprop unimplemented")},e}(t("./op").Operation);r.ArgMaxEquals=o},{"./op":33}],22:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/concat_util"),a=function(t){function e(e,r,n,a){var i=t.call(this)||this;return i.x1Tensor=e,i.x2Tensor=r,i.axis=n,i.yTensor=a,o.assertParams(e.shape,r.shape,n),i}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.x1Tensor),o=e.get(this.x2Tensor);t.scope(function(a){var i=t.concat3D(n,o,r.axis);e.set(r.yTensor,a(i))})},e.prototype.backProp=function(t,e,r){throw new Error("Concat3D backprop not implemented.")},e}(t("./op").Operation);r.Concat3D=a},{"../../math/concat_util":54,"./op":33}],23:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/conv_util"),a=t("../../util"),i=function(t){function e(e,r,n,i,s,u,c,p){void 0===c&&(c=1);var l=t.call(this)||this;return l.wTensor=e,l.xTensor=r,l.bTensor=n,l.yTensor=i,l.fieldSize=s,l.outputDepth=u,l.stride=c,l.assertWeightsShape(e.shape),l.zeroPad=null!=p?p:o.computeDefaultPad(l.xTensor.shape,l.fieldSize,l.stride),a.assert(a.isInt(l.zeroPad),"The zero padding ("+l.zeroPad+") must be an integer. Change the stride and/or zero pad parameters"),l}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.wTensor),o=e.get(this.bTensor),a=e.get(this.xTensor);t.scope(function(i){e.set(r.yTensor,i(t.conv2d(a,n,o,r.stride,r.zeroPad)))})},e.prototype.backProp=function(t,e,r){var n=this,o=e.get(this.wTensor),a=e.get(this.xTensor),i=r.get(this.yTensor);t.scope(function(){var e=t.conv2dBackProp(a,i,o,n.stride,n.zeroPad),s=e.dw,u=e.db,c=e.dx;r.add(n.wTensor,s),r.add(n.bTensor,u),r.add(n.xTensor,c)})},e.prototype.assertWeightsShape=function(t){a.assert(t[0]===this.fieldSize&&t[1]===this.fieldSize&&t[2]===this.xTensor.shape[2]&&t[3]===this.outputDepth,"weights must be of shape ["+this.fieldSize+","+this.fieldSize+","+this.xTensor.shape[2]+","+this.outputDepth+"] but they are ofshape ["+t+"]")},e}(t("./op").Operation);r.Convolution2D=i},{"../../math/conv_util":55,"../../util":94,"./op":33}],24:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../util"),a=t("../graph_util"),i=function(t){function e(e,r,n){var a=t.call(this)||this;return a.x1Tensor=e,a.x2Tensor=r,a.yTensor=n,o.assert(1===o.sizeFromShape(e.shape)||1===o.sizeFromShape(r.shape)||o.arraysEqual(e.shape,r.shape),"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape"),a}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.x1Tensor),a=e.get(this.x2Tensor);t.scope(function(i){var s;s=o.isScalarShape(n.shape)?t.scalarDividedByArray(n,a):o.isScalarShape(a.shape)?t.arrayDividedByScalar(n,a):t.divide(n,a),e.set(r.yTensor,i(s))})},e.prototype.backProp=function(t,e,r){var n=this,i=e.get(this.x1Tensor),s=e.get(this.x2Tensor),u=r.get(this.yTensor),c=o.isScalarShape(i.shape),p=o.isScalarShape(s.shape);t.scope(function(){if(a.shouldBackProp(n.x1Tensor))if(c){var e=t.divide(u,s);r.add(n.x1Tensor,t.sum(e)),e.dispose()}else p?r.add(n.x1Tensor,t.arrayDividedByScalar(u,s)):r.add(n.x1Tensor,t.divide(u,s));if(a.shouldBackProp(n.x2Tensor)){var o=t.elementWiseMul(s,s),l=void 0;l=p?t.arrayDividedByScalar(i,o):c?t.scalarDividedByArray(i,o):t.divide(i,o);var h=t.neg(l),f=t.elementWiseMul(u,h);p?r.add(n.x2Tensor,t.sum(f)):r.add(n.x2Tensor,f)}})},e}(t("./op").Operation);r.Divide=i},{"../../util":94,"../graph_util":17,"./op":33}],25:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/activation_functions"),a=function(t){function e(e,r,n){var o=t.call(this)||this;return o.xTensor=e,o.yTensor=r,o.func=n,o}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.xTensor);t.scope(function(o){e.set(r.yTensor,o(r.func.output(t,n)))})},e.prototype.backProp=function(t,e,r){var n=this,o=e.get(this.xTensor),a=e.get(this.yTensor),i=r.get(this.yTensor);t.scope(function(){var e=n.func.der(t,o,a);r.add(n.xTensor,t.elementWiseMul(i,e)),e.dispose()})},e}(t("./op").Operation);r.ElementWiseActivation=a;var i=function(t){function e(e,r){return t.call(this,e,r,new o.ReLUFunc)||this}return n(e,t),e}(a);r.ReLU=i;var s=function(t){function e(e,r){return t.call(this,e,r,new o.TanHFunc)||this}return n(e,t),e}(a);r.TanH=s;var u=function(t){function e(e,r){return t.call(this,e,r,new o.SigmoidFunc)||this}return n(e,t),e}(a);r.Sigmoid=u;var c=function(t){function e(e,r){return t.call(this,e,r,new o.SquareFunc)||this}return n(e,t),e}(a);r.Square=c},{"../../math/activation_functions":53,"./op":33}],26:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/cost_functions"),a=t("../../math/ndarray"),i=t("../../util"),s=t("../graph_util"),u=function(t){function e(e,r,n,o){var s=t.call(this)||this;return s.x1Tensor=e,s.x2Tensor=r,s.yTensor=n,s.func=o,s.oneOverNScalar=a.Scalar.new(1/i.sizeFromShape(e.shape)),s}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.x1Tensor),o=e.get(this.x2Tensor);t.scope(function(a){var i=r.func.cost(t,n,o),s=t.sum(i),u=t.scalarTimesArray(r.oneOverNScalar,s);e.set(r.yTensor,a(u))})},e.prototype.backProp=function(t,e,r){var n=this,o=e.get(this.x1Tensor),a=e.get(this.x2Tensor);t.scope(function(){s.shouldBackProp(n.x1Tensor)&&r.add(n.x1Tensor,n.func.der(t,o,a)),s.shouldBackProp(n.x2Tensor)&&r.add(n.x2Tensor,n.func.der(t,a,o))})},e.prototype.dispose=function(){this.func.dispose(),this.oneOverNScalar.dispose()},e}(t("./op").Operation);r.ElementWiseCost=u;var c=function(t){function e(e,r,n){return t.call(this,e,r,n,new o.SquareCostFunc)||this}return n(e,t),e}(u);r.MeanSquaredCost=c},{"../../math/cost_functions":57,"../../math/ndarray":61,"../../util":94,"../graph_util":17,"./op":33}],27:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../graph_util"),a=function(t){function e(e,r){var n=t.call(this)||this;return n.xTensor=e,n.yTensor=r,n}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.xTensor);t.scope(function(o){e.set(r.yTensor,o(t.exp(n)))})},e.prototype.backProp=function(t,e,r){var n=this,a=e.get(this.yTensor),i=r.get(this.yTensor);t.scope(function(){o.shouldBackProp(n.xTensor)&&r.add(n.xTensor,t.elementWiseMul(a,i))})},e}(t("./op").Operation);r.Exp=a},{"../graph_util":17,"./op":33}],28:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../graph_util"),a=function(t){function e(e,r,n,o,a){var i=t.call(this)||this;return i.x1Tensor=e,i.x2Tensor=r,i.c1Tensor=n,i.c2Tensor=o,i.outTensor=a,i}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.x1Tensor),o=e.get(this.x2Tensor),a=e.get(this.c1Tensor).asScalar(),i=e.get(this.c2Tensor).asScalar();t.scope(function(s){e.set(r.outTensor,s(t.scaledArrayAdd(a,n,i,o)))})},e.prototype.backProp=function(t,e,r){var n=this,a=e.get(this.x1Tensor),i=e.get(this.x2Tensor),s=e.get(this.c1Tensor),u=e.get(this.c2Tensor),c=r.get(this.outTensor);t.scope(function(){if(o.shouldBackProp(n.x1Tensor)&&r.add(n.x1Tensor,t.scalarTimesArray(s,c)),o.shouldBackProp(n.x2Tensor)&&r.add(n.x2Tensor,t.scalarTimesArray(u,c)),o.shouldBackProp(n.c1Tensor)){var e=t.elementWiseMul(a,c);r.add(n.c1Tensor,t.sum(e))}if(o.shouldBackProp(n.c2Tensor)){var p=t.elementWiseMul(i,c);r.add(n.c2Tensor,t.sum(p))}})},e}(t("./op").Operation);r.LinearCombination=a},{"../graph_util":17,"./op":33}],29:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../graph_util"),a=function(t){function e(e,r){var n=t.call(this)||this;return n.xTensor=e,n.yTensor=r,n}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.xTensor);t.scope(function(o){e.set(r.yTensor,o(t.log(n)))})},e.prototype.backProp=function(t,e,r){var n=this,a=e.get(this.xTensor),i=r.get(this.yTensor);t.scope(function(){o.shouldBackProp(n.xTensor)&&r.add(n.xTensor,t.divide(i,a))})},e}(t("./op").Operation);r.Log=a},{"../graph_util":17,"./op":33}],30:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/math"),a=t("../graph_util"),i=function(t){function e(e,r,n){var o=t.call(this)||this;return o.x1Tensor=e,o.x2Tensor=r,o.yTensor=n,o}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.x1Tensor),o=e.get(this.x2Tensor);t.scope(function(a){2===n.shape.length&&2===o.shape.length?e.set(r.yTensor,a(t.matMul(n,o))):2===n.shape.length&&1===o.shape.length?e.set(r.yTensor,a(t.matrixTimesVector(n,o))):1===n.shape.length&&2===o.shape.length&&e.set(r.yTensor,a(t.vectorTimesMatrix(n,o)))})},e.prototype.backProp=function(t,e,r){var n=this,i=e.get(this.x1Tensor),s=e.get(this.x2Tensor),u=r.get(this.yTensor);1===i.shape.length&&(i=i.reshape([1,i.size]),u=u.reshape([1,u.size])),1===s.shape.length&&(s=s.reshape([s.size,1]),u=u.reshape([u.size,1])),t.scope(function(){if(a.shouldBackProp(n.x1Tensor)){var e=t.matMul(u,s,o.MatrixOrientation.REGULAR,o.MatrixOrientation.TRANSPOSED);r.add(n.x1Tensor,1===n.x1Tensor.shape.length?e.as1D():e)}if(a.shouldBackProp(n.x2Tensor)){var c=t.matMul(i,u,o.MatrixOrientation.TRANSPOSED,o.MatrixOrientation.REGULAR);r.add(n.x2Tensor,1===n.x2Tensor.shape.length?c.as1D():c)}})},e}(t("./op").Operation);r.MatMul=i},{"../../math/math":58,"../graph_util":17,"./op":33}],31:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/conv_util"),a=t("../../util"),i=function(t){function e(e,r,n,i,s){void 0===i&&(i=1);var u=t.call(this)||this;return u.xTensor=e,u.yTensor=r,u.fieldSize=n,u.stride=i,u.pad=null!=s?s:o.computeDefaultPad(e.shape,u.fieldSize,u.stride),a.assert(a.isInt(u.pad),"The zero padding ("+u.pad+") must be an integer. Change the stride and/or zero pad parameters"),u}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.xTensor);t.scope(function(o){e.set(r.yTensor,o(t.maxPool(n,r.fieldSize,r.stride,r.pad)))})},e.prototype.backProp=function(t,e,r){var n=this,o=e.get(this.xTensor),a=r.get(this.yTensor);t.scope(function(){r.add(n.xTensor,t.maxPoolBackprop(a,o,n.fieldSize,n.stride,n.pad))})},e}(t("./op").Operation);r.MaxPool=i},{"../../math/conv_util":55,"../../util":94,"./op":33}],32:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../util"),a=t("../graph_util"),i=function(t){function e(e,r,n){var a=t.call(this)||this;return a.x1Tensor=e,a.x2Tensor=r,a.yTensor=n,o.assert(1===o.sizeFromShape(e.shape)||1===o.sizeFromShape(r.shape)||o.arraysEqual(e.shape,r.shape),"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape"),a}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.x1Tensor),a=e.get(this.x2Tensor);t.scope(function(i){var s;s=o.isScalarShape(n.shape)?t.scalarTimesArray(n,a):o.isScalarShape(a.shape)?t.scalarTimesArray(a,n):t.elementWiseMul(n,a),e.set(r.yTensor,i(s))})},e.prototype.backProp=function(t,e,r){var n=this,i=e.get(this.x1Tensor),s=e.get(this.x2Tensor),u=r.get(this.yTensor);t.scope(function(){if(a.shouldBackProp(n.x1Tensor))if(o.isScalarShape(n.x1Tensor.shape)){e=t.elementWiseMul(u,s);r.add(n.x1Tensor,t.sum(e))}else o.isScalarShape(s.shape)?r.add(n.x1Tensor,t.scalarTimesArray(s,u)):r.add(n.x1Tensor,t.elementWiseMul(s,u));if(a.shouldBackProp(n.x2Tensor))if(o.isScalarShape(n.x2Tensor.shape)){var e=t.elementWiseMul(u,i);r.add(n.x2Tensor,t.sum(e))}else o.isScalarShape(i.shape)?r.add(n.x2Tensor,t.scalarTimesArray(i,u)):r.add(n.x2Tensor,t.elementWiseMul(i,u))})},e}(t("./op").Operation);r.Multiply=i},{"../../util":94,"../graph_util":17,"./op":33}],33:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.disposeTransientArrays=function(t,e){},t.prototype.dispose=function(){},t}();r.Operation=n},{}],34:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/ndarray"),a=t("../../util"),i=t("../graph_util"),s=function(t){function e(e,r){var n=t.call(this)||this;return n.x=e,n.outTensor=r,a.assertShapesMatch(r.shape,[]),n}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.x);t.scope(function(o){e.set(r.outTensor,o(t.sum(n)))})},e.prototype.backProp=function(t,e,r){var n=this;i.shouldBackProp(this.x)&&t.scope(function(){var a=r.get(n.outTensor);if(null==n.ones){var i=e.get(n.x);n.ones=o.NDArray.zerosLike(i),n.ones.fill(1)}r.add(n.x,t.scalarTimesArray(a,n.ones))})},e}(t("./op").Operation);r.ReduceSum=s},{"../../math/ndarray":61,"../../util":94,"../graph_util":17,"./op":33}],35:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../util"),a=function(t){function e(e,r){var n=t.call(this)||this;n.xTensor=e,n.yTensor=r;var a=o.sizeFromShape(e.shape),i=o.sizeFromShape(r.shape);return o.assert(a===i,"The input size ("+a+") and output size ("+i+") must match"),n}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.xTensor);t.scope(function(t){e.set(r.yTensor,t(n.reshape(r.yTensor.shape)))})},e.prototype.backProp=function(t,e,r){var n=this,o=r.get(this.yTensor);t.scope(function(){r.add(n.xTensor,o.reshape(n.xTensor.shape))})},e}(t("./op").Operation);r.Reshape=a},{"../../util":94,"./op":33}],36:[function(t,e,r){"use strict";function n(t,e,r,n){return i.assert(e.size===r.size,"The output and target must be the same size"),t.scope(function(){var o=t.scalarPlusArray(n,e),a=t.log(o),i=t.elementWiseMul(r,a),s=t.neg(i);return t.sum(s)})}var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../math/ndarray"),i=t("../../util"),s=t("../graph"),u=t("./op"),c=function(t){function e(e,r){var n=t.call(this)||this;return n.logitsTensor=e,n.output=r,n}return o(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.logitsTensor);return t.scope(function(o){e.set(r.output,o(t.softmax(n)))})},e.prototype.backProp=function(){throw Error("Softmax backprop is not yet implemented")},e}(u.Operation);r.Softmax=c;var p=function(t){function e(e,r,n){var o=t.call(this)||this;return o.logitsTensor=e,o.labelTensor=r,o.yTensor=n,o.epsilon=a.Scalar.new(1e-5),o.softmaxTensor=new s.Tensor(e.shape),o}return o(e,t),e.prototype.feedForward=function(t,e){var r=this,o=e.get(this.logitsTensor),a=e.get(this.labelTensor);t.scope(function(i){var s=t.softmax(o);e.set(r.softmaxTensor,i(s)),e.set(r.yTensor,i(n(t,s,a,r.epsilon)))})},e.prototype.backProp=function(t,e,r){var n=this,o=e.get(this.softmaxTensor),a=e.get(this.labelTensor);t.scope(function(){r.add(n.logitsTensor,t.sub(o,a))})},e.prototype.disposeTransientArrays=function(t,e){t.disposeArray(this.softmaxTensor)},e.prototype.dispose=function(){this.epsilon.dispose()},e}(u.Operation);r.SoftmaxCrossEntropyCost=p,r.crossEntropyCost=n},{"../../math/ndarray":61,"../../util":94,"../graph":16,"./op":33}],37:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/ndarray"),a=t("../../util"),i=t("../graph_util"),s=function(t){function e(e,r,n){var o=t.call(this)||this;return o.t1=e,o.t2=r,o.outTensor=n,a.assert(1===a.sizeFromShape(e.shape)||1===a.sizeFromShape(r.shape)||a.arraysEqual(e.shape,r.shape),"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape"),o}return n(e,t),e.prototype.feedForward=function(t,e){var r=this,n=e.get(this.t1),o=e.get(this.t2);t.scope(function(i){var s;s=a.isScalarShape(n.shape)?t.scalarMinusArray(n,o):a.isScalarShape(o.shape)?t.arrayMinusScalar(n,o):t.sub(n,o),e.set(r.outTensor,i(s))})},e.prototype.backProp=function(t,e,r){var n=this,s=r.get(this.outTensor);t.scope(function(){if(i.shouldBackProp(n.t1))if(a.isScalarShape(n.t1.shape)){e=t.sum(s);null==n.dySizeScalar&&(n.dySizeScalar=o.Scalar.new(s.size)),r.add(n.t1,t.divide(e,n.dySizeScalar))}else r.add(n.t1,t.clone(s));if(i.shouldBackProp(n.t2))if(a.isScalarShape(n.t2.shape)){var e=t.sum(s),u=t.neg(e);null==n.dySizeScalar&&(n.dySizeScalar=o.Scalar.new(s.size)),r.add(n.t2,t.divide(u,n.dySizeScalar))}else r.add(n.t2,t.neg(s))})},e.prototype.dispose=function(){null!=this.dySizeScalar&&this.dySizeScalar.dispose()},e}(t("./op").Operation);r.Subtract=s},{"../../math/ndarray":61,"../../util":94,"../graph_util":17,"./op":33}],38:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/ndarray"),a=t("../tensor_array_map"),i=function(t){function e(e,r,n){var i=t.call(this,e,n)||this;return i.learningRate=e,i.gamma=r,i.accumulatedSquaredGradients=new a.TensorArrayMap,i.accumulatedUpdates=new a.TensorArrayMap,i.eps=o.Scalar.new(1e-6),i.g=o.Scalar.new(i.gamma),i}return n(e,t),e.prototype.beforeBatch=function(e,r,n,a,i){var s=this;t.prototype.beforeBatch.call(this,e,r,n,a,i),0===this.accumulatedSquaredGradients.size()&&this.variableNodes.forEach(function(t){s.accumulatedSquaredGradients.set(t.output,o.NDArray.zeros(t.output.shape)),s.accumulatedUpdates.set(t.output,o.NDArray.zeros(t.output.shape))})},e.prototype.afterBatch=function(t,e,r,n,o){var i=this;t.scope(function(e){i.variableNodes.forEach(function(r){var o=n.get(r.output),a=i.variableGradients.get(r.output),s=i.accumulatedSquaredGradients.get(r.output),u=i.accumulatedUpdates.get(r.output),c=t.multiply(a,a),p=t.scaledArrayAdd(i.g,s,t.sub(i.one,i.g),c),l=t.multiply(t.divide(t.sqrt(t.add(u,i.eps)),t.sqrt(t.add(s,i.eps))),a),h=t.scaledArrayAdd(i.c,l,i.one,o),f=t.multiply(l,l),d=t.scaledArrayAdd(i.g,u,t.sub(i.one,i.g),f);i.accumulatedSquaredGradients.set(r.output,e(p)),i.accumulatedUpdates.set(r.output,e(d)),n.set(r.output,e(h)),r.data=h,o.dispose(),s.dispose(),u.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new a.TensorArrayMap},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.eps.dispose(),this.g.dispose(),this.accumulatedSquaredGradients.dispose(),this.accumulatedUpdates.dispose()},e}(t("./optimizer").Optimizer);r.AdadeltaOptimizer=i},{"../../math/ndarray":61,"../tensor_array_map":49,"./optimizer":43}],39:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/ndarray"),a=t("../tensor_array_map"),i=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.learningRate=e,n.accumulatedSquaredGradients=new a.TensorArrayMap,n.eps=o.Scalar.new(1e-6),n}return n(e,t),e.prototype.beforeBatch=function(e,r,n,a,i){var s=this;t.prototype.beforeBatch.call(this,e,r,n,a,i),0===this.accumulatedSquaredGradients.size()&&this.variableNodes.forEach(function(t){s.accumulatedSquaredGradients.set(t.output,o.NDArray.zeros(t.output.shape))})},e.prototype.afterBatch=function(t,e,r,n,o){var i=this;t.scope(function(e){i.variableNodes.forEach(function(r){var o=n.get(r.output),a=i.variableGradients.get(r.output),s=i.accumulatedSquaredGradients.get(r.output),u=t.multiply(a,a),c=t.add(s,u),p=t.scaledArrayAdd(i.c,t.divide(a,t.add(t.sqrt(c),i.eps)),i.one,o);i.accumulatedSquaredGradients.set(r.output,e(c)),n.set(r.output,e(p)),r.data=p,o.dispose(),s.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new a.TensorArrayMap},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.eps.dispose(),this.accumulatedSquaredGradients.dispose()},e}(t("./optimizer").Optimizer);r.AdagradOptimizer=i},{"../../math/ndarray":61,"../tensor_array_map":49,"./optimizer":43}],40:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/ndarray"),a=t("../tensor_array_map"),i=function(t){function e(e,r,n,i){var s=t.call(this,e,i)||this;return s.learningRate=e,s.beta1=r,s.beta2=n,s.firstMoment=new a.TensorArrayMap,s.secondMoment=new a.TensorArrayMap,s.eps=o.Scalar.new(1e-8),s.b1=o.Scalar.new(s.beta1),s.b2=o.Scalar.new(s.beta2),s.accB1=o.Scalar.new(s.beta1),s.accB2=o.Scalar.new(s.beta2),s}return n(e,t),e.prototype.beforeBatch=function(e,r,n,a,i){var s=this;t.prototype.beforeBatch.call(this,e,r,n,a,i),0===this.firstMoment.size()&&this.variableNodes.forEach(function(t){s.firstMoment.set(t.output,o.NDArray.zeros(t.output.shape))}),0===this.secondMoment.size()&&this.variableNodes.forEach(function(t){s.secondMoment.set(t.output,o.NDArray.zeros(t.output.shape))})},e.prototype.afterBatch=function(t,e,r,n,o){var i=this;t.scope(function(e){i.variableNodes.forEach(function(r){var o=n.get(r.output),a=i.variableGradients.get(r.output),s=i.firstMoment.get(r.output),u=i.secondMoment.get(r.output),c=t.scaledArrayAdd(i.b1,s,t.sub(i.one,i.b1),a),p=t.multiply(a,a),l=t.scaledArrayAdd(i.b2,u,t.sub(i.one,i.b2),p),h=t.divide(c,t.sub(i.one,i.accB1)),f=t.divide(l,t.sub(i.one,i.accB2)),d=t.scaledArrayAdd(i.c,t.divide(h,t.add(t.sqrt(f),i.eps)),i.one,o);n.set(r.output,e(d)),r.data=d,i.firstMoment.set(r.output,e(c)),i.secondMoment.set(r.output,e(l)),o.dispose(),a.dispose(),s.dispose(),u.dispose()}),i.accB1=e(t.multiply(i.accB1,i.b1)),i.accB2=e(t.multiply(i.accB2,i.b2))}),this.variableGradients.dispose(),this.variableGradients=new a.TensorArrayMap},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.firstMoment.dispose(),this.secondMoment.dispose(),this.eps.dispose(),this.b1.dispose(),this.b2.dispose(),this.accB1.dispose(),this.accB2.dispose()},e}(t("./optimizer").Optimizer);r.AdamOptimizer=i},{"../../math/ndarray":61,"../tensor_array_map":49,"./optimizer":43}],41:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/ndarray"),a=t("../tensor_array_map"),i=function(t){function e(e,r,n,i){var s=t.call(this,e,i)||this;return s.learningRate=e,s.beta1=r,s.beta2=n,s.firstMoment=new a.TensorArrayMap,s.weightedInfNorm=new a.TensorArrayMap,s.b1=o.Scalar.new(s.beta1),s.b2=o.Scalar.new(s.beta2),s}return n(e,t),e.prototype.beforeBatch=function(e,r,n,a,i){var s=this;t.prototype.beforeBatch.call(this,e,r,n,a,i),0===this.firstMoment.size()&&this.variableNodes.forEach(function(t){s.firstMoment.set(t.output,o.NDArray.zeros(t.output.shape))}),0===this.weightedInfNorm.size()&&this.variableNodes.forEach(function(t){s.weightedInfNorm.set(t.output,o.NDArray.zeros(t.output.shape))})},e.prototype.afterBatch=function(t,e,r,n,o){var i=this;t.scope(function(e){i.variableNodes.forEach(function(r){var o=n.get(r.output),a=i.variableGradients.get(r.output),s=i.firstMoment.get(r.output),u=i.weightedInfNorm.get(r.output),c=t.scaledArrayAdd(i.b1,s,t.sub(i.one,i.b1),a),p=t.multiply(i.b2,u),l=t.abs(a),h=t.add(t.relu(t.sub(p,l)),l),f=t.scaledArrayAdd(i.one,o,t.divide(i.c,t.sub(i.one,i.b1)),t.divide(c,h));n.set(r.output,e(f)),r.data=f,i.firstMoment.set(r.output,e(c)),i.weightedInfNorm.set(r.output,e(h)),o.dispose(),a.dispose(),s.dispose(),u.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new a.TensorArrayMap},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.firstMoment.dispose(),this.weightedInfNorm.dispose(),this.eps.dispose(),this.b1.dispose(),this.b2.dispose()},e}(t("./optimizer").Optimizer);r.AdamMaxOptimizer=i},{"../../math/ndarray":61,"../tensor_array_map":49,"./optimizer":43}],42:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/ndarray"),a=t("../tensor_array_map"),i=function(t){function e(e,r,n){var i=t.call(this,e,n)||this;return i.learningRate=e,i.momentum=r,i.variableVelocities=new a.TensorArrayMap,i.m=o.Scalar.new(i.momentum),i}return n(e,t),e.prototype.beforeBatch=function(e,r,n,a,i){var s=this;t.prototype.beforeBatch.call(this,e,r,n,a,i),0===this.variableVelocities.size()&&this.variableNodes.forEach(function(t){s.variableVelocities.set(t.output,o.NDArray.zeros(t.output.shape))})},e.prototype.afterBatch=function(t,e,r,n,o){var i=this;t.scope(function(e){i.variableNodes.forEach(function(r){var o=n.get(r.output),a=i.variableGradients.get(r.output),s=i.variableVelocities.get(r.output),u=t.scaledArrayAdd(i.m,s,i.one,a),c=t.scaledArrayAdd(i.c,u,i.one,o);i.variableVelocities.set(r.output,e(u)),n.set(r.output,e(c)),r.data=c,o.dispose(),s.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new a.TensorArrayMap},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.m.dispose(),this.variableVelocities.dispose()},e.prototype.setMomentum=function(t){this.momentum=t},e}(t("./sgd_optimizer").SGDOptimizer);r.MomentumOptimizer=i},{"../../math/ndarray":61,"../tensor_array_map":49,"./sgd_optimizer":45}],43:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../../math/ndarray"),o=t("../session_util"),a=t("../tensor_array_map"),i=function(){function t(t,e){this.learningRate=t,this.variableGradients=new a.TensorArrayMap,this.one=n.Scalar.new(1),null!=e&&(this.specifiedVariableNodes=e)}return t.prototype.beforeBatch=function(t,e,r,a,i){var s=this;this.variableNodes=null==this.specifiedVariableNodes?o.getVariableNodesFromEvaluationSet(r.nodes):this.specifiedVariableNodes,e!==this.prevBatchSize&&(null!=this.c&&this.c.dispose(),this.prevBatchSize=e,this.c=n.Scalar.new(-this.learningRate/e)),this.variableNodes.forEach(function(t){return s.variableGradients.set(t.output,n.NDArray.zeros(t.output.shape))})},t.prototype.afterExample=function(t,e,r,n){var o=this;t.scope(function(e){o.variableNodes.forEach(function(r){var a=n.get(r.output),i=o.variableGradients.get(r.output);o.variableGradients.set(r.output,e(t.add(a,i))),i.dispose()})})},t.prototype.dispose=function(){null!=this.c&&this.c.dispose(),this.one.dispose()},t}();r.Optimizer=i},{"../../math/ndarray":61,"../session_util":48,"../tensor_array_map":49}],44:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../math/ndarray"),a=t("../tensor_array_map"),i=function(t){function e(e,r,n){var i=t.call(this,e,n)||this;return i.learningRate=e,i.gamma=r,i.accumulatedSquaredGradients=new a.TensorArrayMap,i.eps=o.Scalar.new(1e-6),i.g=o.Scalar.new(i.gamma),i}return n(e,t),e.prototype.beforeBatch=function(e,r,n,a,i){var s=this;t.prototype.beforeBatch.call(this,e,r,n,a,i),0===this.accumulatedSquaredGradients.size()&&this.variableNodes.forEach(function(t){s.accumulatedSquaredGradients.set(t.output,o.NDArray.zeros(t.output.shape))})},e.prototype.afterBatch=function(t,e,r,n,o){var i=this;t.scope(function(e){i.variableNodes.forEach(function(r){var o=n.get(r.output),a=i.variableGradients.get(r.output),s=i.accumulatedSquaredGradients.get(r.output),u=t.multiply(a,a),c=t.scaledArrayAdd(i.g,s,t.sub(i.one,i.g),u),p=t.scaledArrayAdd(i.c,t.divide(a,t.add(t.sqrt(c),i.eps)),i.one,o);i.accumulatedSquaredGradients.set(r.output,e(c)),n.set(r.output,e(p)),r.data=p,o.dispose(),s.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new a.TensorArrayMap},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.eps.dispose(),this.g.dispose(),this.accumulatedSquaredGradients.dispose()},e}(t("./optimizer").Optimizer);r.RMSPropOptimizer=i},{"../../math/ndarray":61,"../tensor_array_map":49,"./optimizer":43}],45:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("../tensor_array_map"),a=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.learningRate=e,n}return n(e,t),e.prototype.afterBatch=function(t,e,r,n,a){var i=this;t.scope(function(e){i.variableNodes.forEach(function(r){var o=n.get(r.output),a=i.variableGradients.get(r.output),s=t.scaledArrayAdd(i.c,a,i.one,o);n.set(r.output,e(s)),r.data=s,o.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new o.TensorArrayMap},e.prototype.dispose=function(){t.prototype.dispose.call(this)},e.prototype.setLearningRate=function(t){this.learningRate=t},e}(t("./optimizer").Optimizer);r.SGDOptimizer=a},{"../tensor_array_map":49,"./optimizer":43}],46:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defaultCompare=function(t,e){return t===e?0:t<e?-1:1};var n=function(){function t(t,e){this.comparator=t,this.indexObserver=e,this.heap=[]}return t.prototype.enqueue=function(t){this.heap.push(t),this.onIndexChanged(t,this.heap.length-1),this.siftUp(this.heap.length-1)},t.prototype.dequeue=function(){if(this.empty())throw new Error("dequeue called on empty priority queue.");var t=this.heap[0];return this.swap(0,this.heap.length-1),this.heap.pop(),this.siftDown(0),t},t.prototype.update=function(t,e){var r=e===this.heap.length-1;r||this.swap(e,this.heap.length-1),this.heap.pop(),r||(-1!==this.siftUpIndex(e)?this.siftUp(e):-1!==this.siftDownIndex(e)&&this.siftDown(e)),this.enqueue(t)},t.prototype.empty=function(){return 0===this.heap.length},t.prototype.onIndexChanged=function(t,e){this.indexObserver&&this.indexObserver(t,e)},t.prototype.getParentIndex=function(t){return 0===t?-1:Math.floor((t-1)/2)},t.prototype.getLeftChildIndex=function(t){var e=2*t+1;return e<this.heap.length?e:-1},t.prototype.getRightChildIndex=function(t){var e=2*t+2;return e<this.heap.length?e:-1},t.prototype.siftUpIndex=function(t){var e=this.getParentIndex(t);return-1===e?-1:this.compare(e,t)>0?e:-1},t.prototype.siftUp=function(t){for(var e=this.siftUpIndex(t);-1!==e;)this.swap(t,e),t=e,e=this.siftUpIndex(t)},t.prototype.siftDownIndex=function(t){if(t>=this.heap.length)return-1;var e=t,r=this.getLeftChildIndex(t);-1!==r&&this.compare(r,e)<0&&(e=r);var n=this.getRightChildIndex(t);return-1!==n&&this.compare(n,e)<0&&(e=n),e===t?-1:e},t.prototype.siftDown=function(t){for(var e=this.siftDownIndex(t);-1!==e;)this.swap(t,e),t=e,e=this.siftDownIndex(t)},t.prototype.compare=function(t,e){return this.comparator(this.heap[t],this.heap[e])},t.prototype.swap=function(t,e){var r=this.heap[t];this.heap[t]=this.heap[e],this.heap[e]=r,this.onIndexChanged(this.heap[t],t),this.onIndexChanged(this.heap[e],e)},t}();r.PriorityQueue=n},{}],47:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../math/ndarray"),o=t("../util"),a=t("./operation_emitter"),i=t("./session_util"),s=t("./tensor_array_map"),u=function(){return function(t){var e=this;this.dict={},t&&t.forEach(function(t){return e.dict[t.tensor.id]=t})}}();r.FeedDictionary=u;var c;!function(t){t[t.NONE=0]="NONE",t[t.SUM=1]="SUM",t[t.MEAN=2]="MEAN"}(c=r.CostReduction||(r.CostReduction={}));var p=function(){function t(t,e){this.math=e,this.activationArrayMap=new s.TensorArrayMap,this.runtimeCache={},this.oneScalar=n.Scalar.new(1),this.gradientArrayMap=new s.SummedTensorArrayMap(this.math)}return t.prototype.dispose=function(){var t=this;this.activationArrayMap.dispose(),Object.keys(this.runtimeCache).forEach(function(e){var r=t.runtimeCache[e];r.operations&&r.operations.forEach(function(t){return t.dispose()})}),this.runtimeCache={},null!=this.batchSizeScalar&&this.batchSizeScalar.dispose(),this.oneScalar.dispose()},t.prototype.evalAll=function(t,e){var r=this;return this.math.scope(function(){var n=new u(e),o=r.getOrCreateRuntime(t,n),a=r.activationArrayMap;i.disposeAndInitializeOperationOutputs(o.nodes,a),i.disposeTransientOperationArrays(o.operations,r.activationArrayMap,r.gradientArrayMap),i.addPersistentArraysToTensorArrayMap(o.nodes,a),i.loadInputsFromFeedDictionaryToTensorArrayMap(n,a,r.math),o.operations.forEach(function(t){return t.feedForward(r.math,a)});var s=t.map(function(t){return a.get(t)});return t.forEach(function(t){return a.delete(t)}),i.releaseFeedDictionaryInputsFromTensorArrayMap(n,a,r.math),s})},t.prototype.eval=function(t,e){return this.evalAll([t],e)[0]},t.prototype.train=function(t,e,r,a,s){var p=this;void 0===s&&(s=c.NONE),o.assert(o.isScalarShape(t.shape),"Cost tensor for training must be a scalar value."),this.prevBatchSize!==r&&(this.prevBatchSize=r,this.batchSizeScalar=n.Scalar.new(r));var l=new u(e);i.throwIfFeedDictionaryContainsNDArrays(l);var h=this.getOrCreateRuntime([t],l),f=h.operations,d=h.operations.slice().reverse(),v=this.activationArrayMap,m=this.gradientArrayMap;return m.nullify(t),m.add(t,this.oneScalar),i.addPersistentArraysToTensorArrayMap(h.nodes,v),a.beforeBatch(this.math,r,h,v,m),this.math.scope(function(e,o){for(var u=o(n.Scalar.new(0)),c=0;c<r;++c)i.disposeAndInitializeOperationOutputs(h.nodes,v),i.disposeAndInitializeOperationInputGradients(h.nodes,m),i.disposeTransientOperationArrays(h.operations,v,m),i.loadInputsFromFeedDictionaryToTensorArrayMap(l,v,p.math),f.forEach(function(t){return t.feedForward(p.math,v)}),d.forEach(function(t){return t.backProp(p.math,v,m)}),a.afterExample(p.math,h,v,m),i.releaseFeedDictionaryInputsFromTensorArrayMap(l,v,p.math),u=p.updateCostForExample(u,v.get(t),s);return a.afterBatch(p.math,r,h,v,m),p.updateCostForBatch(u,s)})},t.prototype.updateCostForExample=function(t,e,r){return r===c.MEAN||r===c.SUM?this.math.add(t,e):t},t.prototype.updateCostForBatch=function(t,e){return e===c.MEAN?this.math.divide(t,this.batchSizeScalar):t},t.prototype.getOrCreateRuntime=function(t,e){var r=this.makeRuntimeCacheKey(t,e),n=this.runtimeCache[r];if(void 0===n){var o=i.getOrderedEvaluationSetFromEvalTensor(t,e);i.removeFeedDictionaryNodesFromEvaluationSet(e,o),i.throwErrorIfEvaluationSetContainsPlaceholderNodes(o),n={nodes:o,operations:a.emitFromGraphNodes(o)},this.runtimeCache[r]=n}return n},t.prototype.makeRuntimeCacheKey=function(t,e){return t.map(function(t){return t.id}).sort().join("_")+"__"+Object.keys(e.dict).sort().join("_")},t}();r.Session=p},{"../math/ndarray":61,"../util":94,"./operation_emitter":18,"./session_util":48,"./tensor_array_map":49}],48:[function(t,e,r){"use strict";function n(t){return Object.keys(t.dict).map(function(e){return t.dict[+e].tensor.node})}Object.defineProperty(r,"__esModule",{value:!0});var o=t("../math/ndarray"),a=t("../util"),i=t("./graph"),s=t("./graph_util");r.getTerminatingNodesFromFeedDictionary=n,r.getOrderedEvaluationSetFromEvalTensor=function(t,e){var r=n(e),o=t.map(function(t){return t.node}),a=s.getUnorderedEvaluationSet(o,r);return s.getOrderedEvaluationSet(a)},r.addPersistentArraysToTensorArrayMap=function(t,e){t.forEach(function(t){(t instanceof i.VariableNode||t instanceof i.ConstantNode)&&e.set(t.output,t.data)})},r.getVariableNodesFromEvaluationSet=function(t){var e=[];return t.forEach(function(t){t instanceof i.VariableNode&&e.push(t)}),e},r.throwIfFeedDictionaryContainsNDArrays=function(t){Object.keys(t.dict).forEach(function(e){if(t.dict[+e].data instanceof o.NDArray)throw new Error("training requires FeedDictionary entries to be InputProvidersand not NDArrays.")})},r.loadInputsFromFeedDictionaryToTensorArrayMap=function(t,e,r){Object.keys(t.dict).forEach(function(n){var i,s=t.dict[+n];i=s.data instanceof o.NDArray?s.data:s.data.getNextCopy(r),a.assert(a.arraysEqual(s.tensor.shape,i.shape),"Error loading FeedEntry: feeding NDArray of shape "+i.shape+" does not match Tensor (id: "+s.tensor.id+") shape: "+s.tensor.shape+"."),e.set(s.tensor,i)})},r.releaseFeedDictionaryInputsFromTensorArrayMap=function(t,e,r){Object.keys(t.dict).forEach(function(n){var a=t.dict[+n];if(!(a.data instanceof o.NDArray)){var i=a.data,s=e.get(a.tensor);i.disposeCopy(r,s)}e.delete(a.tensor)})},r.removeFeedDictionaryNodesFromEvaluationSet=function(t,e){for(var r=0;r<e.length;){var n=e[r];null!=t.dict[n.output.id]?e.splice(r,1):++r}},r.disposeAndInitializeOperationOutputs=function(t,e){t.forEach(function(t){s.isInputNode(t)||(s.isPassthroughNode(t,e)||e.disposeArray(t.output),e.set(t.output,null))})},r.disposeAndInitializeOperationInputGradients=function(t,e){t.forEach(function(t){Object.keys(t.inputs).forEach(function(r){var n=t.inputs[r];e.get(n,!0)!==e.get(t.output,!0)&&e.disposeArray(n),e.nullify(n)})})},r.disposeTransientOperationArrays=function(t,e,r){t.forEach(function(t){return t.disposeTransientArrays(e,r)})},r.throwErrorIfEvaluationSetContainsPlaceholderNodes=function(t){t.forEach(function(t){if(t instanceof i.PlaceholderNode){var e="["+t.output.shape.join(", ")+"]";throw new Error('Placeholder node "'+t.name+'" '+e+" not present in feed dictionary.")}})}},{"../math/ndarray":61,"../util":94,"./graph":16,"./graph_util":17}],49:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(){this.dict={}}return t.prototype.get=function(t,e){if(void 0===e&&(e=!1),!e&&void 0===this.dict[t.id])throw new Error("tensor "+t.id+" not in array map.");var r=this.dict[t.id];if(!e&&null===r)throw new Error("tensor "+t.id+" has null array.");return r},t.prototype.delete=function(t){delete this.dict[t.id]},t.prototype.nullify=function(t){this.dict[t.id]=null},t.prototype.disposeArray=function(t){if(void 0!==this.dict[t.id]){var e=this.dict[t.id];null!==e&&(e.dispose(),this.dict[t.id]=null)}},t.prototype.size=function(){return Object.keys(this.dict).length},t.prototype.dispose=function(){var t=this;Object.keys(this.dict).forEach(function(e){var r=t.dict[+e];r&&r.dispose()}),this.dict={}},t.prototype.hasNullArray=function(t){if(void 0===this.dict[t.id])throw new Error("tensor "+t.id+" not in array map.");return null===this.dict[t.id]},t}();r.TensorArrayMapBase=o;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.set=function(t,e){this.dict[t.id]=e},e}(o);r.TensorArrayMap=a;var i=function(t){function e(e){var r=t.call(this)||this;return r.math=e,r}return n(e,t),e.prototype.add=function(t,e){if(null==this.dict[t.id])this.dict[t.id]=this.math.keep(e);else{var r=this.get(t),n=this.math.keep(this.math.addStrict(r,e));this.dict[t.id]=n,r.dispose()}},e}(o);r.SummedTensorArrayMap=i},{}],50:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=t("./graph/session"),a=t("./math/ndarray");!function(t){t[t.SUM=0]="SUM",t[t.MEAN=1]="MEAN"}(n=r.MetricReduction||(r.MetricReduction={}));var i=function(){function t(t,e,r){this.math=t,this.session=e,this.eventObserver=r,this.lastCostTimestamp=0,this.lastEvalTimestamp=0,this.totalIdleTimeMs=0,this.resetStatistics(),this.zeroScalar=a.Scalar.new(0)}return t.prototype.resetStatistics=function(){this.totalBatchesTrained=0,this.totalIdleTimeMs=0,this.lastStopTimestamp=null},t.prototype.train=function(t,e,r,o,i,s,u,c,p,l,h){void 0===p&&(p=n.MEAN),void 0===l&&(l=1500),void 0===h&&(h=500),this.costTensor=t,this.trainFeedEntries=e,this.metricTensor=s,this.metricFeedEntries=u,null!=c&&this.metricBatchSize!==c&&(null!=this.metricBatchSizeScalar&&this.metricBatchSizeScalar.dispose(),this.metricBatchSizeScalar=a.Scalar.new(c)),this.metricBatchSize=c,this.metricReduction=p,this.batchSize=r,this.optimizer=o,this.metricIntervalMs=l,this.costIntervalMs=h,this.currentTrainLoopNumBatches=i,this.batchesTrainedThisRun=0,this.isTraining=!0,this.trainStartTimestamp=performance.now(),this.trainNetwork()},t.prototype.stopTraining=function(){this.isTraining=!1,this.lastStopTimestamp=performance.now()},t.prototype.resumeTraining=function(){this.isTraining=!0,null!=this.lastStopTimestamp&&(this.totalIdleTimeMs+=performance.now()-this.lastStopTimestamp),this.trainNetwork()},t.prototype.trainNetwork=function(){var t=this;if(this.batchesTrainedThisRun===this.currentTrainLoopNumBatches&&this.stopTraining(),this.isTraining){var e=performance.now(),r=null!=this.eventObserver.avgCostCallback&&e-this.lastCostTimestamp>this.costIntervalMs;r&&(this.lastCostTimestamp=e);var n=r?o.CostReduction.MEAN:o.CostReduction.NONE;this.math.scope(function(o){var a=t.session.train(t.costTensor,t.trainFeedEntries,t.batchSize,t.optimizer,n);if(r){var i=performance.now()-e;if(t.eventObserver.avgCostCallback(a),null!=t.eventObserver.trainExamplesPerSecCallback){var s=1e3*t.batchSize/i;t.eventObserver.trainExamplesPerSecCallback(s)}}null!=t.eventObserver.metricCallback&&null!=t.metricFeedEntries&&e-t.lastEvalTimestamp>t.metricIntervalMs&&(t.lastEvalTimestamp=e,null!=t.lastComputedMetric&&t.lastComputedMetric.dispose(),t.lastComputedMetric=t.computeMetric(),t.eventObserver.metricCallback(t.lastComputedMetric)),null!=t.eventObserver.totalTimeCallback&&t.eventObserver.totalTimeCallback((e-t.trainStartTimestamp)/1e3),t.batchesTrainedThisRun++,t.totalBatchesTrained++,null!=t.eventObserver.batchesTrainedCallback&&t.eventObserver.batchesTrainedCallback(t.totalBatchesTrained)}),requestAnimationFrame(function(){return t.trainNetwork()})}else null!=this.eventObserver.doneTrainingCallback&&this.eventObserver.doneTrainingCallback()},t.prototype.infer=function(t,e,r,n,o){var i=this;if(void 0===r&&(r=3e3),void 0===n&&(n=5),null==this.eventObserver.inferenceExamplesCallback&&null==this.eventObserver.inferenceExamplesPerSecCallback)throw new Error("Cannot start inference loop, no inference example or examples/sec observer provided.");for(var s=0;s<e.length;s++)if(e[s].data instanceof a.NDArray)throw new Error("Cannot start inference on the model runner with feed entries of type NDArray. Please use InputProviders.");this.inferenceExampleIntervalMs=r,this.inferenceTensor=t,this.inferenceFeedEntries=e,this.inferenceExampleCount=n,this.currentInferenceLoopNumPasses=o,this.isInferring||(this.inferencePassesThisRun=0,requestAnimationFrame(function(){return i.inferNetwork()})),this.isInferring=!0},t.prototype.inferNetwork=function(){var t=this;this.isInferring&&this.inferencePassesThisRun!==this.currentInferenceLoopNumPasses&&(this.math.scope(function(e,r){for(var n=[],o=[],a=performance.now(),i=0;i<t.inferenceExampleCount;i++){for(var s=[],u=0;u<t.inferenceFeedEntries.length;u++){var c=t.inferenceFeedEntries[u];s.push({tensor:c.tensor,data:r(c.data.getNextCopy(t.math))})}n.push(s),o.push(t.session.eval(t.inferenceTensor,s))}if(null!=t.eventObserver.inferenceExamplesPerSecCallback){o[o.length-1].getValues();var p=performance.now()-a,l=1e3*t.inferenceExampleCount/p;t.eventObserver.inferenceExamplesPerSecCallback(l)}null!=t.eventObserver.inferenceExamplesCallback&&t.eventObserver.inferenceExamplesCallback(n,o),t.inferencePassesThisRun++}),this.lastInferTimeoutID=window.setTimeout(function(){return t.inferNetwork()},this.inferenceExampleIntervalMs))},t.prototype.stopInferring=function(){this.isInferring=!1,window.clearTimeout(this.lastInferTimeoutID)},t.prototype.isInferenceRunning=function(){return this.isInferring},t.prototype.computeMetric=function(){var t=this;if(null==this.metricFeedEntries)throw new Error("Cannot compute metric, no metric FeedEntries provided.");var e=this.zeroScalar;return this.math.scope(function(r){for(var o=0;o<t.metricBatchSize;o++){var a=t.session.eval(t.metricTensor,t.metricFeedEntries);e=t.math.add(e,a)}return t.metricReduction===n.MEAN&&(e=t.math.divide(e,t.metricBatchSizeScalar)),e})},t.prototype.getTotalBatchesTrained=function(){return this.totalBatchesTrained},t.prototype.getLastComputedMetric=function(){return this.lastComputedMetric},t.prototype.setMath=function(t){this.math=t},t.prototype.setSession=function(t){this.session=t},t.prototype.setInferenceTensor=function(t){this.inferenceTensor=t},t.prototype.setInferenceExampleCount=function(t){this.inferenceExampleCount=t},t}();r.GraphRunner=i},{"./graph/session":47,"./math/ndarray":61}],51:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./data/xhr-dataset");r.xhr_dataset=n;var o=t("./environment");r.environment=o;var a=t("./math/conv_util");r.conv_util=a;var i=t("./math/webgl/gpgpu_util");r.gpgpu_util=i;var s=t("./math/webgl/render_ndarray_gpu_util");r.render_ndarray_gpu_util=s;var u=t("./math/webgl/webgl_util");r.webgl_util=u;var c=t("./test_util");r.test_util=c;var p=t("./util");r.util=p;var l=t("./version");r.version=l.version;var h=t("./data/checkpoint_loader");r.CheckpointLoader=h.CheckpointLoader;var f=t("./data/dataset");r.InMemoryDataset=f.InMemoryDataset;var d=t("./data/input_provider");r.InCPUMemoryShuffledInputProviderBuilder=d.InCPUMemoryShuffledInputProviderBuilder,r.InGPUMemoryShuffledInputProviderBuilder=d.InGPUMemoryShuffledInputProviderBuilder;var v=t("./data/xhr-dataset");r.XhrDataset=v.XhrDataset;var m=t("./environment");r.ENV=m.ENV,r.Environment=m.Environment;var g=t("./graph/graph");r.Graph=g.Graph,r.Tensor=g.Tensor;var y=t("./graph/optimizers/adadelta_optimizer");r.AdadeltaOptimizer=y.AdadeltaOptimizer;var x=t("./graph/optimizers/adagrad_optimizer");r.AdagradOptimizer=x.AdagradOptimizer;var b=t("./graph/optimizers/adam_optimizer");r.AdamOptimizer=b.AdamOptimizer;var w=t("./graph/optimizers/adamax_optimizer");r.AdamMaxOptimizer=w.AdamMaxOptimizer;var _=t("./graph/optimizers/momentum_optimizer");r.MomentumOptimizer=_.MomentumOptimizer;var A=t("./graph/optimizers/optimizer");r.Optimizer=A.Optimizer;var T=t("./graph/optimizers/rmsprop_optimizer");r.RMSPropOptimizer=T.RMSPropOptimizer;var E=t("./graph/optimizers/sgd_optimizer");r.SGDOptimizer=E.SGDOptimizer;var S=t("./graph/session");r.CostReduction=S.CostReduction,r.Session=S.Session;var C=t("./graph_runner");r.GraphRunner=C.GraphRunner,r.MetricReduction=C.MetricReduction;var M=t("./initializers");r.ConstantInitializer=M.ConstantInitializer,r.NDArrayInitializer=M.NDArrayInitializer,r.OnesInitializer=M.OnesInitializer,r.RandomNormalInitializer=M.RandomNormalInitializer,r.RandomTruncatedNormalInitializer=M.RandomTruncatedNormalInitializer,r.RandomUniformInitializer=M.RandomUniformInitializer,r.VarianceScalingInitializer=M.VarianceScalingInitializer,r.ZerosInitializer=M.ZerosInitializer;var O=t("./math/math");r.MatrixOrientation=O.MatrixOrientation,r.NDArrayMath=O.NDArrayMath;var R=t("./math/math_cpu");r.NDArrayMathCPU=R.NDArrayMathCPU;var N=t("./math/math_gpu");r.NDArrayMathGPU=N.NDArrayMathGPU;var P=t("./math/ndarray");r.Array1D=P.Array1D,r.Array2D=P.Array2D,r.Array3D=P.Array3D,r.Array4D=P.Array4D,r.NDArray=P.NDArray,r.Scalar=P.Scalar;var I=t("./math/webgl/gpgpu_context");r.GPGPUContext=I.GPGPUContext},{"./data/checkpoint_loader":10,"./data/dataset":11,"./data/input_provider":12,"./data/xhr-dataset":13,"./environment":15,"./graph/graph":16,"./graph/optimizers/adadelta_optimizer":38,"./graph/optimizers/adagrad_optimizer":39,"./graph/optimizers/adam_optimizer":40,"./graph/optimizers/adamax_optimizer":41,"./graph/optimizers/momentum_optimizer":42,"./graph/optimizers/optimizer":43,"./graph/optimizers/rmsprop_optimizer":44,"./graph/optimizers/sgd_optimizer":45,"./graph/session":47,"./graph_runner":50,"./initializers":52,"./math/conv_util":55,"./math/math":58,"./math/math_cpu":59,"./math/math_gpu":60,"./math/ndarray":61,"./math/webgl/gpgpu_context":73,"./math/webgl/gpgpu_util":75,"./math/webgl/render_ndarray_gpu_util":84,"./math/webgl/webgl_util":92,"./test_util":93,"./util":94,"./version":95}],52:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./math/ndarray"),o=function(){function t(t,e,r){void 0===t&&(t=1),void 0===e&&(e="fan_in"),void 0===r&&(r="normal"),this.scale=t,this.mode=e,this.distribution=r}return t.prototype.initialize=function(t,e,r){var o=0;if("fan_in"===this.mode)o=e;else if("fan_out"===this.mode)o=r;else{if("fan_avg"!==this.mode)throw new Error("Unexpected mode for variance scaling initializer: "+this.mode);o=(e+r)/2}if("normal"===this.distribution)return n.NDArray.randTruncatedNormal(t,0,Math.sqrt(this.scale/o));if("uniform"===this.distribution)return n.NDArray.randUniform(t,0,Math.sqrt(3*this.scale/o));throw new Error("Unexpected distribution for variance scaling initializer: "+this.distribution)},t}();r.VarianceScalingInitializer=o;var a=function(){function t(){}return t.prototype.initialize=function(t,e,r){return n.NDArray.zeros(t)},t}();r.ZerosInitializer=a;var i=function(){function t(){}return t.prototype.initialize=function(t,e,r){var o=n.NDArray.zeros(t);return o.fill(1),o},t}();r.OnesInitializer=i;var s=function(){function t(t){void 0===t&&(t=0),this.value=t}return t.prototype.initialize=function(t,e,r){var o=n.NDArray.zeros(t);return o.fill(this.value),o},t}();r.ConstantInitializer=s;var u=function(){function t(t){this.ndarray=t}return t.prototype.initialize=function(t,e,r){return this.ndarray},t}();r.NDArrayInitializer=u;var c=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=.05),this.mean=t,this.stdev=e}return t.prototype.initialize=function(t,e,r){return n.NDArray.randNormal(t,this.mean,this.stdev)},t}();r.RandomNormalInitializer=c;var p=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=.05),this.mean=t,this.stdev=e}return t.prototype.initialize=function(t,e,r){return n.NDArray.randTruncatedNormal(t,this.mean,this.stdev)},t}();r.RandomTruncatedNormalInitializer=p;var l=function(){function t(t,e){void 0===t&&(t=-.05),void 0===e&&(e=.05),this.minval=t,this.maxval=e}return t.prototype.initialize=function(t,e,r){return n.NDArray.randUniform(t,this.minval,this.maxval)},t}();r.RandomUniformInitializer=l},{"./math/ndarray":61}],53:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./ndarray"),o=function(){function t(){}return t.prototype.output=function(t,e){return t.scope(function(){return t.tanh(e)})},t.prototype.der=function(t,e,r){return t.scope(function(){var e=t.elementWiseMul(r,r);return t.scalarMinusArray(n.Scalar.ONE,e)})},t}();r.TanHFunc=o;var a=function(){function t(){}return t.prototype.output=function(t,e){return t.scope(function(){return t.relu(e)})},t.prototype.der=function(t,e,r){return t.scope(function(){return t.step(e)})},t}();r.ReLUFunc=a;var i=function(){function t(){}return t.prototype.output=function(t,e){return t.scope(function(){return t.sigmoid(e)})},t.prototype.der=function(t,e,r){return t.scope(function(){var e=t.elementWiseMul(r,r);return t.subStrict(r,e)})},t}();r.SigmoidFunc=i;var s=function(){function t(){}return t.prototype.output=function(t,e){return t.scope(function(){return t.elementWiseMul(e,e)})},t.prototype.der=function(t,e,r){return t.scope(function(){return t.scalarTimesArray(n.Scalar.TWO,e)})},t}();r.SquareFunc=s},{"./ndarray":61}],54:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../util");r.assertParams=function(t,e,r){var o=t.length,a=e.length;n.assert(t.length===e.length,"Error in concat"+o+"D: rank of x1 ("+o+") and x2 ("+a+") must be the same."),n.assert(r>=0&&r<o,"Error in concat"+o+"D: axis must be between 0 and "+(o-1)+".");for(var i=0;i<o;i++)n.assert(i===r||t[i]===e[i],"Error in concat"+o+"D: Shape ("+t+") does not match ("+e+") along the non-concatenated axis "+i+".")},r.computeOutShape=function(t,e,r){n.assert(t.length===e.length,"x1 and x2 should have the same rank.");var o=t.slice();return o[r]+=e[r],o}},{"../util":94}],55:[function(t,e,r){"use strict";function n(t,e,r,n,i){null==i&&(i=o(t,e,n));var s=t[0],u=t[1],c=(s-e+2*i)/n+1;a.assert(a.isInt(c),"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters");var p=(u-e+2*i)/n+1;return a.assert(a.isInt(p),"The output # of columns ("+p+") must be an integer. Change the stride and/or zero pad parameters"),[c,p,r]}function o(t,e,r){return Math.floor((t[0]*(r-1)-r+e)/2)}Object.defineProperty(r,"__esModule",{value:!0});var a=t("../util");r.computeConvInfo=function(t,e,r,o,a,i,s){if("number"==typeof s)return{inShape:t,outShape:n(t,e,o,a,s),padInfo:{top:s,bottom:s,left:s,right:s},strideHeight:a,strideWidth:i,filterHeight:e,filterWidth:r};var u,c,p=t[0],l=t[1];if("same"===s){u=[g=Math.ceil(p/a),y=Math.ceil(l/i),o];var h=(g-1)*a+e-p,f=(y-1)*i+r-l,d=Math.floor(h/2),v=h-d,m=Math.floor(f/2);c={top:d,bottom:v,left:m,right:f-m}}else{if("valid"!==s)throw Error("Unknown padding parameter: "+s);var g=Math.ceil((p-e+1)/a),y=Math.ceil((l-r+1)/i);u=[g,y,o],c={top:0,bottom:0,left:0,right:0}}return{inShape:t,outShape:u,padInfo:c,strideHeight:a,strideWidth:i,filterHeight:e,filterWidth:r}},r.computeOutputShape3D=n,r.computeDefaultPad=o,r.computeTexShapeFrom3D=function(t){return[t[0],t[1]*t[2]]},r.computeWeightsShape4D=function(t,e,r,n){return[r,n,t,e]},r.computeDilatedRC=function(t,e){return[(t[0]-1)*e+1,(t[1]-1)*e+1]}},{"../util":94}],56:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.validateShapes=function(t,e){var r=t[0]*t[1],n=e[0]*e[1];if(r!==n){var o="["+t[0]+", "+t[1]+"]",a="["+e[0]+", "+e[1]+"]";throw new Error("copy2D shapes have different areas:\n  sourceSize "+o+", area "+r+"\n  destSize "+a+", area "+n)}}},{}],57:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./ndarray"),o=function(){function t(){this.halfOne=n.Scalar.new(.5)}return t.prototype.cost=function(t,e,r){var n=t.subStrict(e,r),o=t.elementWiseMul(n,n),a=t.scalarTimesArray(this.halfOne,o);return n.dispose(),o.dispose(),a},t.prototype.der=function(t,e,r){return t.subStrict(e,r)},t.prototype.dispose=function(){this.halfOne.dispose()},t}();r.SquareCostFunc=o},{"./ndarray":61}],58:[function(t,e,r){"use strict";function n(t){return"number"==typeof t?[t,t]:t}Object.defineProperty(r,"__esModule",{value:!0});var o=t("../util"),a=t("./concat_util"),i=t("./conv_util"),s=t("./copy2d_util"),u=t("./ndarray"),c=t("./slice_util");!function(t){t.float32="float32",t.int32="int32",t.bool="int32"}(r.SumTypesMap||(r.SumTypesMap={}));var p=function(){function t(t){this.safeMode=t,this.ndarrayScopes=[],this.ndarraysToKeep=[],this.activeScopeNDArraysToKeep=[],this.debugMode=!1}return t.prototype.scope=function(t){var e=this;this.startScope();var r=t(function(t){return e.keep(t)},function(t){return e.track(t)});return this.endScope(r),r},t.prototype.enableDebugMode=function(){this.debugMode=!0,console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")},t.prototype.startScope=function(){var t=[];this.ndarrayScopes.push(t),this.activeScope=t;var e=[];this.ndarraysToKeep.push(e),this.activeScopeNDArraysToKeep=e},t.prototype.endScope=function(t){var e=this,r=this.activeScopeNDArraysToKeep;null!=t&&(r=r.concat(t));for(var n=0;n<this.activeScope.length;n++){var o=this.activeScope[n];this.isNDArrayDataInList(o,r)||o.dispose()}this.ndarrayScopes.pop(),this.activeScope=0===this.ndarrayScopes.length?null:this.ndarrayScopes[this.ndarrayScopes.length-1],t instanceof u.NDArray&&!this.isNDArrayDataInList(t,this.activeScopeNDArraysToKeep)?this.track(t):Array.isArray(t)&&t.forEach(function(t){t instanceof u.NDArray&&!e.isNDArrayDataInList(t,e.activeScopeNDArraysToKeep)&&e.track(t)}),this.ndarraysToKeep.pop(),this.activeScopeNDArraysToKeep=0===this.ndarraysToKeep.length?null:this.ndarraysToKeep[this.ndarraysToKeep.length-1]},t.prototype.isNDArrayDataInList=function(t,e){for(var r=0;r<e.length;r++)if(e[r].getData()===t.getData())return!0;return!1},t.prototype.keep=function(t){if(null==this.activeScope){if(this.safeMode)throw new Error("You are using math in safe mode. Enclose all math.method() calls inside a scope: math.scope(() => {math.method();...}) to avoid memory leaks.");return t}return this.activeScopeNDArraysToKeep.push(t),t},t.prototype.checkForNaN=function(t,e){for(var r=0;r<t.length;r++)if(isNaN(t[r]))throw Error("The result of the last math."+e+" has NaNs.")},t.prototype.track=function(t){if(null==this.activeScope){if(this.safeMode)throw new Error("You are using math in safe mode. Enclose all math.method() calls inside a scope: math.scope(() => {math.method();...}) to avoid memory leaks.");return t}return this.activeScope.push(t),t},t.prototype.dispose=function(){},t.prototype.matMul=function(t,e,r,n){var a=this;void 0===r&&(r=l.REGULAR),void 0===n&&(n=l.REGULAR);var i=r===l.REGULAR?t.shape[1]:t.shape[0],s=n===l.REGULAR?e.shape[0]:e.shape[1];return o.assert(2===t.rank&&2===e.rank,"Error in matMul: inputs must be rank 2, got ranks "+t.rank+"and "+e.rank+"."),o.assert(i===s,"Error in matMul: inner shapes ("+i+") and ("+s+") of NDArrays with shapes "+t.shape+" and "+e.shape+" and orientations "+l[r]+" and "+l[n]+" must match."),this.executeOp("matMul",function(){return a.matMulInternal(t,e,r,n)})},t.prototype.executeOp=function(t,e){var r;this.debugMode&&(r=performance.now());var n=e();if(this.debugMode){var a=n.getValues(),i=o.rightPad(performance.now()-r+"ms",9),s=o.rightPad(t,25),u=n.rank,c=n.size,p=o.rightPad(n.shape+"",14);console.log("%c"+s+"\t%c"+i+"\t%c"+u+"D "+p+"\t%c"+c,"font-weight:bold","color:red","color:blue","color: orange"),this.checkForNaN(a,t)}return this.track(n)},t.prototype.vectorTimesMatrix=function(t,e){return o.assert(1===t.rank,"Error in vectorTimesMatrix: first input must be rank 1, but got rank "+t.rank+"."),o.assert(2===e.rank,"Error in vectorTimesMatrix: second input must be rank 2, but got rank "+e.rank+"."),o.assert(t.size===e.shape[0],"Error in vectorTimesMatrix: size of vector ("+t.size+") must match first dimension of matrix ("+e.shape[0]+")"),this.matMul(t.as2D(1,-1),e).as1D()},t.prototype.matrixTimesVector=function(t,e){return o.assert(1===e.rank,"Error in vectorTimesMatrix: second input must rank 1, but got rank "+e.rank+"."),o.assert(2===t.rank,"Error in vectorTimesMatrix: first input must be a rank 2, but got rank "+t.rank+"."),o.assert(e.size===t.shape[1],"Error in vectorTimesMatrix: size of first rank 1 input "+e.size+" must match inner dimension of second rank 2 input, but got shape "+t.shape+"."),this.matMul(t,e.as2D(-1,1)).as1D()},t.prototype.dotProduct=function(t,e){return o.assert(1===t.rank&&1===e.rank,"Error in dotProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+e.rank+"."),o.assert(t.size===e.size,"Error in dotProduct: size of inputs ("+t.size+") and ("+e.size+") must match."),this.matMul(t.as2D(1,-1),e.as2D(-1,1)).asScalar()},t.prototype.outerProduct=function(t,e){return o.assert(1===t.rank&&1===e.rank,"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+e.rank+"."),this.matMul(t.as2D(-1,1),e.as2D(1,-1))},t.prototype.clone=function(t){var e=this;return this.executeOp("clone",function(){return e.cloneInternal(t)})},t.prototype.reshape=function(t,e){return console.warn("math.reshape() is deprecated. Please call reshape() directly on the ndarray object"),t.reshape(e)},t.prototype.slice1D=function(t,e,r){var n=this;return c.assertParamsValid(t,[e],[r]),this.executeOp("slice1D",function(){return n.slice1DInternal(t,e,r)})},t.prototype.slice2D=function(t,e,r){var n=this;return c.assertParamsValid(t,e,r),this.executeOp("slice2D",function(){return n.slice2DInternal(t,e,r)})},t.prototype.slice3D=function(t,e,r){var n=this;return c.assertParamsValid(t,e,r),this.executeOp("slice3D",function(){return n.slice3DInternal(t,e,r)})},t.prototype.slice4D=function(t,e,r){var n=this;return c.assertParamsValid(t,e,r),this.executeOp("slice4D",function(){return n.slice4DInternal(t,e,r)})},t.prototype.copy2D=function(t,e,r,n,a,i){var u=this;o.assert(e[0]+r[0]<=t.shape[0]&&e[1]+r[1]<=t.shape[1],"Error in copy2D: requested source start position "+e+" and source size "+r+" would overflow source NDArrayof shape "+t.shape+"."),o.assert(a[0]+i[0]<=n.shape[0]&&a[1]+i[1]<=n.shape[1],"Error in copy2D: requested dest start position "+a+" and source size "+i+" would overflow dest NDArray ofshape "+n.shape+"."),s.validateShapes(r,i),this.executeOp("copy2D",function(){return u.copy2DInternal(t,e,r,n,a,i),n})},t.prototype.concat1D=function(t,e){var r=this;return a.assertParams(t.shape,e.shape,0),this.executeOp("concat1D",function(){return r.concat1DInternal(t,e)})},t.prototype.concat2D=function(t,e,r){var n=this;return a.assertParams(t.shape,e.shape,r),this.executeOp("concat2D",function(){return n.concat2DInternal(t,e,r)})},t.prototype.concat3D=function(t,e,r){var n=this;return a.assertParams(t.shape,e.shape,r),this.executeOp("concat3D",function(){return n.concat3DInternal(t,e,r)})},t.prototype.concat4D=function(t,e,r){var n=this;return a.assertParams(t.shape,e.shape,r),this.executeOp("concat4D",function(){return n.concat4DInternal(t,e,r)})},t.prototype.logSumExp=function(t){var e=this;return this.executeOp("logSumExp",function(){return e.logSumExpInternal(t)})},t.prototype.sum=function(t){var e=this;return this.executeOp("sum",function(){return e.sumInternal(t)})},t.prototype.argMin=function(t){var e=this;return this.executeOp("argMin",function(){return e.argMinInternal(t)})},t.prototype.argMax=function(t){var e=this;return this.executeOp("argMax",function(){return e.argMaxInternal(t)})},t.prototype.argMaxEquals=function(t,e){var r=this;return o.assertShapesMatch(t.shape,e.shape,"Error in argMaxEquals: "),this.executeOp("argMaxEquals",function(){return r.argMaxEqualsInternal(t,e)})},t.prototype.topK=function(t,e){var r=this;o.assert(e<=t.size,"Error in topK: k value ("+e+") must be less than size of input ndarray, got shape "+t.shape+".");var n;return this.executeOp("topK",function(){return(n=r.topKInternal(t,e)).values}),this.track(n.indices),n},t.prototype.min=function(t){var e=this;return this.executeOp("min",function(){return e.minInternal(t)})},t.prototype.max=function(t){var e=this;return this.executeOp("max",function(){return e.maxInternal(t)})},t.prototype.softmax=function(t){var e=this;return this.executeOp("softmax",function(){return e.scope(function(){var r=e.logSumExp(t),n=e.arrayMinusScalar(t,r);return e.exp(n)})})},t.prototype.switchDim=function(t,e){var r=this;return o.assert(t.rank===e.length,"Error in switchDim: length of input shape "+t.shape+" must match size of newDim array "+e+"."),this.executeOp("switchDim",function(){return r.switchDimInternal(t,e)})},t.prototype.scalarPlusArray=function(t,e){return o.assert(1===t.size,"Error in scalarPlusArray: first argument must be rank 0, but got rank "+t.rank+"."),this.add(t,e)},t.prototype.scalarMinusArray=function(t,e){return o.assert(1===t.size,"Error in scalarMinusArray: first argument must be rank 0, but got rank "+t.rank+"."),this.sub(t,e)},t.prototype.arrayMinusScalar=function(t,e){return o.assert(1===e.size,"Error in arrayMinusScalar: second argument must be rank 0, but got rank "+e.rank+"."),this.sub(t,e)},t.prototype.neg=function(t){var e=this;return this.executeOp("neg",function(){return e.negInternal(t)})},t.prototype.add=function(t,e){var r=this;return o.assertAndGetBroadcastedShape(t.shape,e.shape),this.executeOp("add",function(){return r.addInternal(t,e)})},t.prototype.addStrict=function(t,e){return o.assertShapesMatch(t.shape,e.shape,"Error in addStrict: "),this.add(t,e)},t.prototype.sub=function(t,e){var r=this;return o.assertAndGetBroadcastedShape(t.shape,e.shape),this.executeOp("sub",function(){return r.subInternal(t,e)})},t.prototype.subStrict=function(t,e){return o.assertShapesMatch(t.shape,e.shape,"Error in subStrict: "),this.sub(t,e)},t.prototype.multiply=function(t,e){var r=this;return o.assertAndGetBroadcastedShape(t.shape,e.shape),this.executeOp("multiply",function(){return r.multiplyInternal(t,e)})},t.prototype.elementWiseMul=function(t,e){return this.multiplyStrict(t,e)},t.prototype.multiplyStrict=function(t,e){return o.assertShapesMatch(t.shape,e.shape,"Error in multiplyStrict: "),this.multiply(t,e)},t.prototype.divide=function(t,e){var r=this;return o.assertAndGetBroadcastedShape(t.shape,e.shape),this.executeOp("divide",function(){return r.divideInternal(t,e)})},t.prototype.divideStrict=function(t,e){return o.assertShapesMatch(t.shape,e.shape,"Error in divideStrict: "),this.divide(t,e)},t.prototype.scalarDividedByArray=function(t,e){return o.assert(1===t.size,"Error in scalarDividedByArray: first argument must be rank 0, but got NDArray of rank "+t.rank+"."),this.divide(t,e)},t.prototype.arrayDividedByScalar=function(t,e){return o.assert(1===e.size,"Error in arrayDividedByScalar: second argument must be rank 0, but got NDArray of rank "+e.rank+"."),this.divide(t,e)},t.prototype.ceil=function(t){var e=this;return this.executeOp("ceil",function(){return e.ceilInternal(t)})},t.prototype.floor=function(t){var e=this;return this.executeOp("floor",function(){return e.floorInternal(t)})},t.prototype.exp=function(t){var e=this;return this.executeOp("exp",function(){return e.expInternal(t)})},t.prototype.log=function(t){var e=this;return this.executeOp("log",function(){return e.logInternal(t)})},t.prototype.sqrt=function(t){var e=this;return this.executeOp("sqrt",function(){return e.sqrtInternal(t)})},t.prototype.abs=function(t){var e=this;return this.executeOp("abs",function(){return e.absInternal(t)})},t.prototype.clip=function(t,e,r){var n=this;return o.assert(e<=r,"Error in clip: min ("+e+") must beless than or equal to max ("+r+")."),this.executeOp("clip",function(){return n.clipInternal(t,e,r)})},t.prototype.relu=function(t){var e=this;return this.executeOp("relu",function(){return e.reluInternal(t)})},t.prototype.sigmoid=function(t){var e=this;return this.executeOp("sigmoid",function(){return e.sigmoidInternal(t)})},t.prototype.sin=function(t){var e=this;return this.executeOp("sin",function(){return e.sinInternal(t)})},t.prototype.cos=function(t){var e=this;return this.executeOp("cos",function(){return e.cosInternal(t)})},t.prototype.tan=function(t){var e=this;return this.executeOp("tan",function(){return e.tanInternal(t)})},t.prototype.asin=function(t){var e=this;return this.executeOp("asin",function(){return e.asinInternal(t)})},t.prototype.acos=function(t){var e=this;return this.executeOp("acos",function(){return e.acosInternal(t)})},t.prototype.atan=function(t){var e=this;return this.executeOp("atan",function(){return e.atanInternal(t)})},t.prototype.sinh=function(t){var e=this;return this.executeOp("sinh",function(){return e.sinhInternal(t)})},t.prototype.cosh=function(t){var e=this;return this.executeOp("cosh",function(){return e.coshInternal(t)})},t.prototype.tanh=function(t){var e=this;return this.executeOp("tanh",function(){return e.tanhInternal(t)})},t.prototype.step=function(t){var e=this;return this.executeOp("step",function(){return e.stepInternal(t)})},t.prototype.scaledArrayAdd=function(t,e,r,n){var a=this;return o.assert(1===t.size,"Error in scaledArrayAdd: first argument must rank 0, but got  rank "+t.rank+"."),o.assert(1===r.size,"Error in scaledArrayAdd: third argument must be rank 0, but got NDArray of rank "+r.rank+"."),o.assertShapesMatch(e.shape,n.shape,"Error in scaledArrayAdd: "),this.executeOp("scaledArrayAdd",function(){return a.scaledArrayAddInternal(t,e,r,n)})},t.prototype.scalarTimesArray=function(t,e){return o.assert(1===t.size,"Error in arrayDividedByScalar: first argument must be rank 0, but got rank "+t.rank+"."),this.multiply(t,e)},t.prototype.elementWiseMulBroadcast=function(t,e){return o.assert(2===t.rank,"Error in elementWiseMulBroadcast: first argument must be rank 2, but got rank "+t.rank+"."),o.assert(2===e.rank,"Error in elementWiseMulBroadcast: second argument must be rank 2, but got rank "+e.rank+"."),this.multiply(t,e)},t.prototype.conv2d=function(t,e,r,a,s){var u=this;o.assert(3===t.rank,"Error in conv2d: x must be rank 3, but got rank "+t.rank+"."),o.assert(4===e.rank,"Error in conv2d: filter must be rank 4, but got rank "+e.rank+"."),null!=r&&o.assert(1===r.rank,"Error in conv2d: bias must be rank 1, but got rank "+r.rank+"."),o.assert(t.shape[2]===e.shape[2],"Error in conv2d: depth of input ("+t.shape[2]+") must match  input depth for filter "+e.shape[2]+".");var c=e.shape[0],p=e.shape[1],l=e.shape[3],h=n(a),f=h[0],d=h[1],v=i.computeConvInfo(t.shape,c,p,l,f,d,s);return this.executeOp("conv2d",function(){return u.conv2dInternal(t,e,r,v)})},t.prototype.conv2dBackProp=function(t,e,r,n,o){var a=this.conv2dDerFilter(t,e,r.shape,n,o);return{db:this.conv2dDerBias(e),dw:a,dx:this.conv2dDerInput(t.shape,e,r,n,o)}},t.prototype.conv2dDerInput=function(t,e,r,a,s){var u=this,c=t[2],p=e.shape[2];o.assert(3===t.length,"Error in conv2dDerInput: x must be rank 3, but got rank "+t.length+"."),o.assert(3===e.rank,"Error in conv2dDerInput: dy must be rank 3, but got rank "+e.rank),o.assert(4===r.rank,"Error in conv2dDerInput: filter must be rank 4, but got rank "+r.rank),o.assert(c===r.shape[2],"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+r.shape[2]+"."),o.assert(p===r.shape[3],"Error in conv2dDerInput: depth of output ("+p+") mustmatch output depth for filter "+r.shape[3]+".");var l=r.shape[0],h=r.shape[1],f=n(a),d=f[0],v=f[1],m=i.computeConvInfo(t,l,h,p,d,v,s);return this.executeOp("conv2dDerInput",function(){return u.conv2dDerInputInternal(e,r,m)})},t.prototype.conv2dDerBias=function(t){return this.track(this.conv2dDerBiasInternal(t))},t.prototype.conv2dDerFilter=function(t,e,r,a,s){o.assert(3===t.rank,"Error in conv2dDerFilter: x must be rank 3, but got shape "+t.shape+"."),o.assert(3===e.rank,"Error in conv2dDerFilter: dy must be rank 3, but got shape "+e.shape+"."),o.assert(4===r.length,"Error in conv2dDerFilter: filterSize must be length 4, but got "+r+"."),o.assert(t.shape[2]===r[2],"Error in conv2dDerFilter: depth of x "+t.shape[2]+") must match input depth in filter ("+r[2]+"."),o.assert(e.shape[2]===r[3],"Error in conv2dDerFilter: depth of dy ("+e.shape[2]+") must match output depth for filter ("+r[3]+").");var u=r[0],c=r[1],p=r[3],l=n(a),h=l[0],f=l[1],d=i.computeConvInfo(t.shape,u,c,p,h,f,s);return this.track(this.conv2dDerFilterInternal(t,e,d))},t.prototype.conv2dTranspose=function(t,e,r,n,o){return this.conv2dDerInput(r,t,e,n,o)},t.prototype.maxPool=function(t,e,r,a){var s=this;o.assert(3===t.rank,"Error in maxPool: x must be rank 3 but got rank "+t.rank+".");var u=n(e),c=u[0],p=u[1],l=t.shape[2],h=n(r),f=h[0],d=h[1],v=i.computeConvInfo(t.shape,c,p,l,f,d,a);return this.executeOp("maxPool",function(){return s.maxPoolInternal(t,v)})},t.prototype.maxPoolBackprop=function(t,e,r,a,s){var u=this;o.assert(3===t.rank,"Error in maxPoolBackprop: dy must be rank 3 but got rank "+t.rank+"."),o.assert(3===e.rank,"Error in maxPoolBackprop: x must be rank 3 but got rank "+e.rank+".");var c=n(r),p=c[0],l=c[1],h=e.shape[2],f=n(a),d=f[0],v=f[1],m=i.computeConvInfo(e.shape,p,l,h,d,v,s);return this.executeOp("maxPoolBackprop",function(){return u.maxPoolBackpropInternal(t,e,m)})},t.prototype.minPool=function(t,e,r,a){var s=this;o.assert(3===t.rank,"Error in minPool: x must be rank 3 but got rank "+t.rank+".");var u=n(e),c=u[0],p=u[1],l=t.shape[2],h=n(r),f=h[0],d=h[1],v=i.computeConvInfo(t.shape,c,p,l,f,d,a);return this.executeOp("minPool",function(){return s.minPoolInternal(t,v)})},t.prototype.avgPool=function(t,e,r,a){var s=this;o.assert(3===t.rank,"Error in avgPool: x must be rank 3 but got rank "+t.rank+".");var u=n(e),c=u[0],p=u[1],l=t.shape[2],h=n(r),f=h[0],d=h[1],v=i.computeConvInfo(t.shape,c,p,l,f,d,a);return this.executeOp("avgPool",function(){return s.avgPoolInternal(t,v)})},t.prototype.resizeBilinear3D=function(t,e,r){var n=this;return void 0===r&&(r=!1),o.assert(3===t.rank,"Error in resizeBilinear3D: x must be rank 3 but got rank "+t.rank+"."),o.assert(2===e.length,"Error in resizeBilinear3D: new shape must 2D, but got shape "+e+"."),this.executeOp("resizeBilinear3D",function(){return n.resizeBilinear3DInternal(t,e,r)})},t.prototype.batchNormalization3D=function(t,e,r,n,a,i){var s=this;return void 0===n&&(n=.001),o.assert(3===t.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+t.rank+"."),o.assert(3===e.rank||1===e.rank,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but got rank "+e.rank+"."),o.assert(3===r.rank||1===r.rank,"Error in batchNormalization3D: variance must be rank 3 or rank 1 but got rank "+r.rank+"."),null!=a&&o.assert(3===a.rank||1===a.rank,"Error in batchNormalization3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."),null!=i&&o.assert(3===i.rank||1===i.rank,"Error in batchNormalization3D: offset must be rank 3 or rank 1 but got rank "+i.rank+"."),this.executeOp("batchNorm3D",function(){return s.batchNormalization3DInternal(t,e,r,n,a,i)})},t.prototype.multiRNNCell=function(t,e,r,n){for(var o=this.scope(function(){for(var o=e,a=[],i=0;i<t.length;i++){var s=t[i](o,r[i],n[i]);a.push(s[0]),a.push(s[1]),o=s[1]}return a}),a=[],i=[],s=0;s<o.length;s+=2)a.push(o[s]),i.push(o[s+1]);return[a,i]},t.prototype.basicLSTMCell=function(t,e,r,n,o,a){var i=this,s=this.scope(function(){var s=i.concat2D(n,a,1),u=i.matMul(s,e),c=i.add(u,r),p=c.shape[0],l=c.shape[1]/4,h=[p,l],f=i.slice2D(c,[0,0],h),d=i.slice2D(c,[0,l],h),v=i.slice2D(c,[0,2*l],h),m=i.slice2D(c,[0,3*l],h),g=i.addStrict(i.multiplyStrict(o,i.sigmoid(i.scalarPlusArray(t,v))),i.multiplyStrict(i.sigmoid(f),i.tanh(d)));return[g,i.multiplyStrict(i.tanh(g),i.sigmoid(m))]});return[s[0],s[1]]},t.prototype.multinomial=function(t,e,r){var n=this,o=t.size;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");return r=r||Math.random(),this.executeOp("multinomial",function(){return n.multinomialInternal(t,e,r)})},t.prototype.oneHot=function(t,e,r,n){var o=this;if(void 0===r&&(r=1),void 0===n&&(n=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);return this.executeOp("oneHot",function(){return o.oneHotInternal(t,e,r,n)})},t}();r.NDArrayMath=p;var l;!function(t){t[t.REGULAR=0]="REGULAR",t[t.TRANSPOSED=1]="TRANSPOSED"}(l=r.MatrixOrientation||(r.MatrixOrientation={}))},{"../util":94,"./concat_util":54,"./conv_util":55,"./copy2d_util":56,"./ndarray":61,"./slice_util":62}],59:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("seedrandom"),a=t("../util"),i=t("./concat_util"),s=t("./conv_util"),u=t("./copy2d_util"),c=t("./math"),p=t("./ndarray"),l=function(t){function e(e){return void 0===e&&(e=!1),t.call(this,e)||this}return n(e,t),e.prototype.cloneInternal=function(t){return p.NDArray.make(t.shape,{values:new Float32Array(t.getValues())})},e.prototype.slice1DInternal=function(t,e,r){var n=t.getValues().slice(e,e+r);return p.Array1D.new(n)},e.prototype.slice2DInternal=function(t,e,r){for(var n=p.Array2D.zeros(r),o=e[0],a=e[1],i=0;i<r[0];++i)for(var s=0;s<r[1];++s){var u=t.get(i+o,s+a);n.set(u,i,s)}return n},e.prototype.slice3DInternal=function(t,e,r){for(var n=p.Array3D.zeros(r),o=e[0],a=e[1],i=e[2],s=0;s<r[0];++s)for(var u=0;u<r[1];++u)for(var c=0;c<r[2];++c){var l=t.get(s+o,u+a,c+i);n.set(l,s,u,c)}return n},e.prototype.slice4DInternal=function(t,e,r){for(var n=p.Array4D.zeros(r),o=e[0],a=e[1],i=e[2],s=e[3],u=0;u<r[0];++u)for(var c=0;c<r[1];++c)for(var l=0;l<r[2];++l)for(var h=0;h<r[3];++h){var f=t.get(u+o,c+a,l+i,h+s);n.set(f,u,c,l,h)}return n},e.prototype.copy2DInternal=function(t,e,r,n,o,a){u.validateShapes(r,a);for(var i=t.getValues(),s=n.getValues(),c=r[0]*r[1],p=0;p<c;++p){var l=e[0]+Math.floor(p/r[1]),h=e[1]+p%r[1],f=l*t.shape[1]+h,d=o[0]+Math.floor(p/a[1]),v=o[1]+p%a[1];s[d*n.shape[1]+v]=i[f]}},e.prototype.concat1DInternal=function(t,e){var r=i.computeOutShape(t.shape,e.shape,0),n=p.Array1D.zeros(r),o=t.getValues(),a=e.getValues(),s=n.getValues();return s.set(o,0),s.set(a,t.size),n},e.prototype.concat2DInternal=function(t,e,r){var n=i.computeOutShape(t.shape,e.shape,r),o=p.Array2D.zeros(n);if(0===r){var a=t.getValues(),s=e.getValues(),u=o.getValues();return u.set(a,0),u.set(s,t.size),o}for(var c=0;c<n[0];++c)for(var l=0;l<n[1];++l){var h=[c,l],f=void 0;if(h[r]<t.shape[r])f=t.get(c,l);else{h[r]-=t.shape[r];var d=h[0],v=h[1];f=e.get(d,v)}o.set(f,c,l)}return o},e.prototype.concat3DInternal=function(t,e,r){var n=i.computeOutShape(t.shape,e.shape,r),o=p.Array3D.zeros(n);if(0===r){var a=t.getValues(),s=e.getValues(),u=o.getValues();return u.set(a,0),u.set(s,t.size),o}for(var c=0;c<n[0];++c)for(var l=0;l<n[1];++l)for(var h=0;h<n[2];++h){var f=[c,l,h],d=void 0;if(f[r]<t.shape[r])d=t.get(c,l,h);else{f[r]-=t.shape[r];var v=f[0],m=f[1],g=f[2];d=e.get(v,m,g)}o.set(d,c,l,h)}return o},e.prototype.concat4DInternal=function(t,e,r){var n=i.computeOutShape(t.shape,e.shape,r),o=p.Array4D.zeros(n);if(0===r){var a=t.getValues(),s=e.getValues(),u=o.getValues();return u.set(a,0),u.set(s,t.size),o}for(var c=0;c<n[0];++c)for(var l=0;l<n[1];++l)for(var h=0;h<n[2];++h)for(var f=0;f<n[3];++f){var d=[c,l,h,f],v=void 0;if(d[r]<t.shape[r])v=t.get(c,l,h,f);else{d[r]-=t.shape[r];var m=d[0],g=d[1],y=d[2],x=d[3];v=e.get(m,g,y,x)}o.set(v,c,l,h,f)}return o},e.prototype.scaledArrayAddInternal=function(t,e,r,n){for(var o=a.assertAndGetBroadcastedShape(e.shape,n.shape),i=new Float32Array(a.sizeFromShape(o)),s=e.getValues(),u=n.getValues(),c=t.get(),l=r.get(),h=0;h<i.length;++h)i[h]=c*s[h%e.size]+l*u[h%n.size];return p.NDArray.make(o,{values:i})},e.prototype.negInternal=function(t){return this.scalarTimesArray(p.Scalar.NEG_ONE,t)},e.prototype.addInternal=function(t,e){return this.scaledArrayAddInternal(p.Scalar.ONE,t,p.Scalar.ONE,e)},e.prototype.subInternal=function(t,e){return this.scaledArrayAddInternal(p.Scalar.ONE,t,p.Scalar.NEG_ONE,e)},e.prototype.matMulInternal=function(t,e,r,n){void 0===r&&(r=c.MatrixOrientation.REGULAR),void 0===n&&(n=c.MatrixOrientation.REGULAR);for(var o=r===c.MatrixOrientation.REGULAR?t.shape[1]:t.shape[0],a=r===c.MatrixOrientation.REGULAR?t.shape[0]:t.shape[1],i=n===c.MatrixOrientation.REGULAR?e.shape[1]:e.shape[0],s=function(t,e,r){return t.get(e,r)},u=function(t,e,r){return t.get(r,e)},l=r===c.MatrixOrientation.REGULAR?s:u,h=n===c.MatrixOrientation.REGULAR?s:u,f=new Float32Array(a*i),d=0,v=0;v<a;++v)for(var m=0;m<i;++m){for(var g=0,y=0;y<o;++y)g+=l(t,v,y)*h(e,y,m);f[d++]=g}return p.Array2D.new([a,i],f)},e.prototype.multiplyInternal=function(t,e){for(var r=a.assertAndGetBroadcastedShape(t.shape,e.shape),n=new Float32Array(a.sizeFromShape(r)),o=t.getValues(),i=e.getValues(),s=0;s<n.length;++s)n[s]=o[s%t.size]*i[s%e.size];return p.NDArray.make(r,{values:n})},e.prototype.divideInternal=function(t,e){for(var r=a.assertAndGetBroadcastedShape(t.shape,e.shape),n=new Float32Array(a.sizeFromShape(r)),o=t.getValues(),i=e.getValues(),s=0;s<n.length;++s)n[s]=o[s%t.size]/i[s%e.size];return p.NDArray.make(r,{values:n})},e.prototype.sumInternal=function(t){for(var e=0,r=t.getValues(),n=0;n<r.length;++n)e+=r[n];return p.Scalar.new(e,c.SumTypesMap[t.dtype])},e.prototype.argMinInternal=function(t){for(var e=Number.MAX_VALUE,r=-1,n=t.getValues(),o=0;o<n.length;++o){var a=n[o];if(isNaN(a))return p.Scalar.new(NaN);a<e&&(e=a,r=o)}return p.Scalar.new(r)},e.prototype.argMaxInternal=function(t){for(var e=Number.NEGATIVE_INFINITY,r=-1,n=t.getValues(),o=0;o<n.length;++o){var a=n[o];if(isNaN(a))return p.Scalar.new(NaN);a>e&&(e=a,r=o)}return p.Scalar.new(r)},e.prototype.argMaxEqualsInternal=function(t,e){var r=this.argMaxInternal(t).get(),n=this.argMaxInternal(e).get();return isNaN(r)||isNaN(n)?p.Scalar.new(NaN):p.Scalar.new(+(r===n))},e.prototype.topKInternal=function(t,e){for(var r=t.getValues(),n=[],o=0;o<r.length;o++)n.push({value:r[o],index:o});n.sort(function(t,e){return e.value-t.value});for(var a=new Float32Array(e),i=new Float32Array(e),o=0;o<e;o++)a[o]=n[o].value,i[o]=n[o].index;return{values:p.Array1D.new(a),indices:p.Array1D.new(i)}},e.prototype.minInternal=function(t){for(var e=t.getValues(),r=e[0],n=1;n<e.length;++n){var o=e[n];if(isNaN(o))return p.Scalar.new(NaN);o<r&&(r=o)}return p.Scalar.new(r)},e.prototype.maxInternal=function(t){for(var e=t.getValues(),r=e[0],n=1;n<e.length;++n){var o=e[n];if(isNaN(o))return p.Scalar.new(NaN);o>r&&(r=o)}return p.Scalar.new(r)},e.prototype.ceilInternal=function(t){for(var e=t.getValues(),r=new Float32Array(e.length),n=0;n<e.length;++n)r[n]=Math.ceil(e[n]);return p.NDArray.make(t.shape,{values:r})},e.prototype.floorInternal=function(t){for(var e=t.getValues(),r=new Float32Array(e.length),n=0;n<e.length;++n)r[n]=Math.floor(e[n]);return p.NDArray.make(t.shape,{values:r})},e.prototype.expInternal=function(t){for(var e=t.getValues(),r=new Float32Array(e.length),n=0;n<e.length;++n)r[n]=Math.exp(e[n]);return p.NDArray.make(t.shape,{values:r})},e.prototype.logInternal=function(t){for(var e=t.getValues(),r=new Float32Array(e.length),n=0;n<e.length;++n){var o=e[n];r[n]=Math.log(o)}return p.NDArray.make(t.shape,{values:r})},e.prototype.sqrtInternal=function(t){for(var e=t.getValues(),r=new Float32Array(e.length),n=0;n<e.length;++n){var o=e[n];r[n]=Math.sqrt(o)}return p.NDArray.make(t.shape,{values:r})},e.prototype.logSumExpInternal=function(t){var e=this.max(t),r=this.arrayMinusScalar(t,e),n=this.exp(r),o=this.sum(n),a=this.log(o),i=this.add(e,a);return e.dispose(),r.dispose(),n.dispose(),o.dispose(),a.dispose(),i},e.prototype.reluInternal=function(t){for(var e=new Float32Array(t.size),r=t.getValues(),n=0;n<r.length;++n)e[n]=Math.max(0,r[n]);return p.NDArray.make(t.shape,{values:e})},e.prototype.clipInternal=function(t,e,r){for(var n=new Float32Array(t.size),o=t.getValues(),a=0;a<o.length;++a)n[a]=Math.min(r,Math.max(e,o[a]));return p.NDArray.make(t.shape,{values:n})},e.prototype.absInternal=function(t){for(var e=new Float32Array(t.size),r=t.getValues(),n=0;n<r.length;++n)e[n]=Math.abs(r[n]);return p.NDArray.make(t.shape,{values:e})},e.prototype.sigmoidInternal=function(t){for(var e=new Float32Array(t.size),r=t.getValues(),n=0;n<r.length;++n)e[n]=1/(1+Math.exp(-r[n]));return p.NDArray.make(t.shape,{values:e})},e.prototype.sinInternal=function(t){for(var e=new Float32Array(t.size),r=t.getValues(),n=0;n<r.length;++n)e[n]=Math.sin(r[n]);return p.NDArray.make(t.shape,{values:e})},e.prototype.cosInternal=function(t){for(var e=new Float32Array(t.size),r=t.getValues(),n=0;n<r.length;++n)e[n]=Math.cos(r[n]);return p.NDArray.make(t.shape,{values:e})},e.prototype.tanInternal=function(t){for(var e=new Float32Array(t.size),r=t.getValues(),n=0;n<r.length;++n)e[n]=Math.tan(r[n]);return p.NDArray.make(t.shape,{values:e})},e.prototype.asinInternal=function(t){for(var e=new Float32Array(t.size),r=t.getValues(),n=0;n<r.length;++n)e[n]=Math.asin(r[n]);return p.NDArray.make(t.shape,{values:e})},e.prototype.acosInternal=function(t){for(var e=new Float32Array(t.size),r=t.getValues(),n=0;n<r.length;++n)e[n]=Math.acos(r[n]);return p.NDArray.make(t.shape,{values:e})},e.prototype.atanInternal=function(t){for(var e=new Float32Array(t.size),r=t.getValues(),n=0;n<r.length;++n)e[n]=Math.atan(r[n]);return p.NDArray.make(t.shape,{values:e})},e.prototype.sinhInternal=function(t){for(var e=new Float32Array(t.size),r=t.getValues(),n=0;n<r.length;++n)e[n]=Math.sinh(r[n]);return p.NDArray.make(t.shape,{values:e})},e.prototype.coshInternal=function(t){for(var e=new Float32Array(t.size),r=t.getValues(),n=0;n<r.length;++n)e[n]=Math.cosh(r[n]);return p.NDArray.make(t.shape,{values:e})},e.prototype.tanhInternal=function(t){for(var e=new Float32Array(t.size),r=t.getValues(),n=0;n<r.length;++n)e[n]=a.tanh(r[n]);return p.NDArray.make(t.shape,{values:e})},e.prototype.stepInternal=function(t){for(var e=new Float32Array(t.size),r=t.getValues(),n=0;n<r.length;++n){var o=r[n];e[n]=o>0?1:o<0?0:o}return p.NDArray.make(t.shape,{values:e})},e.prototype.conv2dInternal=function(t,e,r,n){for(var o=t.shape,a=o[0],i=o[1],s=o[2],u=e.shape[0],c=e.shape[1],l=e.shape[3],h=n.padInfo.left,f=n.padInfo.top,d=p.Array3D.zeros(n.outShape),v=0;v<l;++v)for(var m=0;m<d.shape[0];++m)for(var g=m*n.strideHeight-h,y=Math.max(0,g),x=Math.min(a,u+g),b=0;b<d.shape[1];++b){for(var w=b*n.strideWidth-f,_=Math.max(0,w),A=Math.min(i,c+w),T=0,E=y;E<x;++E)for(var S=E-g,C=_;C<A;++C)for(var M=C-w,O=0;O<s;++O)T+=t.get(E,C,O)*e.get(S,M,O,v);var R=null!=r?r.get(v):0;d.set(T+R,m,b,v)}return d},e.prototype.conv2dDerInputInternal=function(t,e,r){for(var n=e.shape[2],o=e.shape[3],a=t.shape[0],i=t.shape[1],s=e.shape[0],u=e.shape[1],c=s-1-r.padInfo.top,l=u-1-r.padInfo.left,h=r.strideHeight,f=r.strideWidth,d=p.Array3D.zeros(r.inShape),v=0;v<n;++v)for(var m=0;m<d.shape[0];++m)for(var g=m-l,y=Math.max(0,Math.ceil(g/h)),x=Math.min(a,(s+g)/h),b=0;b<d.shape[1];++b){for(var w=b-c,_=Math.max(0,Math.ceil(w/f)),A=Math.min(i,(u+w)/f),T=0,E=y;E<x;++E)for(var S=E*h-g,C=_;C<A;++C)for(var M=C*f-w,O=0;O<o;++O)T+=t.get(E,C,O)*e.get(s-1-S,u-1-M,v,O);d.set(T,m,b,v)}return d},e.prototype.conv2dDerFilterInternal=function(t,e,r){for(var n=t.shape[2],o=e.shape[2],a=r.strideHeight,i=r.strideWidth,u=r.filterHeight,c=r.filterWidth,l=s.computeWeightsShape4D(n,o,u,c),h=p.Array4D.zeros(l),f=e.shape[0],d=e.shape[1],v=t.shape[0],m=t.shape[1],g=r.padInfo.left,y=r.padInfo.top,x=0;x<u;++x)for(var b=Math.max(0,Math.ceil((y-x)/a)),w=Math.min(f,(v+y-x)/a),_=0;_<c;++_)for(var A=Math.max(0,Math.ceil((g-_)/i)),T=Math.min(d,(m+g-_)/i),E=0;E<n;++E)for(var S=0;S<o;++S){for(var C=0,M=b;M<w;++M)for(var O=x+M*a-y,R=A;R<T;++R){var N=_+R*i-g;C+=t.get(O,N,E)*e.get(M,R,S)}h.set(C,x,_,E,S)}return h},e.prototype.conv2dDerBiasInternal=function(t){for(var e=t.shape[2],r=t.shape[0],n=t.shape[1],o=new Float32Array(e),a=0;a<e;++a){for(var i=0,s=0;s<r;++s)for(var u=0;u<n;++u)i+=t.get(s,u,a);o[a]=i}return p.Array1D.new(o)},e.prototype.switchDimInternal=function(t,e){for(var r=new Array(t.rank),n=0;n<r.length;n++)r[n]=t.shape[e[n]];for(var o=new Float32Array(t.size),a=t.getValues(),i=p.NDArray.make(r,{values:o}),n=0;n<t.size;++n){for(var s=t.indexToLoc(n),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[e[c]];o[i.locToIndex(u)]=a[n]}return i},e.prototype.pool=function(t,e,r){for(var n=t.shape,o=n[0],a=n[1],i=n[2],s=e.strideHeight,u=e.strideWidth,c=e.filterHeight,l=e.filterWidth,h=p.Array3D.zeros(e.outShape),f=e.padInfo.top,d=e.padInfo.left,v=0;v<i;++v)for(var m=0;m<h.shape[0];++m)for(var g=m*s-f,y=Math.max(0,g),x=Math.min(o,c+g),b=0;b<h.shape[1];++b){for(var w=b*u-d,_=Math.max(0,w),A=Math.min(a,l+w),T="max"===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,E=0,S=y;S<x;++S){for(var C=_;C<A;++C){var M=t.get(S,C,v);if(isNaN(M)){T=NaN,E=NaN;break}"max"===r&&M>T||"min"===r&&M<T?T=M:"avg"===r&&(E+=M/(c*l))}if(isNaN(T))break}h.set("avg"===r?E:T,m,b,v)}return h},e.prototype.maxPoolInternal=function(t,e){return this.pool(t,e,"max")},e.prototype.maxPoolPositions=function(t,e){for(var r=t.shape,n=r[0],o=r[1],a=r[2],i=e.outShape,s=p.Array3D.zeros(i),u=e.strideHeight,c=e.strideWidth,l=e.filterHeight,h=e.filterWidth,f=e.padInfo.top,d=e.padInfo.left,v=0;v<a;++v)for(var m=0;m<i[0];++m)for(var g=m*u-f,y=Math.max(0,g),x=Math.min(n,l+g),b=0;b<i[1];++b){for(var w=b*c-d,_=Math.max(0,w),A=Math.min(o,h+w),T=Number.NEGATIVE_INFINITY,E=-1,S=y;S<x;++S)for(var C=S-g,M=_;M<A;++M){var O=M-w,R=t.get(S,M,v);R>T&&(T=R,E=C*h+O)}s.set(E,m,b,v)}return s},e.prototype.maxPoolBackpropInternal=function(t,e,r){for(var n=this.maxPoolPositions(e,r),o=r.strideHeight,a=r.strideWidth,i=r.filterHeight,s=r.filterWidth,u=s-1-r.padInfo.left,c=i-1-r.padInfo.top,l=t.shape,h=l[0],f=l[1],d=l[2],v=p.Array3D.zeros(e.shape),m=0;m<d;++m)for(var g=0;g<v.shape[0];++g)for(var y=0;y<v.shape[1];++y){for(var x=g-c,b=y-u,w=0,_=0;_<i;++_){var A=(x+_)/o;if(!(A<0||A>=h||Math.floor(A)!==A))for(var T=0;T<s;++T){var E=(b+T)/a;if(!(E<0||E>=f||Math.floor(E)!==E)){var S=i*s-1-n.get(A,E,m)===_*s+T?1:0;0!==S&&(w+=t.get(A,E,m)*S)}}}v.set(w,g,y,m)}return v},e.prototype.minPoolInternal=function(t,e){return this.pool(t,e,"min")},e.prototype.avgPoolInternal=function(t,e){return this.pool(t,e,"avg")},e.prototype.resizeBilinear3DInternal=function(t,e,r){for(var n=p.Array3D.zeros([e[0],e[1],t.shape[2]]),o=r?[t.shape[0]-1,t.shape[1]-1,t.shape[2]]:t.shape,a=r?[n.shape[0]-1,n.shape[1]-1,n.shape[2]]:n.shape,i=0;i<n.shape[0];i++)for(var s=0;s<n.shape[1];s++)for(var u=0;u<n.shape[2];u++){var c=o[0]*i/a[0],l=o[1]*s/a[1],h=Math.floor(c),f=Math.min(t.shape[0]-1,Math.ceil(c)),d=Math.floor(l),v=Math.min(t.shape[1]-1,Math.ceil(l)),m=t.get(h,d,u),g=t.get(f,d,u),y=l-d,x=m+(t.get(h,v,u)-m)*y,b=x+(g+(t.get(f,v,u)-g)*y-x)*(c-h);n.set(b,i,s,u)}return n},e.prototype.batchNormalization3DInternal=function(t,e,r,n,o,a){void 0===n&&(n=.001);for(var i=t.getValues(),s=e.getValues(),u=r.getValues(),c=o?o.getValues():new Float32Array([1]),l=a?a.getValues():new Float32Array([0]),h=new Float32Array(i.length),f=0;f<i.length;f++)h[f]=l[f%l.length]+(i[f]-s[f%s.length])*c[f%c.length]/Math.sqrt(u[f%u.length]+n);return p.Array3D.new(t.shape,h)},e.prototype.multinomialInternal=function(t,e,r){var n=t.getValues(),a=new Float32Array(t.size-1);a[0]=n[0];for(var i=1;i<a.length;++i)a[i]=a[i-1]+n[i];for(var s=o.alea(r.toString()),u=new Float32Array(e),c=0;c<e;++c){var l=s();u[c]=a.length;for(var h=0;h<a.length;h++)if(l<a[h]){u[c]=h;break}}return p.Array1D.new(u)},e.prototype.oneHotInternal=function(t,e,r,n){var o=new Float32Array(t.size*e);o.fill(n);for(var a=0;a<t.size;++a)o[a*e+t.get(a)]=r;return p.Array2D.new([t.size,e],o)},e}(c.NDArrayMath);r.NDArrayMathCPU=l},{"../util":94,"./concat_util":54,"./conv_util":55,"./copy2d_util":56,"./math":58,"./ndarray":61,seedrandom:2}],60:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("./math"),a=t("./ndarray"),i=t("./ndarray"),s=t("./webgl/addscaledmat_gpu"),u=t("./webgl/argmaxequals_gpu"),c=t("./webgl/argminmax_gpu"),p=t("./webgl/batchnorm_gpu"),l=t("./webgl/binaryop_gpu"),h=t("./webgl/binaryop_gpu"),f=t("./webgl/clip_gpu"),d=t("./webgl/concat_gpu"),v=t("./webgl/conv_backprop_gpu"),m=t("./webgl/conv_gpu"),g=t("./webgl/copy_gpu"),y=t("./webgl/gpgpu_context"),x=t("./webgl/gpgpu_math"),b=t("./webgl/gpgpu_util"),w=t("./webgl/logsumexp_gpu"),_=t("./webgl/max_pool_backprop_gpu"),A=t("./webgl/minmax_gpu"),T=t("./webgl/mulmat_gpu"),E=t("./webgl/multinomial_gpu"),S=t("./webgl/onehot_gpu"),C=t("./webgl/pool_gpu"),M=t("./webgl/reducesum_gpu"),O=t("./webgl/resize_bilinear_gpu"),R=t("./webgl/slice_gpu"),N=t("./webgl/switch_dim_gpu"),P=t("./webgl/texture_manager"),I=t("./webgl/unaryop_gpu"),D=t("./webgl/unaryop_gpu"),k=t("./webgl/webgl_util"),z=function(t){function e(e,r){void 0===r&&(r=!1);var n=t.call(this,r)||this;if(n.binaryCache={},null==e){var o=b.createWebGLContext();n.gpgpu=new y.GPGPUContext(o),n.gpgpuCreatedLocally=!0}else n.gpgpu=e,n.gpgpuCreatedLocally=!1;return n.textureManager=new P.TextureManager(n.gpgpu),a.initializeGPU(n.gpgpu,n.textureManager),n}return n(e,t),e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.cloneInternal=function(t){var e=t.getTextureShapeRC(),r=t.as2D(e[0],e[1]),n=this.makeOutputArray(e,t.dtype);return this.copy2D(r,[0,0],e,n,[0,0],e),n.reshape(t.shape)},e.prototype.slice1DInternal=function(t,e,r){var n=new R.SliceProgram([r]),o=n.getCustomSetupFunc([e]);return this.compileAndRun(n,[t],null,o)},e.prototype.slice2DInternal=function(t,e,r){var n=new R.SliceProgram(r),o=n.getCustomSetupFunc(e);return this.compileAndRun(n,[t],null,o)},e.prototype.slice3DInternal=function(t,e,r){var n=new R.SliceProgram(r),o=n.getCustomSetupFunc(e);return this.compileAndRun(n,[t],null,o)},e.prototype.slice4DInternal=function(t,e,r){var n=new R.SliceProgram(r),o=n.getCustomSetupFunc(e);return this.compileAndRun(n,[t],null,o)},e.prototype.copy2DInternal=function(t,e,r,n,o,a){var i=new g.Copy2DProgram(r[1],a[1]),s=i.getCustomSetupFunc(e,o,a);this.compileAndRun(i,[t],n,s)},e.prototype.concat1DInternal=function(t,e){var r=new d.ConcatProgram(t.shape,e.shape,0);return this.compileAndRun(r,[t,e])},e.prototype.concat2DInternal=function(t,e,r){var n=new d.ConcatProgram(t.shape,e.shape,r);return this.compileAndRun(n,[t,e])},e.prototype.concat3DInternal=function(t,e,r){var n=new d.ConcatProgram(t.shape,e.shape,r);return this.compileAndRun(n,[t,e])},e.prototype.concat4DInternal=function(t,e,r){var n=new d.ConcatProgram(t.shape,e.shape,r);return this.compileAndRun(n,[t,e])},e.prototype.scaledArrayAddInternal=function(t,e,r,n){var o=new s.AddScaledMatProgram(e.shape,n.shape);return this.compileAndRun(o,[e,n,t,r])},e.prototype.negInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.NEG);return this.compileAndRun(e,[t])},e.prototype.makeOutputArray=function(t,e){var r=k.getTextureShapeFromLogicalShape(this.gpgpu.gl,t),n=this.textureManager.acquireTexture(r);return i.NDArray.make(t,{texture:n,textureShapeRC:r},e)},e.prototype.compileAndRun=function(t,e,r,n){var o=this;null==r&&(r=this.makeOutputArray(t.outputShape,e[0].dtype));var a=x.makeShaderKey(t,e,r),i=this.getAndSaveBinary(a,function(){return x.compileProgram(o.gpgpu,t,e,r)});return x.runProgram(i,e,r,n),r},e.prototype.matMulInternal=function(t,e,r,n){var o=new T.MatMulProgram(t.shape,e.shape,r,n);return this.compileAndRun(o,[t,e])},e.prototype.multiplyInternal=function(t,e){var r=new h.BinaryOpProgram(l.MUL,t.shape,e.shape);return this.compileAndRun(r,[t,e])},e.prototype.batchNormalization3DInternal=function(t,e,r,n,o,a){var i=[t,e,r];null==n&&(n=1e-6);var s=null;null!=a&&(s=a.shape,i.push(a));var u=null;null!=o&&(u=o.shape,i.push(o));var c=new p.BatchNormProgram(t.shape,e.shape,r.shape,s,u,n);return this.compileAndRun(c,i)},e.prototype.switchDimInternal=function(t,e){var r=new N.SwitchDimProgram(t.shape,e);return this.compileAndRun(r,[t])},e.prototype.sumInternal=function(t){var e=new M.ReduceSumProgram(t.size),r=this.makeOutputArray(e.outputShape,o.SumTypesMap[t.dtype]);return this.compileAndRun(e,[t],r)},e.prototype.argMinInternal=function(t){var e=new c.ArgMinMaxProgram(t.size,"min");return this.compileAndRun(e,[t])},e.prototype.argMaxInternal=function(t){var e=new c.ArgMinMaxProgram(t.size,"max");return this.compileAndRun(e,[t])},e.prototype.argMaxEqualsInternal=function(t,e){var r=new u.ArgMaxEqualsProgram(t.size,e.size);return this.compileAndRun(r,[t,e])},e.prototype.topKInternal=function(t,e){throw new Error("topK GPU not yet implemented!")},e.prototype.minInternal=function(t){var e=new A.MinMaxProgram(t.size,"min");return this.compileAndRun(e,[t])},e.prototype.maxInternal=function(t){var e=new A.MinMaxProgram(t.size,"max");return this.compileAndRun(e,[t])},e.prototype.divideInternal=function(t,e){var r=new h.BinaryOpProgram(l.DIV,t.shape,e.shape);return this.compileAndRun(r,[t,e])},e.prototype.addInternal=function(t,e){var r=new h.BinaryOpProgram(l.ADD,t.shape,e.shape);return this.compileAndRun(r,[t,e])},e.prototype.subInternal=function(t,e){var r=new h.BinaryOpProgram(l.SUB,t.shape,e.shape);return this.compileAndRun(r,[t,e])},e.prototype.logSumExpInternal=function(t){var e=new w.LogSumExpProgram(t.size);return this.compileAndRun(e,[t])},e.prototype.ceilInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.CEIL);return this.compileAndRun(e,[t])},e.prototype.floorInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.FLOOR);return this.compileAndRun(e,[t])},e.prototype.expInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.EXP);return this.compileAndRun(e,[t])},e.prototype.logInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.LOG);return this.compileAndRun(e,[t])},e.prototype.sqrtInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.SQRT);return this.compileAndRun(e,[t])},e.prototype.reluInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.RELU);return this.compileAndRun(e,[t])},e.prototype.clipInternal=function(t,e,r){var n=new f.ClipProgram(t.shape,e,r);return this.compileAndRun(n,[t])},e.prototype.absInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.ABS);return this.compileAndRun(e,[t])},e.prototype.sigmoidInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.SIGMOID);return this.compileAndRun(e,[t])},e.prototype.sinInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.SIN);return this.compileAndRun(e,[t])},e.prototype.cosInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.COS);return this.compileAndRun(e,[t])},e.prototype.tanInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.TAN);return this.compileAndRun(e,[t])},e.prototype.asinInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.ASIN);return this.compileAndRun(e,[t])},e.prototype.acosInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.ACOS);return this.compileAndRun(e,[t])},e.prototype.atanInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.ATAN);return this.compileAndRun(e,[t])},e.prototype.sinhInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.SINH);return this.compileAndRun(e,[t])},e.prototype.coshInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.COSH);return this.compileAndRun(e,[t])},e.prototype.tanhInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.TANH);return this.compileAndRun(e,[t])},e.prototype.stepInternal=function(t){var e=new D.UnaryOpProgram(t.shape,I.STEP);return this.compileAndRun(e,[t])},e.prototype.conv2dInternal=function(t,e,r,n){var o=new m.Conv2DProgram(n,null!=r),a=null!=r?[t,e,r]:[t,e];return this.compileAndRun(o,a)},e.prototype.conv2dDerInputInternal=function(t,e,r){var n=new v.Conv2DDerInputProgram(r);return this.compileAndRun(n,[t,e])},e.prototype.conv2dDerFilterInternal=function(t,e,r){var n=new v.Conv2DDerWeightsProgram(r);return this.compileAndRun(n,[t,e])},e.prototype.conv2dDerBiasInternal=function(t){var e=new v.Conv2DDerBiasProgram(t.shape);return this.compileAndRun(e,[t])},e.prototype.maxPoolInternal=function(t,e){var r=new C.Pool2DProgram(e,"max",!1);return this.compileAndRun(r,[t])},e.prototype.minPoolInternal=function(t,e){var r=new C.Pool2DProgram(e,"min",!1);return this.compileAndRun(r,[t])},e.prototype.avgPoolInternal=function(t,e){var r=new C.Pool2DProgram(e,"avg",!1);return this.compileAndRun(r,[t])},e.prototype.maxPoolBackpropInternal=function(t,e,r){var n=new C.Pool2DProgram(r,"max",!0),o=this.compileAndRun(n,[e]),a=new _.MaxPool2DBackpropProgram(r),i=this.compileAndRun(a,[t,o]);return o.dispose(),i},e.prototype.resizeBilinear3DInternal=function(t,e,r){var n=new O.ResizeBilinear3DProgram(t.shape,e,r);return this.compileAndRun(n,[t])},e.prototype.multinomialInternal=function(t,e,r){var n=new E.MultinomialProgram(t.size,e),o=n.getCustomSetupFunc(r);return this.compileAndRun(n,[t],null,o)},e.prototype.oneHotInternal=function(t,e,r,n){var o=new S.OneHotProgram(t.size,e,r,n);return this.compileAndRun(o,[t])},e.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){for(var t in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram);this.textureManager.dispose(),this.gpgpuCreatedLocally&&this.gpgpu.dispose()},e}(o.NDArrayMath);r.NDArrayMathGPU=z},{"./math":58,"./ndarray":61,"./webgl/addscaledmat_gpu":63,"./webgl/argmaxequals_gpu":64,"./webgl/argminmax_gpu":65,"./webgl/batchnorm_gpu":66,"./webgl/binaryop_gpu":67,"./webgl/clip_gpu":68,"./webgl/concat_gpu":69,"./webgl/conv_backprop_gpu":70,"./webgl/conv_gpu":71,"./webgl/copy_gpu":72,"./webgl/gpgpu_context":73,"./webgl/gpgpu_math":74,"./webgl/gpgpu_util":75,"./webgl/logsumexp_gpu":76,"./webgl/max_pool_backprop_gpu":77,"./webgl/minmax_gpu":78,"./webgl/mulmat_gpu":79,"./webgl/multinomial_gpu":80,"./webgl/onehot_gpu":81,"./webgl/pool_gpu":82,"./webgl/reducesum_gpu":83,"./webgl/resize_bilinear_gpu":85,"./webgl/slice_gpu":87,"./webgl/switch_dim_gpu":88,"./webgl/texture_manager":90,"./webgl/unaryop_gpu":91,"./webgl/webgl_util":92}],61:[function(t,e,r){"use strict";function n(){if(null==r.GPGPU||null==r.TEXTURE_MANAGER)throw new Error("GPU not intialized.")}function o(t,e){if(null==e||"float32"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var r=new Uint8Array(t.length),n=0;n<r.length;++n)t[n]&&(r[n]=1);return r}throw new Error("Unknown data type "+e)}function a(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function i(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}function s(t,e){return i(t,e)?t:(Array.isArray(t)&&(t=h.flatten(t)),o(t,e))}function u(t,e){if(null==e||"float32"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function c(t,e){if("float32"===e)return t;if("int32"===e||"bool"===e){for(var r="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),n=0;n<r.length;++n)r[n]=Math.round(t[n]);return r}throw new Error("Unknown dtype "+e)}var p=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var l=t("../environment"),h=t("../util"),f=t("./webgl/tex_util"),d=t("./webgl/webgl_util");r.GPGPU=null,r.TEXTURE_MANAGER=null;!function(t){t.float32="float32",t.int32="int32",t.bool="bool"}(r.DType||(r.DType={})),r.initializeGPU=function(t,e){r.GPGPU=t,r.TEXTURE_MANAGER=e};var v=function(){function t(t,e,r){h.assert(null!=e.values||null!=e.texture,"Either `values` or `texture` must be defined"),h.assert(null==e.texture||null!=e.textureShapeRC,"`textureShape` must be defined when `texture` is defined"),this.size=h.sizeFromShape(t),null!=e.values&&h.assert(this.size===e.values.length,"Constructing ndarray of shape ("+this.size+") should match the length of values ("+e.values.length+")"),this.shape=t,null==e.textureType&&(e.textureType=f.TextureType.DEFAULT),this.data=e,this.dtype=r||"float32";var n=this.shape.length;if(n<2)this.strides=[];else{this.strides=new Array(n-1),this.strides[n-2]=this.shape[n-1];for(var o=n-3;o>=0;--o)this.strides[o]=this.strides[o+1]*this.shape[o+1]}}return t.zeros=function(e,r){var n=u(h.sizeFromShape(e),r);return t.make(e,{values:n},r)},t.zerosLike=function(e){return t.zeros(e.shape,e.dtype)},t.like=function(e){var r=o(e.getValues(),e.dtype);return t.make(e.shape,{values:r},e.dtype)},t.make=function(e,r,n){switch(e.length){case 0:return new m(r,n);case 1:return new g(r,n);case 2:return new y(e,r,n);case 3:return new x(e,r,n);case 4:return new b(e,r,n);default:return new t(e,r,n)}},t.fromPixels=function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct NDArray with more than 4 channels from pixels.");var n=[t.height,t.width,e],o=[n[0],n[1]],a=r.TEXTURE_MANAGER.acquireTexture(o),i=f.TextureType.RGBA_COLOR;return r.GPGPU.uploadPixelDataToTexture(a,t),x.make(n,{texture:a,textureShapeRC:o,textureType:i})},t.prototype.reshape=function(e){return e=h.inferFromImplicitShape(e,this.size),h.arraysEqual(this.shape,e)?this:(h.assert(this.size===h.sizeFromShape(e),"new shape and old shape must have the same number of elements."),t.make(e,this.data,this.dtype))},t.prototype.asScalar=function(){return h.assert(1===this.size,"The array must have only 1 element."),this.reshape([])},t.prototype.as1D=function(){return this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.reshape([t,e])},t.prototype.as3D=function(t,e,r){return this.reshape([t,e,r])},t.prototype.as4D=function(t,e,r,n){return this.reshape([t,e,r,n])},t.prototype.asType=function(e){var r=this.getData();return null!=r.values&&(r={values:s(r.values,e)}),t.make(this.shape,r,e)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=t[t.length-1],n=0;n<t.length-1;++n)r+=this.strides[n]*t[n];return this.getValues()[r]},t.prototype.add=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.set.apply(this,[this.get.apply(this,e)+t].concat(e))},t.prototype.set=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var n=e[e.length-1],o=0;o<e.length-1;++o)n+=this.strides[o]*e[o];this.getValues()[n]=t},t.prototype.locToIndex=function(t){for(var e=t[t.length-1],r=0;r<t.length-1;++r)e+=this.strides[r]*t[r];return e},t.prototype.indexToLoc=function(t){for(var e=new Array(this.shape.length),r=0;r<e.length-1;++r)e[r]=Math.floor(t/this.strides[r]),t-=e[r]*this.strides[r];return e[e.length-1]=t,e},t.prototype.fill=function(t){this.getValues().fill(t)},t.prototype.getData=function(){return this.data},t.prototype.getValues=function(){if(null==this.data.values){n();var t=void 0;t=this.data.textureType===f.TextureType.DEFAULT?r.GPGPU.downloadMatrixFromTexture(this.data.texture,this.data.textureShapeRC[0],this.data.textureShapeRC[1]):r.GPGPU.downloadMatrixFromRGBAColorTexture(this.data.texture,this.data.textureShapeRC[0],this.data.textureShapeRC[1],this.shape[2]),this.data.values=c(t,this.dtype),this.disposeTexture()}return this.data.values},t.prototype.getValuesAsync=function(){var t=this;return new Promise(function(e,n){if(null==t.data.values)if(l.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_ENABLED")){r.GPGPU.runQuery(function(){}).then(function(){e(t.getValues())})}else e(t.getValues());else e(t.data.values)})},t.prototype.uploadToGPU=function(t){n(),this.data.textureShapeRC=d.getTextureShapeFromLogicalShape(r.GPGPU.gl,this.shape,t),this.data.texture=r.TEXTURE_MANAGER.acquireTexture(this.data.textureShapeRC),this.data.textureType=f.TextureType.DEFAULT,r.GPGPU.uploadMatrixToTexture(this.data.texture,this.data.textureShapeRC[0],this.data.textureShapeRC[1],new Float32Array(this.data.values)),this.data.values=null},t.prototype.getTexture=function(t){return null==this.data.texture&&this.uploadToGPU(t),this.data.texture},t.prototype.getTextureShapeRC=function(t){return null==this.data.textureShapeRC&&this.uploadToGPU(t),this.data.textureShapeRC},t.prototype.dispose=function(){this.data.values=null,this.shape=null,null!=this.data.texture&&this.disposeTexture()},t.prototype.disposeTexture=function(){n(),r.TEXTURE_MANAGER.releaseTexture(this.data.texture,this.data.textureShapeRC),this.data.texture=null,this.data.textureShapeRC=null,this.data.textureType=null},t.prototype.inGPU=function(){return null!=this.data.texture},t.prototype.equals=function(t){return this.dtype===t.dtype&&h.arraysEqual(this.shape,t.shape)&&h.arraysEqual(this.getValues(),t.getValues())},t.rand=function(e,r){for(var n=h.sizeFromShape(e),o=new Float32Array(n),a=0;a<n;a++)o[a]=r();return t.make(e,{values:o})},t.randNormal=function(e,r,n){return void 0===r&&(r=0),void 0===n&&(n=1),t.rand(e,function(){return h.randGauss(r,n)})},t.randTruncatedNormal=function(e,r,n){return void 0===r&&(r=0),void 0===n&&(n=1),t.rand(e,function(){return h.randGauss(r,n,!0)})},t.randUniform=function(e,r,n){return t.rand(e,function(){return h.randUniform(r,n)})},t}();r.NDArray=v;var m=function(t){function e(e,r){return null!=e.texture&&(e.textureShapeRC=[1,1]),t.call(this,[],e,r)||this}return p(e,t),e.new=function(t,r){return new e({values:s([t],r)},r)},e.prototype.get=function(){return this.getValues()[0]},e.prototype.set=function(t){this.getValues()[0]=t},e.prototype.add=function(t){this.getValues()[0]+=t},e.prototype.asType=function(e){return t.prototype.asType.call(this,e)},e.ZERO=e.new(0),e.ONE=e.new(1),e.TWO=e.new(2),e.NEG_ONE=e.new(-1),e}(v);r.Scalar=m;var g=function(t){function e(e,r){var n=null!=e.values?[e.values.length]:[h.sizeFromShape(e.textureShapeRC)];return t.call(this,n,e,r)||this}return p(e,t),e.new=function(t,r){if(!a(t)){var n=h.inferShape(t);h.assert(1===n.length,"Error constructing Array1D. Shape of values "+n+" is not 1 dimensional.")}return new e({values:s(t,r)},r)},e.prototype.get=function(t){return this.getValues()[t]},e.prototype.set=function(t,e){this.getValues()[e]=t},e.prototype.add=function(t,e){this.getValues()[e]+=t},e.prototype.locToIndex=function(t){return t[0]},e.prototype.indexToLoc=function(t){return[t]},e.prototype.asType=function(e){return t.prototype.asType.call(this,e)},e.zeros=function(t,e){return v.zeros(t,e)},e.randNormal=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),v.rand(t,function(){return h.randGauss(e,r)})},e.randTruncatedNormal=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),v.rand(t,function(){return h.randGauss(e,r,!0)})},e.randUniform=function(t,e,r){return v.rand(t,function(){return h.randUniform(e,r)})},e}(v);r.Array1D=g;var y=function(t){function e(e,r,n){var o=this;return h.assert(2===e.length,"Shape should be of length 2"),o=t.call(this,e,r,n)||this,o.stride0=o.strides[0],o}return p(e,t),e.new=function(t,r,n){if(!a(r)){var o=h.inferShape(r);o.length>1&&h.assertShapesMatch(t,o,"Error when constructing Array2D. Shape of values "+o+" does not match the provided shape "+t+". ")}return new e(t,{values:s(r,n)},n)},e.prototype.get=function(t,e){return this.getValues()[this.stride0*t+e]},e.prototype.set=function(t,e,r){this.getValues()[this.stride0*e+r]=t},e.prototype.add=function(t,e,r){this.getValues()[this.stride0*e+r]+=t},e.prototype.locToIndex=function(t){return this.stride0*t[0]+t[1]},e.prototype.indexToLoc=function(t){return[Math.floor(t/this.stride0),t%this.stride0]},e.prototype.asType=function(e){return t.prototype.asType.call(this,e)},e.zeros=function(t,e){return v.zeros(t,e)},e.randNormal=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),v.rand(t,function(){return h.randGauss(e,r)})},e.randTruncatedNormal=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),v.rand(t,function(){return h.randGauss(e,r,!0)})},e.randUniform=function(t,e,r){return v.rand(t,function(){return h.randUniform(e,r)})},e}(v);r.Array2D=y;var x=function(t){function e(e,r,n){var o=this;return h.assert(3===e.length,"Shape should be of length 3"),o=t.call(this,e,r,n)||this,o.stride0=o.strides[0],o.stride1=o.strides[1],o}return p(e,t),e.new=function(t,r,n){if(!a(r)){var o=h.inferShape(r);o.length>1&&h.assertShapesMatch(t,o,"Error when constructing Array3D. Shape of values "+o+" does not match the provided shape "+t+". ")}return new e(t,{values:s(r,n)},n)},e.prototype.get=function(t,e,r){return this.getValues()[this.stride0*t+this.stride1*e+r]},e.prototype.set=function(t,e,r,n){this.getValues()[this.stride0*e+this.stride1*r+n]=t},e.prototype.add=function(t,e,r,n){this.getValues()[this.stride0*e+this.stride1*r+n]+=t},e.prototype.locToIndex=function(t){return this.stride0*t[0]+this.stride1*t[1]+t[2]},e.prototype.indexToLoc=function(t){var e=Math.floor(t/this.stride0);return t-=e*this.stride0,[e,Math.floor(t/this.stride1),t%this.stride1]},e.prototype.asType=function(e){return t.prototype.asType.call(this,e)},e.zeros=function(t,e){return v.zeros(t,e)},e.randNormal=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),v.rand(t,function(){return h.randGauss(e,r)})},e.randTruncatedNormal=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),v.rand(t,function(){return h.randGauss(e,r,!0)})},e.randUniform=function(t,e,r){return v.rand(t,function(){return h.randUniform(e,r)})},e}(v);r.Array3D=x;var b=function(t){function e(e,r,n){var o=this;return h.assert(4===e.length,"Shape should be of length 4"),o=t.call(this,e,r,n)||this,o.stride0=o.strides[0],o.stride1=o.strides[1],o.stride2=o.strides[2],o}return p(e,t),e.new=function(t,r,n){if(!a(r)){var o=h.inferShape(r);o.length>1&&h.assertShapesMatch(t,o,"Error when constructing Array4D. Shape of values "+o+" does not match the provided shape "+t+". ")}return new e(t,{values:s(r,n)},n)},e.prototype.get=function(t,e,r,n){return this.getValues()[this.stride0*t+this.stride1*e+this.stride2*r+n]},e.prototype.set=function(t,e,r,n,o){this.getValues()[this.stride0*e+this.stride1*r+this.stride2*n+o]=t},e.prototype.add=function(t,e,r,n,o){this.getValues()[this.stride0*e+this.stride1*r+this.stride2*n+o]+=t},e.prototype.locToIndex=function(t){return this.stride0*t[0]+this.stride1*t[1]+this.stride2*t[2]+t[3]},e.prototype.indexToLoc=function(t){var e=Math.floor(t/this.stride0);t-=e*this.stride0;var r=Math.floor(t/this.stride1);return t-=r*this.stride1,[e,r,Math.floor(t/this.stride2),t%this.stride2]},e.prototype.asType=function(e){return t.prototype.asType.call(this,e)},e.zeros=function(t,e){return v.zeros(t,e)},e.randNormal=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),v.rand(t,function(){return h.randGauss(e,r)})},e.randTruncatedNormal=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),v.rand(t,function(){return h.randGauss(e,r,!0)})},e.randUniform=function(t,e,r){return v.rand(t,function(){return h.randUniform(e,r)})},e}(v);r.Array4D=b},{"../environment":15,"../util":94,"./webgl/tex_util":89,"./webgl/webgl_util":92}],62:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../util");r.assertParamsValid=function(t,e,r){n.assert(t.rank===e.length,"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."),n.assert(t.rank===r.length,"Error in slice"+t.rank+"D: Length of size "+r+" must match the rank of the array ("+t.rank+").");for(var o=0;o<t.rank;++o)n.assert(e[o]+r[o]<=t.shape[o],"Error in slice"+t.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+r[o])+") would overflow input.shape["+o+"] ("+t.shape[o]+")")}},{"../util":94}],63:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../../util"),o=function(){return function(t,e){this.variableNames=["A","B","c1","c2"],this.params=[],this.supportsBroadcasting=!0,this.outputShape=n.assertAndGetBroadcastedShape(t,e),this.userCode="\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        float c1 = getC1();\n        float c2 = getC2();\n        setOutput(dot(vec2(c1, c2), vec2(a, b)));\n      }\n    "}}();r.AddScaledMatProgram=o},{"../../util":94}],64:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./argminmax_gpu"),o=function(){return function(t,e){this.variableNames=["A","B"],this.outputShape=[],this.params=[];var r=n.getArgMinMaxSnippet("max","A",t),o=n.getArgMinMaxSnippet("max","B",e);this.userCode="\n      "+r+"\n      "+o+"\n\n      void main() {\n        float argMaxA = getArgMinMaxA();\n        float argMaxB = getArgMinMaxB();\n\n        float value;\n        if (isNaN(argMaxA)) {\n          value = argMaxA;\n        } else if (isNaN(argMaxB)) {\n          value = argMaxB;\n        } else {\n          value = float(argMaxA == argMaxB);\n        }\n\n        setOutput(value);\n      }\n    "}}();r.ArgMaxEqualsProgram=o},{"./argminmax_gpu":65}],65:[function(t,e,r){"use strict";function n(t,e,r){return"\n    float getArgMinMax"+e+"() {\n      int bestIndex = 0;\n      float bestValue = get"+e+"Flat(0);\n\n      for (int i = 0; i < "+r+"; i++) {\n        float candidate = get"+e+"Flat(i);\n        if (isNaN(candidate)) {\n          return candidate;\n        }\n        if (candidate "+("min"===t?"<":">")+" bestValue) {\n          bestValue = candidate;\n          bestIndex = i;\n        }\n      }\n      return float(bestIndex);\n    }\n  "}Object.defineProperty(r,"__esModule",{value:!0}),r.getArgMinMaxSnippet=n;var o=function(){return function(t,e){this.variableNames=["A"],this.outputShape=[],this.params=[e];var r=n(e,"A",t);this.userCode="\n      "+r+"\n\n      void main() {\n        setOutput(getArgMinMaxA());\n      }\n    "}}();r.ArgMinMaxProgram=o},{}],66:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../../util"),o=function(){return function(t,e,r,o,a,i){this.params=[],this.outputShape=[],this.supportsBroadcasting=!0,this.variableNames=["x","mean","variance"],n.assertAndGetBroadcastedShape(t,e),n.assertAndGetBroadcastedShape(t,r);var s="0.0";null!=o&&(n.assertAndGetBroadcastedShape(t,o),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=a&&(n.assertAndGetBroadcastedShape(t,a),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.params=[i],this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+s+";\n        float scale = "+u+";\n        float inv = scale / sqrt(variance + float("+i+"));\n        setOutput((x - mean) * inv + offset);\n      }\n    "}}();r.BatchNormProgram=o},{"../../util":94}],67:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../../util");r.ADD="return a + b;",r.SUB="return a - b;",r.MUL="return a * b;",r.DIV="return a / b;";var o=function(){return function(t,e,r){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.params=[t],this.outputShape=n.assertAndGetBroadcastedShape(e,r),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}}();r.BinaryOpProgram=o},{"../../util":94}],68:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function(t,e,r){this.variableNames=["A"],this.outputShape=t;var n=e.toFixed(20),o=r.toFixed(20);this.params=[n,o],this.userCode="\n      void main() {\n        float value = getAAtOutCoords();\n        if (isNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, "+n+", "+o+"));\n      }\n    "}}();r.ClipProgram=n},{}],69:[function(t,e,r){"use strict";function n(t){if(1===t)return"yR";if(2===t)return"yR, yC";if(3===t)return"yR, yC, yD";if(4===t)return"yR, yC, yD, yW";throw Error("Concat for rank "+t+" is not yet supported")}function o(t){var e=1===t?"int yR = coords;":"int yR = coords.x;";if(t>1&&(e+="\nint yC = coords.y;"),t>2&&(e+="\nint yD = coords.z;"),t>3&&(e+="\nint yW = coords.w;"),t>4)throw Error("Concat for rank "+t+" is not yet supported");return e}function a(t){if(1===t)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";throw Error("Concat for rank "+t+" is not yet supported")}Object.defineProperty(r,"__esModule",{value:!0});var i=t("../concat_util"),s=function(){return function(t,e,r){this.variableNames=["A","B"],this.params=[],this.outputShape=[];var s=["yR","yC","yD","yW"][r];this.params=[r],this.outputShape=i.computeOutShape(t,e,r);var u=a(t.length),c=o(t.length),p=n(t.length);this.userCode="\n      void main() {\n        "+u+" coords = getOutputCoords();\n        "+c+"\n\n        float value = 0.0;\n        if ("+s+" < "+t[r]+") {\n          value = getA("+p+");\n        } else {\n          "+s+" -= "+t[r]+";\n          value = getB("+p+");\n        }\n\n        setOutput(value);\n      }\n    "}}();r.ConcatProgram=s},{"../concat_util":54}],70:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../conv_util"),o=function(){return function(t){this.variableNames=["x","dy"];var e=t.outShape,r=e[0],o=e[1],a=e[2],i=t.inShape,s=i[0],u=i[1],c=i[2],p=t.strideHeight,l=t.strideWidth;this.outputShape=n.computeWeightsShape4D(c,a,t.filterHeight,t.filterWidth);var h=t.padInfo.top,f=t.padInfo.left;this.params=[p,l,f,h],this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int yR = 0; yR < "+r+"; yR++) {\n          int xR = wR + yR * "+p+" - "+h+";\n\n          if (xR < 0 || xR >= "+s+") {\n            continue;\n          }\n\n          for (int yC = 0; yC < "+o+"; yC++) {\n            int xC = wC + yC * "+l+" - "+f+";\n\n            if (xC < 0 || xC >= "+u+") {\n              continue;\n            }\n\n            float dyValue = getDy(yR, yC, d2);\n            float xValue = getX(xR, xC, d1);\n            dotProd += (xValue * dyValue);\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();r.Conv2DDerWeightsProgram=o;var a=function(){return function(t){this.variableNames=["dy","W"];var e=t.outShape,r=e[0],n=e[1],o=e[2];this.outputShape=t.inShape;var a=t.filterHeight,i=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=a-1-t.padInfo.top,p=i-1-t.padInfo.left;this.params=[s,u,p,c],this.userCode="\n      const ivec2 pads = ivec2("+c+", "+p+");\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int d1 = coords.z;\n\n        ivec2 dyCorner = coords.xy - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+a+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+s+".0;\n\n          if (dyR < 0.0 || dyR >= "+r+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+a+" - 1 - wR;\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+u+".0;\n\n            if (dyC < 0.0 || dyC >= "+n+".0 || fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+i+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+o+"; d2++) {\n              float xValue = getDy(idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();r.Conv2DDerInputProgram=a;var i=function(){return function(t){this.variableNames=["dy"],this.params=[];var e=t[0],r=t[1],n=t[2];this.outputShape=[n],this.userCode="\n      void main() {\n        int d2 = getOutputCoords();\n\n        float derBias = 0.0;\n        for (int yR = 0; yR < "+e+"; yR++) {\n          for (int yC = 0; yC < "+r+"; yC++) {\n            derBias += getDy(yR, yC, d2);\n          }\n        }\n        setOutput(derBias);\n      }\n    "}}();r.Conv2DDerBiasProgram=i},{"../conv_util":55}],71:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function(t,e){this.variableNames=["x","W"],e&&this.variableNames.push("bias"),this.outputShape=t.outShape;var r=e?"dotProd += getBias(d2);":"",n=t.inShape,o=n[0],a=n[1],i=n[2],s=t.padInfo.top,u=t.padInfo.left,c=t.strideHeight,p=t.strideWidth,l=t.filterHeight,h=t.filterWidth;this.params=[c,p,e,u,s];var f=4*Math.floor(i/4),d=i%4;this.userCode="\n      const ivec2 strides = ivec2("+c+", "+p+");\n      const ivec2 pads = ivec2("+s+", "+u+");\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int d2 = coords.z;\n\n        ivec2 xRCCorner = coords.xy * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC;\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(xR, xC, d1),\n                getX(xR, xC, d1 + 1),\n                getX(xR, xC, d1 + 2),\n                getX(xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===d)+") {\n              dotProd +=\n                getX(xR, xC, "+f+") *\n                getW(wR, wC, "+f+", d2);\n            } else if ("+(2===d)+") {\n              vec2 xValues = vec2(\n                getX(xR, xC, "+f+"),\n                getX(xR, xC, "+f+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===d)+") {\n              vec3 xValues = vec3(\n                getX(xR, xC, "+f+"),\n                getX(xR, xC, "+f+" + 1),\n                getX(xR, xC, "+f+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2),\n                getW(wR, wC, "+f+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        "+r+"\n        setOutput(dotProd);\n      }\n    "}}();r.Conv2DProgram=n},{}],72:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e){this.variableNames=["source"],this.outputShape=null,this.params=[t,e],this.userCode="\n      uniform ivec2 sourceStart;\n      uniform ivec2 destStart;\n\n      void main() {\n        ivec2 destCoords = getOutputCoords() - destStart;\n        int index = destCoords.x * "+e+" + destCoords.y;\n        int r = index / "+t+";\n        ivec2 sourceCoords = sourceStart + ivec2(r, index - r * "+t+");\n        setOutput(getSource(sourceCoords.x, sourceCoords.y));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e,r){return function(n,o){n.setOutputMatrixWriteRegion(e[0],r[0],e[1],r[1]);var a=n.getUniformLocation(o,"sourceStart");n.gl.uniform2i(a,t[0],t[1]);var i=n.getUniformLocation(o,"destStart");n.gl.uniform2i(i,e[0],e[1])}},t}();r.Copy2DProgram=n},{}],73:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../../environment"),o=t("../../util"),a=t("./gpgpu_util"),i=t("./tex_util"),s=t("./webgl_util"),u=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.gl=null!=t?t:a.createWebGLContext(),1===n.ENV.get("WEBGL_VERSION")?(this.textureFloatExtension=s.getExtensionOrThrow(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float")):this.colorBufferFloatExtension=s.getExtensionOrThrow(this.gl,"EXT_color_buffer_float"),this.loseContextExtension=s.getExtensionOrThrow(this.gl,"WEBGL_lose_context"),this.vertexBuffer=a.createVertexBuffer(this.gl),this.indexBuffer=a.createIndexBuffer(this.gl),this.framebuffer=s.createFramebuffer(this.gl)}return t.prototype.dispose=function(){var t=this;this.throwIfDisposed(),null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;s.callAndCheck(e,function(){return e.finish()}),s.callAndCheck(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),s.callAndCheck(e,function(){return e.deleteFramebuffer(t.framebuffer)}),s.callAndCheck(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),s.callAndCheck(e,function(){return e.deleteBuffer(t.vertexBuffer)}),s.callAndCheck(e,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),s.callAndCheck(e,function(){return e.deleteBuffer(t.indexBuffer)}),this.loseContextExtension.loseContext(),this.disposed=!0},t.prototype.enableAutomaticDebugValidation=function(t){this.autoDebugValidate=t,s.enableDebugWebGLErrorChecking(t)},t.prototype.createMatrixTexture=function(t,e){return this.throwIfDisposed(),a.createMatrixTexture(this.gl,t,e)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),a.uploadPixelDataToTexture(this.gl,t,e)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),a.createPackedMatrixTexture(this.gl,t,e)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(s.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer),this.outputTexture=null),s.callAndCheck(this.gl,function(){return e.gl.deleteTexture(t)})},t.prototype.uploadMatrixToTexture=function(t,e,r,n){this.throwIfDisposed();return a.uploadMatrixToTexture(this.gl,t,e,r,n,1)},t.prototype.uploadMatrixToPackedTexture=function(t,e,r,n){return this.throwIfDisposed(),a.uploadMatrixToPackedTexture(this.gl,t,e,r,n)},t.prototype.downloadMatrixFromTexture=function(t,e,r){var n=this;return this.downloadMatrixDriver(t,function(){return a.downloadMatrixFromOutputTexture(n.gl,e,r)})},t.prototype.downloadMatrixFromRGBAColorTexture=function(t,e,r,n){var o=this;return this.downloadMatrixDriver(t,function(){return a.downloadMatrixFromRGBAColorTexture(o.gl,e,r,n)})},t.prototype.downloadMatrixFromPackedTexture=function(t,e,r){var n=this;return this.downloadMatrixDriver(t,function(){return a.downloadMatrixFromPackedOutputTexture(n.gl,e,r)})},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,r=s.createFragmentShader(e,t),n=a.createVertexShader(e),o=s.createProgram(e);return s.callAndCheck(e,function(){return e.attachShader(o,n)}),s.callAndCheck(e,function(){return e.attachShader(o,r)}),s.linkProgram(e,o),this.autoDebugValidate&&s.validateProgram(e,o),o},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&s.callAndCheck(this.gl,function(){return e.gl.deleteProgram(t)})},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.autoDebugValidate&&s.validateProgram(this.gl,this.program),s.callAndCheck(this.gl,function(){return e.gl.useProgram(t)})},t.prototype.getUniformLocation=function(t,e){return this.throwIfDisposed(),s.getProgramUniformLocationOrThrow(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var r=this;return this.throwIfDisposed(),s.callAndCheck(this.gl,function(){return r.gl.getAttribLocation(t,e)})},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),s.bindTextureToProgramUniformSampler(this.gl,this.program,t,e,r)},t.prototype.setOutputMatrixTexture=function(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,r){this.throwIfDisposed();var n=i.getPackedMatrixTextureShapeWidthHeight(e,r),o=n[0],a=n[1];this.setOutputMatrixTextureDriver(t,o,a)},t.prototype.setOutputMatrixWriteRegion=function(t,e,r,n){this.setOutputMatrixWriteRegionDriver(r,t,n,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,r,n){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&s.validateProgram(this.gl,this.program),s.validateFramebuffer(this.gl)},t.prototype.executeProgram=function(t){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;a.bindVertexProgramAttributeStreams(e,this.program,this.vertexBuffer,t),this.autoDebugValidate&&this.debugValidate(),s.callAndCheck(e,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),s.callAndCheck(this.gl,function(){return t.gl.finish()})},t.prototype.runQuery=function(t){return 2===n.ENV.get("WEBGL_VERSION")?this.runQueryWebGL2(t):this.runQueryWebGL1(t)},t.prototype.runQueryWebGL2=function(t){var e=this,r=s.getExtensionOrThrow(this.gl,"EXT_disjoint_timer_query_webgl2"),n=this.gl.createQuery();return this.gl.beginQuery(r.TIME_ELAPSED_EXT,n),t(),this.gl.endQuery(r.TIME_ELAPSED_EXT),new Promise(function(t,a){o.repeatedTry(function(){var t=e.gl.getQueryParameter(n,e.gl.QUERY_RESULT_AVAILABLE),o=e.gl.getParameter(r.GPU_DISJOINT_EXT);return t&&!o}).then(function(){var r=e.gl.getQueryParameter(n,e.gl.QUERY_RESULT);t(r/1e6)}).catch(function(){console.warn("Disjoint query timer never available."),t(-1)})})},t.prototype.runQueryWebGL1=function(t){var e=this,r=s.getExtensionOrThrow(this.gl,"EXT_disjoint_timer_query"),n=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,n),t(),r.endQueryEXT(r.TIME_ELAPSED_EXT),new Promise(function(t,a){o.repeatedTry(function(){var t=r.getQueryObjectEXT(n,r.QUERY_RESULT_AVAILABLE_EXT),o=e.gl.getParameter(r.GPU_DISJOINT_EXT);return t&&!o}).then(function(){var e=r.getQueryObjectEXT(n,r.QUERY_RESULT_EXT);t(e/1e6)}).catch(function(){console.warn("Disjoint query timer never available."),t(-1)})})},t.prototype.downloadMatrixDriver=function(t,e){this.throwIfDisposed(),s.bindColorTextureToFramebuffer(this.gl,t,this.framebuffer),this.autoDebugValidate&&s.validateFramebuffer(this.gl);var r=e();return null!=this.outputTexture?(s.bindColorTextureToFramebuffer(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&s.validateFramebuffer(this.gl)):s.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer),r},t.prototype.setOutputMatrixTextureDriver=function(t,e,r){this.throwIfDisposed();var n=this.gl;s.bindColorTextureToFramebuffer(n,t,this.framebuffer),this.autoDebugValidate&&s.validateFramebuffer(n),this.outputTexture=t,s.callAndCheck(n,function(){return n.viewport(0,0,e,r)}),s.callAndCheck(n,function(){return n.scissor(0,0,e,r)})},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,r,n){var o=this;this.throwIfDisposed(),s.callAndCheck(this.gl,function(){return o.gl.scissor(t,e,r,n)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();r.GPGPUContext=u},{"../../environment":15,"../../util":94,"./gpgpu_util":75,"./tex_util":89,"./webgl_util":92}],74:[function(t,e,r){"use strict";function n(){return!a.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")}function o(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach(function(t,r){var n=t.logicalShape,o=t.texShape,a=e[r].shape,s=e[r].getTextureShapeRC();if(!i.arraysEqual(n,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+n+" and "+a+" must match");if(!i.arraysEqual(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+s+" must match")})}Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../environment"),i=t("../../util"),s=t("./shader_compiler"),u=["uv","clipSpacePos"],c="NaN";r.compileProgram=function(t,e,r,o){for(var a=e.userCode,i=r.map(function(t,r){var n={logicalShape:t.shape,texShape:t.getTextureShapeRC(),textureType:t.getData().textureType};return{name:e.variableNames[r],shapeInfo:n}}),p=i.map(function(t){return t.shapeInfo}),l={logicalShape:o.shape,texShape:o.getTextureShapeRC(),textureType:o.getData().textureType},h=s.makeShader(i,l,a,!0===e.supportsBroadcasting),f=t.createProgram(h),d={},v=0;v<e.variableNames.length;v++){var m=e.variableNames[v];d[m]=t.getUniformLocation(f,m)}var g={};return u.forEach(function(e){g[e]=t.getAttributeLocation(f,e)}),n()&&(d[c]=t.getUniformLocation(f,c)),{program:e,source:h,webGLProgram:f,uniformLocations:d,attributeLocations:g,gpgpu:t,inShapeInfos:p,outShapeInfo:l}},r.runProgram=function(t,e,r,a){o(t.inShapeInfos,e),o([t.outShapeInfo],[r]);var i=r.getTexture(),s=r.getTextureShapeRC(),u=t.gpgpu;u.setOutputMatrixTexture(i,s[0],s[1]),u.setProgram(t.webGLProgram),e.forEach(function(e,r){var n=e.getTexture(),o=t.program.variableNames[r],a=t.uniformLocations[o];u.setInputMatrixTexture(n,a,r)}),n()&&u.gl.uniform1f(t.uniformLocations[c],NaN),null!=a&&a(u,t.webGLProgram),u.executeProgram(t.attributeLocations)},r.makeShaderKey=function(t,e,r){var n=t.params,o=e.concat(r).map(function(t){return t.shape+"_"+t.getTextureShapeRC()}),a=n.map(String),i=[t.constructor.name];return i.push((!0===t.supportsBroadcasting).toString()),(i=i.concat(o,a)).join("_")}},{"../../environment":15,"../../util":94,"./shader_compiler":86}],75:[function(t,e,r){"use strict";function n(){return{alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0}}function o(t,e){return c.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")&&2===c.ENV.get("WEBGL_VERSION")?4===e?t.RGBA32F:t.R32F:t.RGBA}function a(t,e){return c.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")&&2===c.ENV.get("WEBGL_VERSION")?4===e?t.RGBA:t.RED:t.RGBA}function i(t){return c.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?t.FLOAT:t.UNSIGNED_BYTE}function s(t,e,r,n){l.validateTextureSize(t,e,r);var s=l.createTexture(t),u=t.TEXTURE_2D,c=o(t,n),p=a(t,n);return l.callAndCheck(t,function(){return t.bindTexture(u,s)}),l.callAndCheck(t,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),l.callAndCheck(t,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),l.callAndCheck(t,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),l.callAndCheck(t,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),l.callAndCheck(t,function(){return t.texImage2D(u,0,c,e,r,0,p,i(t),null)}),l.callAndCheck(t,function(){return t.bindTexture(t.TEXTURE_2D,null)}),s}function u(t,e,r,n,o,s){var u=a(t,s);l.validateTextureSize(t,r,n),l.callAndCheck(t,function(){return t.bindTexture(t.TEXTURE_2D,e)}),l.callAndCheck(t,function(){return t.texSubImage2D(t.TEXTURE_2D,0,0,0,r,n,u,i(t),o)}),l.callAndCheck(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})}Object.defineProperty(r,"__esModule",{value:!0});var c=t("../../environment"),p=t("./tex_util"),l=t("./webgl_util");r.getWebGLContextAttributes=n,r.createWebGLContext=function(t){var e,r=n();return e=null!=t?l.createWebGLRenderingContextFromCanvas(t,r):l.createWebGLRenderingContext(r),l.callAndCheck(e,function(){return e.disable(e.DEPTH_TEST)}),l.callAndCheck(e,function(){return e.disable(e.STENCIL_TEST)}),l.callAndCheck(e,function(){return e.disable(e.BLEND)}),l.callAndCheck(e,function(){return e.disable(e.DITHER)}),l.callAndCheck(e,function(){return e.disable(e.POLYGON_OFFSET_FILL)}),l.callAndCheck(e,function(){return e.disable(e.SAMPLE_COVERAGE)}),l.callAndCheck(e,function(){return e.enable(e.SCISSOR_TEST)}),l.callAndCheck(e,function(){return e.enable(e.CULL_FACE)}),l.callAndCheck(e,function(){return e.cullFace(e.BACK)}),e},r.createVertexShader=function(t){return l.createVertexShader(t,"\n    precision highp float;\n    attribute vec3 clipSpacePos;\n    attribute vec2 uv;\n    varying vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")},r.createVertexBuffer=function(t){var e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return l.createStaticVertexBuffer(t,e)},r.createIndexBuffer=function(t){var e=new Uint16Array([0,1,2,2,1,3]);return l.createStaticIndexBuffer(t,e)},r.createMatrixTexture=function(t,e,r){var n=p.getUnpackedMatrixTextureShapeWidthHeight(e,r);return s(t,n[0],n[1],1)},r.createColorMatrixTexture=function(t,e,r){var n=p.getColorMatrixTextureShapeWidthHeight(e,r);return s(t,n[0],n[1],4)},r.createPackedMatrixTexture=function(t,e,r){var n=p.getPackedMatrixTextureShapeWidthHeight(e,r);return s(t,n[0],n[1],4)},r.bindVertexProgramAttributeStreams=function(t,e,r,n){l.callAndCheck(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),l.bindVertexBufferToProgramAttribute(t,e,"clipSpacePos",r,3,20,0,n),l.bindVertexBufferToProgramAttribute(t,e,"uv",r,2,20,12,n)},r.uploadPixelDataToTexture=function(t,e,r){l.callAndCheck(t,function(){return t.bindTexture(t.TEXTURE_2D,e)}),l.callAndCheck(t,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),l.callAndCheck(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})},r.uploadMatrixToTexture=function(t,e,r,n,o,a){var i,s=p.getUnpackedMatrixTextureShapeWidthHeight(r,n),h=s[0],f=s[1];if(c.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")){var d=1===a?l.getChannelsPerTexture():a;1===d?i=o:(i=new Float32Array(p.getUnpackedArraySizeFromMatrixSize(o.length,d)),p.encodeMatrixToUnpackedArray(o,i,d))}else i=p.encodeFloatArray(o);u(t,e,h,f,i,a)},r.uploadMatrixToPackedTexture=function(t,e,r,n,o){var a=p.getPackedMatrixTextureShapeWidthHeight(r,n),i=a[0],s=a[1],c=new Float32Array(p.getPackedRGBAArraySizeFromMatrixShape(r,n));p.encodeMatrixToPackedRGBA(o,r,n,c);u(t,e,i,s,c,4)},r.downloadMatrixFromOutputTexture=function(t,e,r){var n,o=p.getUnpackedMatrixTextureShapeWidthHeight(e,r),a=o[0],s=o[1],u=c.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED");if(n=u?new Float32Array(p.getUnpackedArraySizeFromMatrixSize(e*r,4)):new Uint8Array(e*r*4),l.callAndCheck(t,function(){return t.readPixels(0,0,a,s,t.RGBA,i(t),n)}),u){var h=new Float32Array(e*r);return p.decodeMatrixFromUnpackedArray(n,h,4),h}return p.decodeToFloatArray(n)},r.downloadMatrixFromRGBAColorTexture=function(t,e,r,n){var o=e*r*4,a=new Uint8Array(o);l.callAndCheck(t,function(){return t.readPixels(0,0,r,e,t.RGBA,t.UNSIGNED_BYTE,a)});for(var i=new Float32Array(o),s=0;s<a.length;s++)i[s]=a[s];var u=new Float32Array(e*r*n);return p.decodeMatrixFromUnpackedColorRGBAArray(i,u,n),u},r.downloadMatrixFromPackedOutputTexture=function(t,e,r){var n=p.getPackedMatrixTextureShapeWidthHeight(e,r),o=n[0],a=n[1],s=new Float32Array(p.getPackedRGBAArraySizeFromMatrixShape(e,r));l.callAndCheck(t,function(){return t.readPixels(0,0,o,a,t.RGBA,i(t),s)});var u=new Float32Array(e*r);return p.decodeMatrixFromPackedRGBA(s,e,r,u)}},{"../../environment":15,"./tex_util":89,"./webgl_util":92}],76:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function(t){this.variableNames=["A"],this.params=[],this.outputShape=[];var e=4*Math.floor(t/4),r=t%4,n=e,o=e+1,a=e+2;this.userCode="\n      const vec2 ones2 = vec2(1, 1);\n      const vec3 ones3 = vec3(1, 1, 1);\n      const vec4 ones4 = vec4(1, 1, 1, 1);\n\n      void main() {\n        vec4 maxVec = vec4(getAFlat(0));\n        for (int i = 0; i < "+e+"; i += 4) {\n          vec4 aVec = vec4(getAFlat(i), getAFlat(i+1),\n                           getAFlat(i+2), getAFlat(i+3));\n          maxVec = max(maxVec, aVec);\n        }\n        if ("+(1===r)+") {\n          maxVec = max(maxVec, vec4(maxVec.xyz, getAFlat("+n+")));\n        } else if ("+(2===r)+") {\n          vec2 aVec = vec2(getAFlat("+n+"), getAFlat("+o+"));\n          maxVec = max(maxVec, vec4(maxVec.xy, aVec));\n        } else if ("+(3===r)+") {\n          vec3 aVec = vec3(getAFlat("+n+"), getAFlat("+o+"), getAFlat("+a+"));\n          maxVec = max(maxVec, vec4(maxVec.x, aVec));\n        }\n        float finalMax = max(maxVec.x, max(maxVec.y, max(maxVec.z, maxVec.w)));\n\n        float expSum = 0.0;\n        for (int i = 0; i < "+e+"; i += 4) {\n          vec4 aVec = vec4(getAFlat(i), getAFlat(i+1),\n                           getAFlat(i+2), getAFlat(i+3));\n          expSum += dot(ones4, exp(aVec - finalMax));\n        }\n        if ("+(1===r)+") {\n          expSum += exp(getAFlat("+n+") - finalMax);\n        } else if ("+(2===r)+") {\n          vec2 aVec = vec2(getAFlat("+n+"), getAFlat("+o+"));\n          expSum += dot(ones2, exp(aVec - finalMax));\n        } else if ("+(3===r)+") {\n          vec3 aVec = vec3(getAFlat("+n+"), getAFlat("+o+"), getAFlat("+a+"));\n          expSum += dot(ones3, exp(aVec - finalMax));\n        }\n\n        setOutput(finalMax + log(expSum));\n      }\n    "}}();r.LogSumExpProgram=n},{}],77:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.outShape[0],r=t.outShape[1],n=t.filterHeight,o=t.filterWidth,a=t.strideHeight,i=t.strideWidth,s=n-1-t.padInfo.top,u=o-1-t.padInfo.left;this.params=[n,o,a,i,s,u];var c=n*o-1;this.userCode="\n      const ivec2 pads = ivec2("+s+", "+u+");\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int d = coords.z;\n\n        ivec2 dyRCCorner = coords.xy - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+n+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+a+".0;\n\n          if (dyR < 0.0 || dyR >= "+e+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+r+".0 || fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(idyR, idyC, d);\n            int maxPosValue = "+c+" - int(getMaxPos(idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+o+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();r.MaxPool2DBackpropProgram=n},{}],78:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function(t,e){this.variableNames=["A"],this.outputShape=[],this.params=[e];var r=4*Math.floor(t/4),n=t%4,o=r,a=r+1,i=r+2;this.userCode="\n      void main() {\n        vec4 bestVec = vec4(getAFlat(0));\n        for (int i = 0; i < "+r+"; i += 4) {\n          vec4 aVec = vec4(getAFlat(i), getAFlat(i+1),\n                           getAFlat(i+2), getAFlat(i+3));\n          if (hasNaN(aVec)) {\n            setOutput(getNaN(aVec));\n            return;\n          }\n          bestVec = "+e+"(bestVec, aVec);\n        }\n        vec4 aVec;\n        if ("+(1===n)+") {\n          aVec = vec4(bestVec.xyz, getAFlat("+o+"));\n        } else if ("+(2===n)+") {\n          aVec = vec4(bestVec.xy, vec2(getAFlat("+o+"), getAFlat("+a+")));\n        } else if ("+(3===n)+") {\n          aVec = vec4(bestVec.x,\n                      vec3(getAFlat("+o+"), getAFlat("+a+"), getAFlat("+i+")));\n        }\n        if ("+(n>0)+") {\n          if (hasNaN(aVec)) {\n            setOutput(getNaN(aVec));\n            return;\n          }\n          bestVec = "+e+"(bestVec, aVec);\n        }\n\n        float final = "+e+"(bestVec.x, "+e+"(bestVec.y,\n                      "+e+"(bestVec.z, bestVec.w)));\n        setOutput(final);\n      }\n    "}}();r.MinMaxProgram=n},{}],79:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../math"),o=function(){return function(t,e,r,o){void 0===r&&(r=n.MatrixOrientation.REGULAR),void 0===o&&(o=n.MatrixOrientation.REGULAR),this.variableNames=["matrixA","matrixB"],this.params=[r,o];var a=r===n.MatrixOrientation.REGULAR?t[0]:t[1],i=o===n.MatrixOrientation.REGULAR?e[1]:e[0];this.outputShape=[a,i];var s=r===n.MatrixOrientation.REGULAR?t[1]:t[0],u=function(t,e){return r===n.MatrixOrientation.REGULAR?"aRow, "+e+" + "+t:e+" + "+t+", aRow"},c=function(t,e){return o===n.MatrixOrientation.REGULAR?e+" + "+t+", bCol":"bCol, "+e+" + "+t},p=4*Math.floor(s/4),l=s%4;this.userCode=" float dotARowBCol(int aRow, int bCol) {\n      float result = 0.0;\n      for (int i = 0; i < "+p+"; i += 4) {\n        vec4 a = vec4(\n          getMatrixA("+u(0,"i")+"),\n          getMatrixA("+u(1,"i")+"),\n          getMatrixA("+u(2,"i")+"),\n          getMatrixA("+u(3,"i")+")\n        );\n        vec4 b = vec4(\n          getMatrixB("+c(0,"i")+"),\n          getMatrixB("+c(1,"i")+"),\n          getMatrixB("+c(2,"i")+"),\n          getMatrixB("+c(3,"i")+")\n        );\n\n        result += dot(a, b);\n      }\n\n      if ("+(1===l)+") {\n        result += getMatrixA("+u(0,p)+") *\n          getMatrixB("+c(0,p)+");\n      } else if ("+(2===l)+") {\n        vec2 a = vec2(\n          getMatrixA("+u(0,p)+"),\n          getMatrixA("+u(1,p)+")\n        );\n        vec2 b = vec2(\n          getMatrixB("+c(0,p)+"),\n          getMatrixB("+c(1,p)+")\n        );\n        result += dot(a, b);\n      } else if ("+(3===l)+") {\n        vec3 a = vec3(\n          getMatrixA("+u(0,p)+"),\n          getMatrixA("+u(1,p)+"),\n          getMatrixA("+u(2,p)+")\n        );\n        vec3 b = vec3(\n          getMatrixB("+c(0,p)+"),\n          getMatrixB("+c(1,p)+"),\n          getMatrixB("+c(2,p)+")\n        );\n        result += dot(a, b);\n      }\n\n      return result;\n    }\n\n    void main() {\n      ivec2 resRC = getOutputCoords();\n      setOutput(dotARowBCol(resRC.x, resRC.y));\n    }\n    "}}();r.MatMulProgram=o},{"../math":58}],80:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e){this.variableNames=["probs"],this.outputShape=[e],this.params=[],this.userCode="\n      uniform float seed;\n\n      void main() {\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,n){null==e.seedLoc&&(e.seedLoc=r.getUniformLocation(n,"seed")),r.gl.uniform1f(e.seedLoc,t)}},t}();r.MultinomialProgram=n},{}],81:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e,r,n){this.variableNames=["indices"],this.outputShape=[t,e],this.params=[r,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+n+"), float("+r+"),\n                      float(index == coords.y)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,n){null==e.seedLoc&&(e.seedLoc=r.getUniformLocation(n,"seed")),r.gl.uniform1f(e.seedLoc,t)}},t}();r.OneHotProgram=n},{}],82:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function(t,e,r){if(this.variableNames=["x"],"avg"===e&&r)throw new Error("Cannot compute positions for average pool.");var n=t.filterHeight,o=t.filterWidth,a=t.strideHeight,i=t.strideWidth,s=t.inShape[0],u=t.inShape[1],c=t.padInfo.top,p=t.padInfo.left;this.params=[a,i,p,c,e,r],this.outputShape=t.outShape;var l="avg"===e,h="0.0";if(l||(h="min"===e?"1.0 / 0.0":"-1.0 / 0.0"),r){var f="min"===e?"<=":">=";this.userCode="\n        const ivec2 strides = ivec2("+a+", "+i+");\n        const ivec2 pads = ivec2("+c+", "+p+");\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n          int d = coords.z;\n\n          ivec2 xRCCorner = coords.xy * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+s+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+o+"; wC++) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+u+") {\n                continue;\n              }\n\n              float value = getX(xR, xC, d);\n\n              if (isNaN(value)) {\n                setOutput(value);\n                return;\n              }\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value "+f+" currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+o+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "}else{var d="min"===e?"min":"max",v=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(v="avgValue / "+n*o+".0");var m=4*Math.floor(o/4),g=o%4,y="\n      if (hasNaN(values)) {\n        setOutput(getNaN(values));\n        return;\n      }\n      if ("+l+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = "+d+"(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+a+", "+i+");\n      const ivec2 pads = ivec2("+c+", "+p+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+u+") {\n          return initializationValue;\n        }\n        return getX(xR, xC, d);\n      }\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int d = coords.z;\n\n        ivec2 xRCCorner = coords.xy * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n\n        for (int wR = 0; wR < "+n+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+s+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC;\n\n            vec4 values = vec4(\n              getValue(xR, xC, d),\n              getValue(xR, xC + 1, d),\n              getValue(xR, xC + 2, d),\n              getValue(xR, xC + 3, d)\n            );\n\n            "+y+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===g)+") {\n            vec4 values = vec4(\n              getValue(xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n            "+y+"\n          } else if ("+(2===g)+") {\n            vec4 values = vec4(\n              getValue(xR, xC, d),\n              getValue(xR, xC + 1, d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+y+"\n          } else if ("+(3===g)+") {\n            vec4 values = vec4(\n              getValue(xR, xC, d),\n              getValue(xR, xC + 1, d),\n              getValue(xR, xC + 2, d),\n              initializationValue\n            );\n\n            "+y+"\n          }\n        }\n        setOutput("+v+");\n      }\n    "}}}();r.Pool2DProgram=n},{}],83:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function(t){this.size=t,this.variableNames=["A"],this.params=[],this.outputShape=[];var e=4*Math.floor(t/4),r=t%4,n=e,o=e+1,a=e+2;this.userCode="\n      void main() {\n        const vec2 ones2 = vec2(1);\n        const vec3 ones3 = vec3(1);\n        const vec4 ones4 = vec4(1);\n\n        float sum = 0.0;\n        for (int i = 0; i < "+e+"; i += 4) {\n          vec4 aVec = vec4(getAFlat(i), getAFlat(i+1),\n                           getAFlat(i+2), getAFlat(i+3));\n          sum += dot(ones4, aVec);\n        }\n\n        if ("+(1===r)+") {\n          sum += getAFlat("+n+");\n        } else if ("+(2===r)+") {\n          vec2 aVec = vec2(getAFlat("+n+"), getAFlat("+o+"));\n          sum += dot(ones2, aVec);\n        } else if ("+(3===r)+") {\n          vec3 aVec = vec3(getAFlat("+n+"), getAFlat("+o+"), getAFlat("+a+"));\n          sum += dot(ones3, aVec);\n        }\n\n        setOutput(sum);\n      }\n    "}}();r.ReduceSumProgram=n},{}],84:[function(t,e,r){"use strict";function n(t,e,r){t.setProgram(e);var n=o.getProgramUniformLocationOrThrow(t.gl,e,"source");t.setInputMatrixTexture(r,n,0),t.executeProgram()}Object.defineProperty(r,"__esModule",{value:!0});var o=t("./webgl_util");r.getRenderRGBShader=function(t,e){var r="\n    precision highp float;\n    uniform sampler2D source;\n    varying vec2 resultUV;\n\n    const float destinationWidth = "+e+".0;\n    const float a = 1.0;\n\n    void main() {\n      float xr = floor(resultUV.s * destinationWidth) * 3.0;\n      vec3 x = xr + vec3(0, 1, 2);\n\n      float sourceWidth = destinationWidth * 3.0;\n      vec3 u = (x + 0.5) / sourceWidth;\n      float v = 1.0 - resultUV.t;\n\n      float r = texture2D(source, vec2(u[0], v)).r;\n      float g = texture2D(source, vec2(u[1], v)).r;\n      float b = texture2D(source, vec2(u[2], v)).r;\n\n      gl_FragColor = vec4(r, g, b, a);\n    }";return t.createProgram(r)},r.renderToCanvas=function(t,e,r){o.bindCanvasToFramebuffer(t.gl),n(t,e,r)},r.renderToFramebuffer=n},{"./webgl_util":92}],85:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function(t,e,r){this.variableNames=["A"],this.params=[],this.outputShape=[];var n=t[2];this.outputShape=[e[0],e[1],n],this.params=[r];var o=r?[t[0]-1,t[1]-1,n]:t,a=r?[this.outputShape[0]-1,this.outputShape[1]-1,n]:this.outputShape;this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+o[0]/a[0]+",\n          "+o[1]/a[1]+");\n      const vec2 inputShapeRC = vec2("+t[0]+".0, "+t[1]+".0);\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        ivec2 yRC = coords.xy;\n        int d = coords.z;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "}}();r.ResizeBilinear3DProgram=n},{}],86:[function(t,e,r){"use strict";function n(){return y.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?T:_}function o(){return y.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?E:A}function a(t,e,r){var n=t.shapeInfo.logicalShape,o=t.shapeInfo.texShape,a=e.texShape,i="";switch(n.length){case 0:i+=l(t);break;case 1:i+=h(t,o);break;case 2:i+=f(t,n,o);break;case 3:i+=d(t,n,o);break;case 4:i+=v(t,n,o);break;default:throw new Error(n.length+"-D input sampling is not yet supported")}return(r||x.arraysEqual(t.shapeInfo.logicalShape,e.logicalShape))&&(i+=g(t,o,a,r)),i+=m(t.name,o)}function i(t,e){switch(t.length){case 0:return"";case 1:return s(t,e);case 2:return p(t,e);case 3:return u(t,e);case 4:return c(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}}function s(t,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}function u(t,e){var r=t[1]*t[2],n=t[2];return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+r+";\n      index -= r * "+r+";\n      int c = index / "+n+";\n      int d = index - c * "+n+";\n      return ivec3(r, c, d);\n    }\n  "}function c(t,e){var r=t[3],n=t[2]*r,o=t[1]*n;return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      int r = index / "+o+";\n      index -= r * "+o+";\n\n      int c = index / "+n+";\n      index -= c * "+n+";\n\n      int d = index / "+r+";\n      int d2 = index - d * "+r+";\n\n      return ivec4(r, c, d, d2);\n    }\n  "}function p(t,e){return x.arraysEqual(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}function l(t){var e=t.name;return"\n    float "+("get"+e.charAt(0).toUpperCase()+e.slice(1))+"() {\n      return sample("+e+", halfCR);\n    }\n  "}function h(t,e){var r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e[0],a=e[1];return 1===e[0]&&1===e[1]?"\n      float "+n+"(int index) {\n        return sample("+r+", halfCR);\n      }\n    ":1===e[1]?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index) + 0.5) / "+o+".0);\n        return sample("+r+", uv);\n      }\n    ":1===e[0]?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index) + 0.5) / "+a+".0, 0.5);\n        return sample("+r+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = UVfrom1D("+o+", "+a+", index);\n      return sample("+r+", uv);\n    }\n  "}function f(t,e,r){var n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),a=r[0],i=r[1];return x.arraysEqual(e,r)?"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+a+".0);\n      return sample("+n+", uv);\n    }\n  ":1===i?1===e[0]?"\n      float "+o+"(int row, int col) {\n        vec2 uv = vec2(0.5, (float(col) + 0.5) / "+a+".0);\n        return sample("+n+", uv);\n      }\n    ":1===e[1]?"\n      float "+o+"(int row, int col) {\n        vec2 uv = vec2(0.5, (float(row) + 0.5) / "+a+".0);\n        return sample("+n+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col) {\n      int index = row * "+e[1]+" + col;\n      vec2 uv = vec2(0.5, (float(index) + 0.5) / "+a+".0);\n      return sample("+n+", uv);\n    }\n  ":1===a?"\n    float "+o+"(int row, int col) {\n      int index = row * "+e[1]+" + col;\n      vec2 uv = vec2((float(index) + 0.5) / "+i+".0, 0.5);\n      return sample("+n+", uv);\n    }\n  ":"\n  float "+o+"(int row, int col) {\n    vec2 uv = UVfrom2D("+a+", "+i+", "+e[1]+", row, col);\n    return sample("+n+", uv);\n  }\n"}function d(t,e,r){var n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),a=r[0],i=r[1],s=e[1]*e[2],u=e[2];if(i===s){if(t.shapeInfo.textureType===w.TextureType.DEFAULT)return"\n        float "+o+"(int row, int col, int depth) {\n          int texR = row;\n          int texC = col * "+u+" + depth;\n          vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+i+".0, "+a+".0);\n          return sample("+n+", uv);\n        }\n      ";if(t.shapeInfo.textureType===w.TextureType.RGBA_COLOR)return"\n        float "+o+"(int row, int col, int depth) {\n          vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+a+".0);\n          return sampleUVAndDepth("+n+", uv, depth);\n        }\n      ";throw new Error("Unknown TextureType "+t.shapeInfo.textureType+".")}if(t.shapeInfo.textureType===w.TextureType.DEFAULT)return"\n      float "+o+"(int row, int col, int depth) {\n        vec2 uv = UVfrom3D(\n            "+a+", "+i+", "+s+", "+u+", row, col, depth);\n        return sample("+n+", uv);\n      }\n  ";if(t.shapeInfo.textureType===w.TextureType.RGBA_COLOR)return"\n      float "+o+"(int row, int col, int depth) {\n        vec2 uv = UVfrom2D("+a+", "+i+", "+e[1]+", row, col);\n        return sampleUVAndDepth("+n+", uv, depth);\n      }\n    ";throw new Error("Unknown TextureType "+t.shapeInfo.textureType+".")}function v(t,e,r){var n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),a=r[0],i=r[1],s=e[3],u=e[2]*s,c=e[1]*u;return i===c?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int texR = row;\n        int texC = col * "+u+" + depth * "+s+" + depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+i+".0, "+a+".0);\n        return sample("+n+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      vec2 uv = UVfrom4D("+a+", "+i+", "+c+", "+u+", "+s+",\n          row, col, depth, depth2);\n      return sample("+n+", uv);\n    }\n  "}function m(t,e){var r="get"+t.charAt(0).toUpperCase()+t.slice(1)+"Flat",n=e[0],o=e[1];return 1===o&&1===n?"\n      float "+r+"(int index) {\n        return sample("+t+", halfCR);\n      }\n    ":1===o?"\n      float "+r+"(int index) {\n        vec2 uv = vec2(0.5, (float(index) + 0.5) / "+n+".0);\n        return sample("+t+", uv);\n      }\n    ":1===n?"\n      float "+r+"(int index) {\n        vec2 uv = vec2((float(index) + 0.5) / "+o+".0, 0.5);\n        return sample("+t+", uv);\n      }\n    ":"\n    float "+r+"(int index) {\n      int texR = index / "+o+";\n      int texC = index - texR * "+o+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+o+".0, "+n+".0);\n      return sample("+t+", uv);\n    }\n  "}function g(t,e,r,n){var o=t.name,a=t.shapeInfo.textureType===w.TextureType.RGBA_COLOR,i="get"+o.charAt(0).toUpperCase()+o.slice(1)+"AtOutCoords";if(x.arraysEqual(e,r)&&!a)return"\n      float "+i+"() {\n        return sample("+o+", resultUV);\n      }\n    ";var s=a?[e[0],e[1]*t.shapeInfo.logicalShape[2]]:e,u=x.sizeFromShape(s),c="";n&&(c="\n      int mainPart = index / "+u+";\n      index -= mainPart * "+u+";\n    ");var p="return sample("+o+", uv);",l="";return a&&(l="\n      int col = texC / "+t.shapeInfo.logicalShape[2]+";\n      int texD = texC - col * "+t.shapeInfo.logicalShape[2]+";\n      texC = col;\n    ",p="return sampleUVAndDepth("+o+", uv, texD);"),"\n    float "+i+"() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n      "+c+"\n      int texR = index / "+s[1]+";\n      int texC = index - texR * "+s[1]+";\n\n      "+l+"\n\n      vec2 uv = (vec2(texC, texR) + halfCR) /\n                 vec2("+e[1]+".0, "+e[0]+".0);\n\n      "+p+"\n    }\n  "}Object.defineProperty(r,"__esModule",{value:!0});var y=t("../../environment"),x=t("../../util"),b=t("./tex_util"),w=t("./tex_util");r.makeShader=function(t,e,r,s){var u=n(),c=o(),p=t.map(function(t){return"uniform sampler2D "+t.name+";"}).join("\n"),l=t.map(function(t){return a(t,e,s)}).join("\n"),h=e.texShape,f=i(e.logicalShape,h);return[S,u,c,p,l,f,r].join("\n")};var _="\n  uniform float NaN;\n\n  const vec4 floatDeltas = vec4(\n      1.0,\n      1.0 / 255.0,\n      1.0 / (255.0 * 255.0),\n      1.0 / (255.0 * 255.0 * 255.0)\n  );\n  const float minValue = "+b.FLOAT_MIN+".0;\n  const float maxValue = "+b.FLOAT_MAX+".0;\n  const float range = (maxValue - minValue) / 255.0;\n  const vec2 dotRange = vec2(1.0, range);\n\n  float sample(sampler2D texture, vec2 uv) {\n    vec4 sampleValue = texture2D(texture, uv);\n    if (all(equal(sampleValue, vec4("+b.BYTE_NAN_VALUE+")))) {\n      return NaN;\n    }\n\n    vec4 encValue = floor(sampleValue * 255.0 + 0.5);\n    float decodedValue = dot(encValue, floatDeltas);\n    return dot(vec2(minValue, decodedValue), dotRange);\n  }\n",A="\n  const vec4 floatPowers = vec4(\n    1.0,\n    255.0,\n    255.0 * 255.0,\n    255.0 * 255.0 * 255.0\n  );\n  const vec2 recipRange = vec2(1.0/range);\n  const vec2 recipRange255 = vec2(1.0/(maxValue - minValue));\n\n  void setOutput(float decodedValue) {\n    if (isNaN(decodedValue)) {\n      gl_FragColor = vec4("+b.BYTE_NAN_VALUE+");\n      return;\n    }\n\n    float a = dot(vec2(decodedValue, -minValue), recipRange);\n    float b = fract(a) * 255.0;\n    float c = fract(b) * 255.0;\n    float d = fract(c) * 255.0;\n    gl_FragColor = floor(vec4(a, b, c, d)) / 255.0;\n\n    // TODO(dsmilkov): Version above gets better accuracy but probably slower\n    // than the version below. Benchmark to determine if the accuracy is worth\n    // the cost.\n\n    // float normValue = dot(vec2(decodedValue, -minValue), recipRange255);\n    // vec4 f = normValue * floatPowers;\n    // gl_FragColor = floor(fract(f) * 255.0) / 255.0;\n  }\n",T="\n  float sample(sampler2D texture, vec2 uv) {\n    return texture2D(texture, uv).r;\n  }\n",E="\n  void setOutput(float val) {\n    gl_FragColor = vec4(val, 0, 0, 0);\n  }\n",S="\n  precision highp float;\n  precision highp int;\n  varying vec2 resultUV;\n  const vec2 halfCR = vec2(0.5, 0.5);\n\n  bool isNaN(float val) {\n    return val == val ? false : true;\n  }\n\n  bool hasNaN(vec4 values) {\n    return any(notEqual(values, values));\n  }\n\n  float getNaN(vec4 values) {\n    return dot(vec4(1), values);\n  }\n\n  int round(float value) {\n    return int(floor(value + 0.5));\n  }\n\n  int imod(int x, int y) {\n    return x - y * (x / y);\n  }\n\n  const vec2 randomConst = vec2(\n    23.14069263277926, // e^pi (Gelfond's constant)\n     2.665144142690225 // 2^sqrt(2) (Gelfond–Schneider constant)\n  );\n\n  float random(float seed) {\n      return fract(cos(dot(resultUV * seed, randomConst)) * 12345.6789);\n  }\n\n  float sampleUVAndDepth(sampler2D texture, vec2 uv, int depth) {\n    float value;\n    if (depth == 0) {\n      value = texture2D(texture, uv).r;\n    } else if (depth == 1) {\n      value = texture2D(texture, uv).g;\n    } else if (depth == 2) {\n      value = texture2D(texture, uv).b;\n    } else if (depth == 3) {\n      value = texture2D(texture, uv).a;\n    }\n    return floor(value * 255.0 + 0.5);\n  }\n\n  \nvec2 UVfrom1D(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom2D(int texNumR, int texNumC, int numC, int row, int col) {\n  int index = row * numC + col;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom3D(int texNumR, int texNumC, int stride0,\n    int stride1, int row, int col, int depth) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom4D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int row, int col, int depth,\n    int depth2) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n"},{"../../environment":15,"../../util":94,"./tex_util":89}],87:[function(t,e,r){"use strict";function n(t){if(1===t)return"sourceLoc";if(2===t)return"sourceLoc.x, sourceLoc.y";if(3===t)return"sourceLoc.x, sourceLoc.y, sourceLoc.z";if(4===t)return"sourceLoc.x, sourceLoc.y, sourceLoc.z, sourceLoc.w";throw Error("Slicing for rank "+t+" is not yet supported")}function o(t){if(1===t)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";throw Error("Slicing for rank "+t+" is not yet supported")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length,this.params=[];var e=o(this.rank),r=n(this.rank);this.userCode="\n      uniform "+e+" start;\n\n      void main() {\n        "+e+" sourceLoc = start + getOutputCoords();\n        setOutput(getSource("+r+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,n){if(null!=e.startLoc||(e.startLoc=r.getUniformLocationNoThrow(n,"start"),null!=e.startLoc))if(1===e.rank)r.gl.uniform1i(e.startLoc,t[0]);else if(2===e.rank)r.gl.uniform2i(e.startLoc,t[0],t[1]);else if(3===e.rank)r.gl.uniform3i(e.startLoc,t[0],t[1],t[2]);else{if(4!==e.rank)throw Error("Slicing for rank "+e.rank+" is not yet supported");r.gl.uniform4i(e.startLoc,t[0],t[1],t[2],t[3])}}},t}();r.SliceProgram=a},{}],88:[function(t,e,r){"use strict";function n(t){var e=t.length;if(e>4)throw Error("SwitchDim for rank "+e+" is not yet supported");for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],n=new Array(e),o=0;o<t.length;o++)n[t[o]]=r[o];return n.join()}function o(t){if(1===t)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";throw Error("SwitchDim for rank "+t+" is not yet supported")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){return function(t,e){this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[e[a]];this.outputShape=r,this.rank=r.length,this.params=[e.toString()];var i=o(this.rank),s=n(e);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+s+"));\n    }\n    "}}();r.SwitchDimProgram=a},{}],89:[function(t,e,r){"use strict";function n(t,e){return t*e}function o(t,e){if(t%e!=0)throw new Error("unpackedSize ("+t+") must be a multiple of "+e);return t/e}function a(t,e){return[Math.ceil(e/2),Math.ceil(t/2)]}function i(t,e){var r=a(t,e);return r[0]*r[1]*4}Object.defineProperty(r,"__esModule",{value:!0});!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.RGBA_COLOR=1]="RGBA_COLOR"}(r.TextureType||(r.TextureType={})),r.getUnpackedMatrixTextureShapeWidthHeight=function(t,e){return[e,t]},r.getUnpackedArraySizeFromMatrixSize=n,r.getColorMatrixTextureShapeWidthHeight=function(t,e){return[4*e,t]},r.getMatrixSizeFromUnpackedArraySize=o,r.encodeMatrixToUnpackedArray=function(t,e,r){var o=n(t.length,r);if(e.length<o)throw new Error("unpackedArray length ("+e.length+") must be >= "+o);for(var a=0,i=0;i<t.length;++i)e[a]=t[i],a+=r},r.FLOAT_MAX=2e4,r.FLOAT_MIN=-r.FLOAT_MAX;var s=(r.FLOAT_MAX-r.FLOAT_MIN)/255,u=[1,1/255,1/65025,1/16581375],c=[1,255,65025];r.BYTE_NAN_VALUE=0,r.encodeFloatArray=function(t){for(var e=new Uint8Array(4*t.length),n=0;n<e.length;n+=4)!function(n){var o=t[n/4];if(isNaN(o))return e[n]=r.BYTE_NAN_VALUE,e[n+1]=r.BYTE_NAN_VALUE,e[n+2]=r.BYTE_NAN_VALUE,e[n+3]=r.BYTE_NAN_VALUE,"continue";var a=(o-r.FLOAT_MIN)/s,i=c.map(function(t){return t*a}).map(function(t){return Math.floor(t%1*255)});e[n]=Math.floor(a),e[n+1]=i[0],e[n+2]=i[1],e[n+3]=i[2]}(n);return e},r.decodeToFloatArray=function(t){for(var e=new Float32Array(t.length/4),n=0;n<t.length;n+=4)!function(n){if(t[n]===r.BYTE_NAN_VALUE&&t[n+1]===r.BYTE_NAN_VALUE&&t[n+2]===r.BYTE_NAN_VALUE&&t[n+3]===r.BYTE_NAN_VALUE)return e[n/4]=NaN,"continue";var o=0;u.forEach(function(e,r){o+=e*t[n+r]});var a=o*s+r.FLOAT_MIN;e[n/4]=a}(n);return e},r.decodeMatrixFromUnpackedArray=function(t,e,r){var n=o(t.length,r);if(e.length<n)throw new Error("matrix length ("+e.length+") must be >= "+n);for(var a=0,i=0;i<t.length;i+=r)e[a++]=t[i]},r.decodeMatrixFromUnpackedColorRGBAArray=function(t,e,r){var n=t.length*r/4;if(e.length<n)throw new Error("matrix length ("+e.length+") must be >= "+n);for(var o=0,a=0;a<t.length;a+=4)for(var i=0;i<r;i++)e[o++]=t[a+i]},r.getPackedMatrixTextureShapeWidthHeight=a,r.getPackedRGBAArraySizeFromMatrixShape=i,r.encodeMatrixToPackedRGBA=function(t,e,r,n){var o=i(e,r);if(n.length<o)throw new Error("packedRGBA length ("+n.length+") must be >= "+o);for(var s=a(e,r),u=s[0],c=s[1],p=r%2==1,l=e%2==1,h=Math.floor(r/2),f=Math.floor(e/2),d=p?4:0,v=r,m=0,g=0;g<f;++g){for(var y=2*g*r,x=0;x<h;++x)b=y+2*x,n[m]=t[b],n[m+1]=t[b+1],n[m+2]=t[b+v],n[m+3]=t[b+v+1],m+=4;m+=d}if(p)for(var b=r-1,m=4*(u-1),w=2*r,d=4*u,g=0;g<f;++g)n[m]=t[b],n[m+2]=t[b+r],b+=w,m+=d;if(l)for(var b=(e-1)*r,m=(c-1)*u*4,x=0;x<h;++x)n[m++]=t[b++],n[m++]=t[b++],m+=2;return p&&l&&(n[n.length-4]=t[t.length-1]),n},r.decodeMatrixFromPackedRGBA=function(t,e,r,n){var o=e*r;if(o<n.length)throw new Error("matrix length ("+n.length+") must be >= "+o);for(var i=r%2==1,s=e%2==1,u=Math.floor(r/2),c=Math.floor(e/2),p=a(e,r),l=p[0],h=p[1],f=i?4:0,d=r+(i?1:0),v=0,m=0,g=r,y=0;y<c;++y){for(b=0;b<u;++b)n[m++]=t[v++],n[m++]=t[v++],n[g++]=t[v++],n[g++]=t[v++];v+=f,m+=d,g+=d}if(i)for(var v=4*(l-1),x=r-1,f=4*l,d=2*r,y=0;y<c;++y)n[x]=t[v],n[x+r]=t[v+2],v+=f,x+=d;if(s)for(var v=(h-1)*l*4,x=(e-1)*r,b=0;b<u;++b)n[x++]=t[v++],n[x++]=t[v++],v+=2;return i&&s&&(n[n.length-1]=t[t.length-4]),n}},{}],90:[function(t,e,r){"use strict";function n(t){return t[0]+"_"+t[1]}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextureCount={}}return t.prototype.acquireTexture=function(t){var e=n(t);return e in this.freeTextures||(this.freeTextures[e]=[]),e in this.usedTextureCount||(this.usedTextureCount[e]=0),this.usedTextureCount[e]++,this.freeTextures[e].length>0?(this.numFreeTextures--,this.numUsedTextures++,this.log(),this.freeTextures[e].shift()):(this.numUsedTextures++,this.log(),this.gpgpu.createMatrixTexture(t[0],t[1]))},t.prototype.releaseTexture=function(t,e){var r=n(e);r in this.freeTextures||(this.freeTextures[r]=[]),this.freeTextures[r].push(t),this.numFreeTextures++,this.numUsedTextures--,this.usedTextureCount[r]--,this.log()},t.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){for(var t in this.freeTextures)if(this.freeTextures.hasOwnProperty(t))for(var e=0;e<this.freeTextures[t].length;e++)this.gpgpu.deleteMatrixTexture(this.freeTextures[t][e])},t}();r.TextureManager=o},{}],91:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function(t,e){this.variableNames=["A"],this.outputShape=t,this.params=[e],this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}}();r.UnaryOpProgram=n,r.CHECK_NAN_SNIPPET="\n  if (isNaN(x)) {\n    return x;\n  }\n",r.ABS="\n  return abs(x);\n",r.RELU="\n  return (x < 0.0) ? 0.0 : x;\n",r.STEP="\n  return (x == x) ? (x > 0.0 ? 1.0 : 0.0) : x;\n",r.NEG="\n  return -x;\n",r.CEIL="\n  return ceil(x);\n",r.FLOOR="\n  return floor(x);\n",r.EXP="\n  return exp(x);\n",r.LOG="\n  return log(x);\n",r.SQRT=r.CHECK_NAN_SNIPPET+"\n  return sqrt(x);\n",r.SIGMOID="\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",r.SIN=r.CHECK_NAN_SNIPPET+"\n  return sin(x);\n",r.COS=r.CHECK_NAN_SNIPPET+"\n  return cos(x);\n",r.TAN="\n  return tan(x);\n",r.ASIN=r.CHECK_NAN_SNIPPET+"\n  return asin(x);\n",r.ACOS=r.CHECK_NAN_SNIPPET+"\n  return acos(x);\n",r.ATAN=r.CHECK_NAN_SNIPPET+"\n  return atan(x);\n",r.SINH="\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n",r.COSH="\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n",r.TANH="\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"},{}],92:[function(t,e,r){"use strict";function n(t,e){var r,n=v.ENV.get("WEBGL_VERSION");if(2===n?r=t.getContext("webgl2",e):1===n&&(r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)),0===n||null==r)throw new Error("This browser does not support WebGL.");return r}function o(t,e){var r=e();return a(t),r}function a(t){if(m){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+i(t,e))}}function i(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function s(t,e){var r=g.exec(e);if(null==r)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var n=+r[1],o=t.split("\n"),a=(""+o.length).length+2,i=o.map(function(t,e){return d.rightPad(""+(e+1),a)+t}),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var c=i.slice(0,n-1),p=i.slice(n-1,n),l=i.slice(n);console.log(c.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+d.rightPad(p[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(l.join("\n"))}function u(t){return null!=f?f:f=o(t,function(){return t.getParameter(t.MAX_TEXTURE_SIZE)})}function c(t,e,r){h(t,r),o(t,function(){return t.activeTexture(t.TEXTURE0+r)}),o(t,function(){return t.bindTexture(t.TEXTURE_2D,e)})}function p(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function l(t,e,r){var n=o(t,function(){return e()});if(null==n)throw new Error(r);return n}function h(t,e){var r=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+t.TEXTURE0;if(n<t.TEXTURE0||n>r){var o="[gl.TEXTURE0, gl.TEXTURE"+r+"]";throw new Error("textureUnit must be in "+o+".")}}Object.defineProperty(r,"__esModule",{value:!0});var f=null,d=t("../../util"),v=t("../../environment");r.createWebGLRenderingContext=function(t){var e=document.createElement("canvas");return e.width=1,e.height=1,n(e,t)},r.createWebGLRenderingContextFromCanvas=n,r.callAndCheck=o;var m=!1;r.enableDebugWebGLErrorChecking=function(t){m=t},r.checkWebGLError=a,r.getWebGLErrorMessage=i,r.getExtensionOrThrow=function(t,e){return l(t,function(){return t.getExtension(e)},'Extension "'+e+'" not supported on this browser.')},r.createVertexShader=function(t,e){var r=l(t,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(o(t,function(){return t.shaderSource(r,e)}),o(t,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r},r.createFragmentShader=function(t,e){var r=l(t,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(o(t,function(){return t.shaderSource(r,e)}),o(t,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw s(e,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r};var g=/ERROR: [0-9]+:([0-9]+):/g;r.createProgram=function(t){return l(t,function(){return t.createProgram()},"Unable to create WebGLProgram.")},r.linkProgram=function(t,e){if(o(t,function(){return t.linkProgram(e)}),!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")},r.validateProgram=function(t,e){if(o(t,function(){return t.validateProgram(e)}),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")},r.createStaticVertexBuffer=function(t,e){var r=l(t,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return o(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),o(t,function(){return t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)}),r},r.createStaticIndexBuffer=function(t,e){var r=l(t,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return o(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),o(t,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)}),r},r.queryMaxTextureSize=u,r.getChannelsPerTexture=function(){return v.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")&&2===v.ENV.get("WEBGL_VERSION")?1:4},r.createTexture=function(t){return l(t,function(){return t.createTexture()},"Unable to create WebGLTexture.")},r.validateTextureSize=function(t,e,r){var n=u(t);if(e<=0||r<=0)throw o="["+e+"x"+r+"]",new Error("Requested texture size "+o+" is invalid.");if(e>n||r>n){var o="["+e+"x"+r+"]",a="["+n+"x"+n+"]";throw new Error("Requested texture size "+o+" greater than WebGL maximum on this browser / GPU "+a+".")}},r.createFramebuffer=function(t){return l(t,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")},r.bindVertexBufferToProgramAttribute=function(t,e,r,n,a,i,s,u){var c=-1;-1!==(c=null!=u&&r in u?u[r]:t.getAttribLocation(e,r))&&(o(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,n)}),o(t,function(){return t.vertexAttribPointer(c,a,t.FLOAT,!1,i,s)}),o(t,function(){return t.enableVertexAttribArray(c)}))},r.bindTextureUnit=c,r.unbindTextureUnit=function(t,e){h(t,e),o(t,function(){return t.activeTexture(t.TEXTURE0+e)}),o(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})},r.getProgramUniformLocationOrThrow=function(t,e,r){return l(t,function(){return t.getUniformLocation(e,r)},'uniform "'+r+'" not present in program.')},r.bindTextureToProgramUniformSampler=function(t,e,r,n,a){o(t,function(){return c(t,r,a)}),o(t,function(){return t.uniform1i(n,a)})},r.bindCanvasToFramebuffer=function(t){o(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),o(t,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),o(t,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},r.bindColorTextureToFramebuffer=function(t,e,r){o(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),o(t,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)})},r.unbindColorTextureFromFramebuffer=function(t,e){o(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,e)}),o(t,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})},r.validateFramebuffer=function(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+p(t,e))},r.getFramebufferErrorMessage=p,r.getTextureShapeFromLogicalShape=function(t,e,r){var n=u(t),o=d.sizeFromShape(e);if(null!=r){var a=d.sizeFromShape(r);if(d.assert(o===a,"Size of shape ("+o+") must match size of preferredShape ("+a+")"),r[0]<=n&&r[1]<=n)return r}return e.length<=1&&o<=n?[o,1]:2===e.length&&e[0]<=n&&e[1]<=n?e:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?[e[0],e[1]*e[2]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n?[e[0],e[1]*e[2]*e[3]]:d.sizeToSquarishShape(o)}},{"../../environment":15,"../../util":94}],93:[function(t,e,r){"use strict";function n(t,e,r){return!(!isNaN(t)||!isNaN(e))||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>r)}function o(t,e,r,n){null!=n?n.forEach(function(n){var o=t+" "+JSON.stringify(n);r(o,e,n)}):r(t,e)}function a(t,e,r,n){var o;i(t,e,n,function(){(o=r()).startScope()},function(){o.endScope(null),o.dispose()},function(t,e){it(t,function(){return e(o)})})}function i(t,e,r,n,o,a){void 0===a&&(a=it),describe(t,function(){beforeEach(function(){null!=r&&s.setEnvironment(new u.Environment(r)),null!=n&&n()}),afterEach(function(){null!=o&&o(),null!=r&&s.setEnvironment(new u.Environment)}),e.forEach(function(t){return t(a)})})}Object.defineProperty(r,"__esModule",{value:!0});var s=t("./environment"),u=t("./environment"),c=t("./math/math_cpu"),p=t("./math/math_gpu");r.TEST_EPSILON=.01,r.expectArraysClose=function(t,e,o){void 0===o&&(o=r.TEST_EPSILON);var a=t.constructor.name,i=e.constructor.name;if(a!==i)throw new Error("Arrays are of different type "+a+" vs "+i);if(t.length!==e.length)throw new Error("Matrices have different lengths ("+t.length+" vs "+e.length+").");for(var s=0;s<e.length;++s){var u=t[s],c=e[s];if(!n(u,c,o)){var p="actual["+s+"] === "+u,l="expected["+s+"] === "+c;throw new Error("Arrays differ: "+p+", "+l)}}},r.expectNumbersClose=function(t,e,o){if(void 0===o&&(o=r.TEST_EPSILON),!n(t,e,o))throw new Error("Numbers differ: actual === "+t+", expected === "+e)},r.randomArrayInRange=function(t,e,r){for(var n=new Float32Array(t),o=r-e,a=0;a<t;++a)n[a]=Math.random()*o+e;return n},r.makeIdentity=function(t){for(var e=new Float32Array(t*t),r=0;r<t;++r)e[r*t+r]=1;return e},r.setValue=function(t,e,r,n,o,a){if(o>=e)throw new Error("row ("+o+") must be in [0 "+e+"].");if(a>=r)throw new Error("column ("+a+") must be in [0 "+r+"].");t[o*r+a]=n},r.cpuMultiplyMatrix=function(t,e,r,n,o,a){for(var i=new Float32Array(e*a),s=0;s<e;++s)for(var u=s*r,c=s*a,p=0;p<a;++p){for(var l=0,h=0;h<r;++h)l+=t[u+h]*n[h*a+p];i[c+p]=l}return i},r.cpuDotProduct=function(t,e){if(t.length!==e.length)throw new Error("cpuDotProduct: incompatible vectors.");for(var r=0,n=0;n<t.length;++n)r+=t[n]*e[n];return r},r.describeMathCPU=function(t,e,r){o("math_cpu."+t,e,function(t,e,r){return a(t,e,function(){return new c.NDArrayMathCPU},r)},r)},r.describeMathGPU=function(t,e,r){o("math_gpu."+t,e,function(t,e,r){return a(t,e,function(){return new p.NDArrayMathGPU},r)},r)},r.describeCustom=function(t,e,r,n,a){o(t,[e],function(t,e,r){return i(t,e,r,n,a)},r)},r.executeMathTests=a,r.executeTests=i},{"./environment":15,"./math/math_cpu":59,"./math/math_gpu":60}],94:[function(t,e,r){"use strict";function n(t){for(var e=t.length,r=0,n=0;e>0;)n=Math.random()*e|0,r=t[--e],t[e]=t[n],t[n]=r}function o(t,e,r){void 0===t&&(t=0),void 0===e&&(e=1),void 0===r&&(r=!1);var n,a,i;do{i=(n=2*Math.random()-1)*n+(a=2*Math.random()-1)*a}while(i>1);var s=Math.sqrt(-2*Math.log(i)/i)*n;return r&&Math.abs(s)>2?o(t,e,!0):t+e*s}function a(t,e){if(!t)throw new Error(e)}function i(t,e){if(void 0===e&&(e=[]),Array.isArray(t))for(var r=0;r<t.length;++r)i(t[r],e);else e.push(t);return e}function s(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function u(t,e,r){t[decodeURIComponent(e)]=decodeURIComponent(r||"")}Object.defineProperty(r,"__esModule",{value:!0}),r.shuffle=n,r.clamp=function(t,e,r){return Math.max(t,Math.min(e,r))},r.randUniform=function(t,e){return Math.random()*(e-t)+t},r.randGauss=o,r.distSquared=function(t,e){for(var r=0,n=0;n<t.length;n++){var o=Number(t[n])-Number(e[n]);r+=o*o}return r},r.assert=a,r.assertShapesMatch=function(t,e,r){void 0===r&&(r=""),a(s(t,e),r+"Shapes "+t+" and "+e+" must match")},r.flatten=i,r.inferShape=function(t){for(var e=[];t instanceof Array;)e.push(t.length),t=t[0];return e},r.sizeFromShape=function(t){if(0===t.length)return 1;for(var e=t[0],r=1;r<t.length;r++)e*=t[r];return e},r.isScalarShape=function(t){return 0===t.length},r.arraysEqual=s,r.isInt=function(t){return t%1==0},r.tanh=function(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)},r.sizeToSquarishShape=function(t){for(var e=Math.floor(Math.sqrt(t));e>1;--e)if(t%e==0)return[e,t/e];return[1,t]},r.createShuffledIndices=function(t){for(var e=new Uint32Array(t),r=0;r<t;++r)e[r]=r;return n(e),e},r.assertAndGetBroadcastedShape=function(t,e){var r=[],n=!1,o=!1,a="Operands could not be broadcast together with shapes "+t+" and "+e+". Currently, we only support a stricter version of broadcasting than numpy.",i=Math.max(t.length,e.length);t=t.slice().reverse(),e=e.slice().reverse();for(var s=0;s<i;s++){var u=t[s]||1,c=e[s]||1;if(c>1&&o||u>1&&n)throw Error(a);if(u>1&&1===c&&(o=!0),c>1&&1===u&&(n=!0),u>1&&c>1&&u!==c)throw Error(a);r.push(Math.max(u,c))}return r.reverse()},r.rightPad=function(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)},r.repeatedTry=function(t,e,r){return void 0===e&&(e=function(t){return 0}),new Promise(function(n,o){var a=0,i=function(){if(t())n();else{var s=e(++a);null!=r&&a>=r?o():setTimeout(i,s)}};setTimeout(i,0)})},r.getQueryParams=function(t){var e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return u(e,r[0],r[1]),r.join("=")}),e},r.inferFromImplicitShape=function(t,e){for(var r=1,n=-1,o=0;o<t.length;++o)if(t[o]>0)r*=t[o];else if(-1===t[o]){if(-1!==n)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+o);n=o}else if(t[o]<=0)throw Error("Shapes can not be <= 0. Found "+t[o]+" at dim "+o);if(-1===n){if(e>0&&e!==r)throw Error("Size ("+e+") must match the product of shape "+t);return t}if(e%r!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+r);var a=t.slice();return a[n]=e/r,a}},{}],95:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.version="0.3.2"},{}]},{},[51])(51)});